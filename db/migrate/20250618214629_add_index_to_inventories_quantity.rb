# frozen_string_literal: true

class AddIndexToInventoriesQuantity < ActiveRecord::Migration[7.2]
  def change
    # CLAUDE.mdæº–æ‹ : ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ– - åœ¨åº«æ•°ç¯„å›²æ¤œç´¢ã®é«˜é€ŸåŒ–
    # ãƒ¡ã‚¿èªçŸ¥: åœ¨åº«æ•°ã§ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¯é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹æ©Ÿèƒ½
    # ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹: ç¯„å›²æ¤œç´¢ã«æœ€é©ãªB-treeã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    # æ¨ªå±•é–‹: store_inventoriesãƒ†ãƒ¼ãƒ–ãƒ«ã«ã¯æ—¢ã«åŒæ§˜ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒå­˜åœ¨
    
    # åœ¨åº«æ•°å˜ä½“ã§ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆç¯„å›²æ¤œç´¢æœ€é©åŒ–ï¼‰
    add_index :inventories, :quantity, 
              name: "idx_inventories_quantity",
              comment: "åœ¨åº«æ•°ç¯„å›²æ¤œç´¢æœ€é©åŒ–ï¼ˆmin_quantity/max_quantity ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨ï¼‰"
    
    # è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨åœ¨åº«æ•°ã®çµ„ã¿åˆã‚ã›æ¤œç´¢æœ€é©åŒ–ï¼‰
    add_index :inventories, [:status, :quantity], 
              name: "idx_inventories_status_quantity",
              comment: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥åœ¨åº«æ•°æ¤œç´¢æœ€é©åŒ–"
    
    # TODO: ðŸŸ¡ Phase 3ï¼ˆé‡è¦ï¼‰- è¿½åŠ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ¤œè¨Ž
    # å„ªå…ˆåº¦: ä¸­ï¼ˆã‚¯ã‚¨ãƒªãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å‘ä¸Šï¼‰
    # å®Ÿè£…å†…å®¹:
    #   - price ã¨ quantity ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆä¾¡æ ¼ãƒ»åœ¨åº«æ•°åŒæ™‚ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨ï¼‰
    #   - created_at ã¨ quantity ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆæœŸé–“åˆ¥åœ¨åº«åˆ†æžç”¨ï¼‰
    #   - ã‚«ãƒãƒªãƒ³ã‚°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ¤œè¨Žï¼ˆSELECTæ™‚ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¢ã‚¯ã‚»ã‚¹å‰Šæ¸›ï¼‰
    # æœŸå¾…åŠ¹æžœ: è¤‡é›‘ãªæ¤œç´¢ã‚¯ã‚¨ãƒªã®å®Ÿè¡Œæ™‚é–“50%å‰Šæ¸›
  end
end