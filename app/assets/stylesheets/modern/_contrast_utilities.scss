// ============================================
// コントラストユーティリティ
// ============================================
// CLAUDE.md準拠: WCAG AA基準のコントラスト保証
// メタ認知: 動的背景色でも適切なコントラストを維持

// ============================================
// 高コントラストモード対応
// ============================================
@media (prefers-contrast: high) {
  :root {
    // より強いコントラストの文字色
    --text-primary: #{$slate-950};      // #020617 (最も濃い)
    --text-secondary: #{$slate-900};    // #0f172a
    --text-muted: #{$slate-700};        // #334155
    
    // より明確な背景色
    --bg-base: #ffffff;
    --bg-surface: #ffffff;
    --bg-section: #{$slate-50};
    
    // 強調されたボーダー
    --border-light: #{$slate-400};
    --border-default: #{$slate-600};
    --border-strong: #{$slate-800};
  }
  
  // ダークモード + 高コントラスト
  [data-theme="dark"] {
    --text-primary: #ffffff;
    --text-secondary: #{$slate-50};
    --text-muted: #{$slate-100};
    
    --bg-base: #000000;
    --bg-surface: #{$slate-950};
    --bg-section: #{$slate-900};
  }
}

// ============================================
// 印刷メディア対応
// ============================================
@media print {
  :root {
    // 印刷用の高コントラスト設定
    --text-primary: #000000;
    --text-secondary: #1a1a1a;
    --text-muted: #333333;
    
    --bg-base: #ffffff;
    --bg-surface: #ffffff;
    --bg-section: #f5f5f5;
    
    // 印刷時はボーダーを明確に
    --border-light: #666666;
    --border-default: #333333;
    --border-strong: #000000;
  }
  
  // 背景色を除去（インク節約）
  .card, .table-container-modern {
    background: none !important;
    border: 1px solid #000000 !important;
  }
  
  // リンクのアンダーライン表示
  a {
    text-decoration: underline !important;
  }
}

// ============================================
// フォールバック値を含むユーティリティクラス
// ============================================
.text-primary-safe {
  color: #1e293b; /* fallback for older browsers */
  color: var(--text-primary);
}

.text-secondary-safe {
  color: #334155; /* fallback */
  color: var(--text-secondary);
}

.text-muted-safe {
  color: #64748b; /* fallback */
  color: var(--text-muted);
}

// ============================================
// 動的コントラスト調整クラス
// ============================================
// 背景色に応じて自動的にテキスト色を調整
.auto-contrast {
  // 明るい背景用
  &.bg-light {
    color: var(--text-primary);
  }
  
  // 暗い背景用
  &.bg-dark {
    color: var(--text-inverse);
  }
  
  // プライマリ背景用
  &.bg-primary {
    color: #ffffff;
  }
}

// TODO: 🟡 Phase 5（改善）- 動的コントラスト計算
// 優先度: 中（アクセシビリティ向上）
// - JavaScriptによるリアルタイムコントラスト計算
// - APCA（Advanced Perceptual Contrast Algorithm）対応
// - カスタムテーマでのコントラスト保証