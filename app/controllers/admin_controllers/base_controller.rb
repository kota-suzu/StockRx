# frozen_string_literal: true

module AdminControllers
  # ç®¡ç†è€…ç”»é¢ç”¨ã®ãƒ™ãƒ¼ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©
  # å…¨ã¦ã®ç®¡ç†è€…å‘ã‘ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ã“ã®ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã™ã‚‹
  class BaseController < ApplicationController
    include ErrorHandlers
    include AdminAuthorization  # ğŸ”’ æ¨©é™ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã®çµ±ä¸€
    include SecurityCompliance  # ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹æ©Ÿèƒ½

    # AdminControllersç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼ã®ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰
    helper AdminControllers::ApplicationHelper

    before_action :authenticate_admin!
    layout "admin"

    # CSRFãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã‚’æœ‰åŠ¹åŒ–
    protect_from_forgery with: :exception

    # å…¨ã¦ã®ç®¡ç†è€…ç”»é¢ã§å…±é€šã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å‡¦ç†
    before_action :set_admin_info

    # TODO: ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®å‘½åè¦å‰‡
    # AdminControllersãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã¯Adminãƒ¢ãƒ‡ãƒ«ã¨ã®åå‰è¡çªã‚’é¿ã‘ã‚‹ãŸã‚ã«ä½¿ç”¨
    # å°†æ¥çš„ãªæ–°ã—ã„ãƒ¢ãƒ‡ãƒ«/ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã®è¿½åŠ æ™‚ã«ã‚‚åŒæ§˜ã®åå‰è¡çªã«æ³¨æ„
    # ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åã«ã¯ã€ŒControllersã€ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’ä½¿ç”¨ã—ã¦åŒºåˆ¥ã™ã‚‹
    # ä¾‹: Userãƒ¢ãƒ‡ãƒ«ã¨UserControllersãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãªã©

    # TODO: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ³¨æ„ç‚¹
    # 1. èªè¨¼é–¢é€£ãƒ«ãƒ¼ãƒˆï¼ˆDeviseï¼‰ã¯ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒˆã‚ˆã‚Šå…ˆã«å®šç¾©ã™ã‚‹
    # 2. ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ãƒ«ãƒ¼ãƒˆï¼ˆ*pathï¼‰ã¯å¸¸ã«æœ€å¾Œã«å®šç¾©ã™ã‚‹
    # 3. æ–°è¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©è¿½åŠ æ™‚ã¯ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é †åºã«æ³¨æ„ã™ã‚‹
    # è©³ç´°ã¯ doc/error_handling_guide.md ã®ã€Œãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é †åºã®å•é¡Œã€ã‚’å‚ç…§

    # âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½å¼·åŒ–ï¼ˆPhase 1å®Œäº†ï¼‰
    # - PCI DSSæº–æ‹ ã®æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ä¿è­·æ©Ÿèƒ½çµ±åˆ
    # - GDPRæº–æ‹ ã®å€‹äººæƒ…å ±ä¿è­·æ©Ÿèƒ½çµ±åˆ
    # - ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–ã®è‡ªå‹•é©ç”¨
    # - åŒ…æ‹¬çš„ãªç›£æŸ»ãƒ­ã‚°è¨˜éŒ²æ©Ÿèƒ½

    # æ©Ÿå¯†ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²ã‚’è¨­å®š
    # ãƒ¡ã‚¿èªçŸ¥: ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ãƒ»è©³ç´°è¡¨ç¤ºã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ã¿ç›£æŸ»å¯¾è±¡
    # æ¨ªå±•é–‹: ä¸€è¦§è¡¨ç¤ºï¼ˆindexï¼‰ã¯çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã®ãŸã‚ç›£æŸ»å¯¾è±¡å¤–
    audit_sensitive_access :show, :edit, :update, :destroy

    # TODO: ğŸŸ¡ Phase 3ï¼ˆä¸­ï¼‰- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ã®ç´°åˆ†åŒ–
    # å„ªå…ˆåº¦: ä¸­ï¼ˆç¾åœ¨ã®ä¸€å¾‹é©ç”¨ã¯å‹•ä½œä¸­ï¼‰
    # å®Ÿè£…å†…å®¹:
    #   - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³åˆ¥ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«å®šç¾©
    #   - æ©Ÿå¯†åº¦ã«å¿œã˜ãŸç›£æŸ»ç²’åº¦ã®èª¿æ•´
    #   - è¡¨ç¤ºå°‚ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®è‡ªå‹•åˆ¤å®š
    # ç†ç”±: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã®æœ€é©åŒ–
    # æœŸå¾…åŠ¹æœ: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã€ç›£æŸ»ãƒ­ã‚°ã®å“è³ªå‘ä¸Š
    # å·¥æ•°è¦‹ç©: 1é€±é–“
    # ä¾å­˜é–¢ä¿‚: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼å®šç¾©æ›¸ã®ç­–å®š

    # TODO: å°†æ¥çš„ãªæ©Ÿèƒ½æ‹¡å¼µ
    # - ç®¡ç†è€…æ¨©é™ãƒ¬ãƒ™ãƒ«ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆrole-based authorizationï¼‰
    # - å…±é€šã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®å®Ÿè£…
    # - å¤šè¨€èªå¯¾å¿œã®åŸºç›¤æ•´å‚™

    private

    # ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ç®¡ç†è€…æƒ…å ±ã‚’ãƒ“ãƒ¥ãƒ¼ã§å‚ç…§ã§ãã‚‹ã‚ˆã†è¨­å®š
    def set_admin_info
      return unless admin_signed_in?

      @current_admin = current_admin
      # Currentã‚¯ãƒ©ã‚¹ã«adminæƒ…å ±ã‚’è¨­å®š
      Current.admin = current_admin
    end
  end
end
