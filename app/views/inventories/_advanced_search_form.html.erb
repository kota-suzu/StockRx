<%# Bootstrap 5 é«˜åº¦æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  - StockRx å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ %>
<div class="card shadow-sm mb-4">
  <div class="card-header bg-success text-white">
    <h5 class="card-title mb-0">
      <i class="fas fa-search-plus me-2"></i>é«˜åº¦æ¤œç´¢
    </h5>
  </div>
  <div class="card-body">
    <%= form_with model: @search_form, url: inventories_path, method: :get, 
        data: { turbo_frame: "inventories_list", turbo_action: "replace" }, 
        class: "needs-validation", novalidate: true do |f| %>
      
      <%= f.hidden_field :advanced_search, value: "1" %>
      <%= f.hidden_field :search_type, value: "advanced" %>
      
      <%# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º %>
      <% if @search_form.errors.any? %>
        <div class="alert alert-danger mb-4">
          <div class="d-flex align-items-start">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <div>
              <h6 class="alert-heading">æ¤œç´¢æ¡ä»¶ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™</h6>
              <ul class="mb-0">
                <% @search_form.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      <% end %>
      
      <%# åŸºæœ¬æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <%= f.label :name, "ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰", class: "form-label fw-medium" %>
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search text-muted"></i>
            </span>
            <%= f.search_field :name, 
                placeholder: "å•†å“åãƒ»èª¬æ˜ã§æ¤œç´¢", 
                class: "form-control" %>
          </div>
        </div>
        
        <div class="col-md-4">
          <%= f.label :status, "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", class: "form-label fw-medium" %>
          <%= f.select :status, 
              options_for_select(Inventory::STATUSES.map { |k, _| [k.humanize, k] }, f.object.status), 
              { include_blank: "å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹" }, 
              class: "form-select" %>
        </div>
        
        <div class="col-md-4">
          <%= f.label :stock_filter, "åœ¨åº«çŠ¶æ…‹", class: "form-label fw-medium" %>
          <%= f.select :stock_filter, 
              options_for_select([
                ["ã™ã¹ã¦", ""],
                ["åœ¨åº«åˆ‡ã‚Œ", "out_of_stock"],
                ["ä½åœ¨åº«", "low_stock"],
                ["åœ¨åº«ã‚ã‚Š", "in_stock"]
              ], f.object.stock_filter), 
              {}, 
              class: "form-select" %>
        </div>
      </div>

      <%# ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ã«ã‚ˆã‚‹è©³ç´°æ¤œç´¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³ %>
      <div class="accordion" id="advancedSearchAccordion">
        <%# ä¾¡æ ¼ç¯„å›²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
        <div class="accordion-item">
          <h2 class="accordion-header" id="priceHeading">
            <button class="accordion-button collapsed" type="button" 
                    data-bs-toggle="collapse" data-bs-target="#priceCollapse" 
                    aria-expanded="false" aria-controls="priceCollapse">
              <i class="fas fa-yen-sign me-2"></i>ä¾¡æ ¼ç¯„å›²
            </button>
          </h2>
          <div id="priceCollapse" class="accordion-collapse collapse" 
               aria-labelledby="priceHeading" data-bs-parent="#advancedSearchAccordion">
            <div class="accordion-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <%= f.label :min_price, "æœ€ä½ä¾¡æ ¼", class: "form-label" %>
                  <div class="input-group">
                    <span class="input-group-text">ï¿¥</span>
                    <%= f.number_field :min_price, 
                        placeholder: "0", 
                        step: "0.01", 
                        class: "form-control" %>
                  </div>
                </div>
                <div class="col-md-6">
                  <%= f.label :max_price, "æœ€é«˜ä¾¡æ ¼", class: "form-label" %>
                  <div class="input-group">
                    <span class="input-group-text">ï¿¥</span>
                    <%= f.number_field :max_price, 
                        placeholder: "999999", 
                        step: "0.01", 
                        class: "form-control" %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <%# æ—¥ä»˜ç¯„å›²ã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
        <div class="accordion-item">
          <h2 class="accordion-header" id="dateHeading">
            <button class="accordion-button collapsed" type="button" 
                    data-bs-toggle="collapse" data-bs-target="#dateCollapse" 
                    aria-expanded="false" aria-controls="dateCollapse">
              <i class="fas fa-calendar me-2"></i>ç™»éŒ²æ—¥ç¯„å›²
            </button>
          </h2>
          <div id="dateCollapse" class="accordion-collapse collapse" 
               aria-labelledby="dateHeading" data-bs-parent="#advancedSearchAccordion">
            <div class="accordion-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <%= f.label :created_from, "é–‹å§‹æ—¥", class: "form-label" %>
                  <%= f.date_field :created_from, class: "form-control" %>
                </div>
                <div class="col-md-6">
                  <%= f.label :created_to, "çµ‚äº†æ—¥", class: "form-label" %>
                  <%= f.date_field :created_to, class: "form-control" %>
                </div>
              </div>
            </div>
          </div>
        </div>

        <%# ãƒãƒƒãƒï¼ˆãƒ­ãƒƒãƒˆï¼‰é–¢é€£ã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
        <div class="accordion-item">
          <h2 class="accordion-header" id="batchHeading">
            <button class="accordion-button collapsed" type="button" 
                    data-bs-toggle="collapse" data-bs-target="#batchCollapse" 
                    aria-expanded="false" aria-controls="batchCollapse">
              <i class="fas fa-barcode me-2"></i>ãƒãƒƒãƒï¼ˆãƒ­ãƒƒãƒˆï¼‰æƒ…å ±
            </button>
          </h2>
          <div id="batchCollapse" class="accordion-collapse collapse" 
               aria-labelledby="batchHeading" data-bs-parent="#advancedSearchAccordion">
            <div class="accordion-body">
              <div class="row g-3 mb-3">
                <div class="col-md-4">
                  <%= f.label :lot_code, "ãƒ­ãƒƒãƒˆã‚³ãƒ¼ãƒ‰", class: "form-label" %>
                  <%= f.text_field :lot_code, 
                      placeholder: "LOT001", 
                      class: "form-control" %>
                </div>
                <div class="col-md-4">
                  <%= f.label :expires_before, "æœŸé™æ—¥ï¼ˆä»¥å‰ï¼‰", class: "form-label" %>
                  <%= f.date_field :expires_before, class: "form-control" %>
                </div>
                <div class="col-md-4">
                  <%= f.label :expires_after, "æœŸé™æ—¥ï¼ˆä»¥é™ï¼‰", class: "form-label" %>
                  <%= f.date_field :expires_after, class: "form-control" %>
                </div>
              </div>
              
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-check">
                    <%= f.check_box :expiring_soon, 
                        { checked: f.object.expiring_soon, class: "form-check-input" }, 
                        "true", "false" %>
                    <%= f.label :expiring_soon, class: "form-check-label" do %>
                      æœŸé™åˆ‡ã‚Œé–“è¿‘ï¼ˆ
                      <%= f.number_field :expiring_days, 
                          min: 1, max: 365, 
                          value: f.object.expiring_days || 30,
                          class: "form-control form-control-sm d-inline-block mx-1", 
                          style: "width: 80px;" %>
                      æ—¥ä»¥å†…ï¼‰
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <%# å‡ºè·ãƒ»å…¥è·é–¢é€£ã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
        <div class="accordion-item">
          <h2 class="accordion-header" id="shipmentHeading">
            <button class="accordion-button collapsed" type="button" 
                    data-bs-toggle="collapse" data-bs-target="#shipmentCollapse" 
                    aria-expanded="false" aria-controls="shipmentCollapse">
              <i class="fas fa-truck me-2"></i>å‡ºè·ãƒ»å…¥è·æƒ…å ±
            </button>
          </h2>
          <div id="shipmentCollapse" class="accordion-collapse collapse" 
               aria-labelledby="shipmentHeading" data-bs-parent="#advancedSearchAccordion">
            <div class="accordion-body">
              <div class="row g-4">
                <div class="col-md-6">
                  <h6 class="fw-bold text-secondary mb-3">
                    <i class="fas fa-shipping-fast me-2"></i>å‡ºè·æƒ…å ±
                  </h6>
                  <div class="mb-3">
                    <%= f.label :shipment_status, "å‡ºè·ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", class: "form-label" %>
                    <%= f.select :shipment_status, 
                        options_for_select([
                          ["", ""],
                          ["æº–å‚™ä¸­", "preparing"],
                          ["ä¿ç•™ä¸­", "pending"],
                          ["å‡ºè·æ¸ˆã¿", "shipped"],
                          ["é…é”æ¸ˆã¿", "delivered"],
                          ["ã‚­ãƒ£ãƒ³ã‚»ãƒ«", "cancelled"]
                        ], f.object.shipment_status), 
                        {}, 
                        class: "form-select" %>
                  </div>
                  <div>
                    <%= f.label :destination, "é…é€å…ˆ", class: "form-label" %>
                    <%= f.text_field :destination, 
                        placeholder: "æ±äº¬", 
                        class: "form-control" %>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <h6 class="fw-bold text-secondary mb-3">
                    <i class="fas fa-dolly me-2"></i>å…¥è·æƒ…å ±
                  </h6>
                  <div class="mb-3">
                    <%= f.label :receipt_status, "å…¥è·ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹", class: "form-label" %>
                    <%= f.select :receipt_status, 
                        options_for_select([
                          ["", ""],
                          ["ä¿ç•™ä¸­", "pending"],
                          ["å—é ˜æ¸ˆã¿", "received"],
                          ["æ¤œæŸ»ä¸­", "inspecting"],
                          ["å´ä¸‹", "rejected"]
                        ], f.object.receipt_status), 
                        {}, 
                        class: "form-select" %>
                  </div>
                  <div>
                    <%= f.label :source, "ä»•å…¥å…ˆ", class: "form-label" %>
                    <%= f.text_field :source, 
                        placeholder: "Supplier A", 
                        class: "form-control" %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <%# ãã®ä»–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
        <div class="accordion-item">
          <h2 class="accordion-header" id="optionsHeading">
            <button class="accordion-button collapsed" type="button" 
                    data-bs-toggle="collapse" data-bs-target="#optionsCollapse" 
                    aria-expanded="false" aria-controls="optionsCollapse">
              <i class="fas fa-cogs me-2"></i>ãã®ä»–ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³
            </button>
          </h2>
          <div id="optionsCollapse" class="accordion-collapse collapse" 
               aria-labelledby="optionsHeading" data-bs-parent="#advancedSearchAccordion">
            <div class="accordion-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-check">
                    <%= f.check_box :recently_updated, 
                        { checked: f.object.recently_updated, class: "form-check-input" }, 
                        "true", "false" %>
                    <%= f.label :recently_updated, class: "form-check-label" do %>
                      æœ€è¿‘æ›´æ–°ã•ã‚ŒãŸï¼ˆ
                      <%= f.number_field :updated_days, 
                          min: 1, max: 365, 
                          value: f.object.updated_days || 7,
                          class: "form-control form-control-sm d-inline-block mx-1", 
                          style: "width: 80px;" %>
                      æ—¥ä»¥å†…ï¼‰
                    <% end %>
                  </div>
                </div>
                
                <div class="col-md-6" id="low-stock-threshold-container" 
                     style="<%= @search_form.stock_filter == 'low_stock' ? '' : 'display: none;' %>">
                  <%= f.label :low_stock_threshold, "ä½åœ¨åº«é–¾å€¤", class: "form-label" %>
                  <div class="input-group">
                    <%= f.number_field :low_stock_threshold, 
                        min: 1, 
                        value: f.object.low_stock_threshold || 10,
                        class: "form-control" %>
                    <span class="input-group-text">å€‹ä»¥ä¸‹</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <%# ã‚½ãƒ¼ãƒˆè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
        <div class="accordion-item">
          <h2 class="accordion-header" id="sortHeading">
            <button class="accordion-button collapsed" type="button" 
                    data-bs-toggle="collapse" data-bs-target="#sortCollapse" 
                    aria-expanded="false" aria-controls="sortCollapse">
              <i class="fas fa-sort me-2"></i>ä¸¦ã³é †è¨­å®š
            </button>
          </h2>
          <div id="sortCollapse" class="accordion-collapse collapse" 
               aria-labelledby="sortHeading" data-bs-parent="#advancedSearchAccordion">
            <div class="accordion-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <%= f.label :sort_field, "ä¸¦ã³æ›¿ãˆé …ç›®", class: "form-label" %>
                  <%= f.select :sort_field, 
                      options_for_select([
                        ["æ›´æ–°æ—¥æ™‚", "updated_at"],
                        ["å•†å“å", "name"],
                        ["ä¾¡æ ¼", "price"],
                        ["åœ¨åº«æ•°", "quantity"],
                        ["ä½œæˆæ—¥æ™‚", "created_at"]
                      ], f.object.sort_field || "updated_at"), 
                      {}, 
                      class: "form-select" %>
                </div>
                <div class="col-md-6">
                  <%= f.label :sort_direction, "ä¸¦ã³é †", class: "form-label" %>
                  <%= f.select :sort_direction, 
                      options_for_select([
                        ["é™é †ï¼ˆæ–°ã—ã„é †ï¼‰", "desc"],
                        ["æ˜‡é †ï¼ˆå¤ã„é †ï¼‰", "asc"]
                      ], f.object.sort_direction || "desc"), 
                      {}, 
                      class: "form-select" %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <%# ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ %>
      <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top">
        <div>
          <%= link_to inventories_path, 
              class: "btn btn-outline-secondary btn-sm" do %>
            <i class="fas fa-undo me-2"></i>æ¤œç´¢æ¡ä»¶ã‚’ãƒªã‚»ãƒƒãƒˆ
          <% end %>
        </div>
        <div class="d-flex gap-2">
          <%= link_to inventories_path, 
              class: "btn btn-outline-primary" do %>
            <i class="fas fa-search me-2"></i>ã‚·ãƒ³ãƒ—ãƒ«æ¤œç´¢ã«æˆ»ã‚‹
          <% end %>
          <%= f.submit "è©³ç´°æ¤œç´¢ã‚’å®Ÿè¡Œ", 
              class: "btn btn-success",
              data: { 
                disable_with: '<i class="fas fa-spinner fa-spin me-2"></i>æ¤œç´¢ä¸­...' 
              } %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<%# TODO: ğŸŸ¡ Phase 2 - é«˜åº¦æ¤œç´¢æ©Ÿèƒ½å¼·åŒ– %>
<%# å„ªå…ˆåº¦: ä¸­ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼‰ %>
<%# å®Ÿè£…å†…å®¹: æ¤œç´¢æ¡ä»¶ä¿å­˜ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œç´¢ %>
<%# ç†ç”±: æ¤œç´¢åŠ¹ç‡å‘ä¸Šã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“æ”¹å–„ %>
<%# æœŸå¾…åŠ¹æœ: æ¤œç´¢æ™‚é–“çŸ­ç¸®ã€ä½œæ¥­åŠ¹ç‡å‘ä¸Š %>
<%# å·¥æ•°è¦‹ç©: 2æ—¥ %>
<%# ä¾å­˜é–¢ä¿‚: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šä¿å­˜æ©Ÿèƒ½ %>

<%# TODO: ğŸŸ¡ Phase 2 - Rails ãƒ•ã‚©ãƒ¼ãƒ ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹é©ç”¨ %>
<%# å„ªå…ˆåº¦: ä¸­ï¼ˆã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Šï¼‰ %>
<%# å®Ÿè£…å†…å®¹: %>
<%#   - form_with ã®dataå±æ€§çµ±ä¸€ï¼ˆturbo_frame, turbo_actionæœ€é©åŒ–ï¼‰ %>
<%#   - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼ˆaria-describedby, aria-labelledbyçµ±ä¸€ï¼‰ %>
<%#   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–ï¼ˆHTML5ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ + Railså´æ¤œè¨¼ï¼‰ %>
<%#   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°çµ±ä¸€ï¼ˆflash message + field errorè¡¨ç¤ºï¼‰ %>
<%# ç†ç”±: ãƒ•ã‚©ãƒ¼ãƒ ä½“é¨“ã®ä¸€è²«æ€§ç¢ºä¿ã€ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š %>
<%# æœŸå¾…åŠ¹æœ: UXå‘ä¸Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã€ä¿å®ˆæ€§å‘ä¸Š %>
<%# å·¥æ•°è¦‹ç©: 2-3æ—¥ %>
<%# ä¾å­˜é–¢ä¿‚: Bootstrap 5ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½çµ±åˆ %>

<%# Bootstrap 5 JavaScriptæ©Ÿèƒ½ %>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // åœ¨åº«çŠ¶æ…‹é¸æŠã«å¿œã˜ãŸä½åœ¨åº«é–¾å€¤è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
  const stockFilter = document.getElementById('inventory_search_form_stock_filter');
  const thresholdContainer = document.getElementById('low-stock-threshold-container');
  
  if (stockFilter && thresholdContainer) {
    stockFilter.addEventListener('change', function() {
      if (this.value === 'low_stock') {
        thresholdContainer.style.display = 'block';
      } else {
        thresholdContainer.style.display = 'none';
      }
    });
  }

  // ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const forms = document.getElementsByClassName('needs-validation');
  Array.prototype.filter.call(forms, function(form) {
    form.addEventListener('submit', function(event) {
      if (form.checkValidity() === false) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
});
</script>