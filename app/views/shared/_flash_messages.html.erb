<%# ========================================== %>
<%# çµ±ä¸€ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ - StockRx %>
<%# ========================================== %>
<%# CLAUDE.mdæº–æ‹ : å…¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã§ã®ä¸€è²«ã—ãŸãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½“é¨“ %>
<%# ãƒ¡ã‚¿èªçŸ¥: Bootstrap 5ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ ã®çµ±ä¸€æ´»ç”¨ %>
<%# æ¨ªå±•é–‹: admin.html.erbã€store.html.erbã€application.html.erbç­‰ã§å…±é€šåˆ©ç”¨ %>
<%# ========================================== %>

<% if flash.any? %>
  <div class="flash-messages-container">
    <div class="<%= content_for?(:container_class) ? yield(:container_class) : 'container' %> mt-3">
      <% flash.each do |type, message| %>
        <%# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé…åˆ—ã®å ´åˆã®å¯¾å¿œ %>
        <% messages = message.is_a?(Array) ? message : [message] %>
        
        <% messages.each do |msg| %>
          <div class="alert <%= flash_alert_class(type) %> alert-dismissible fade show flash-message" 
               role="alert"
               data-flash-type="<%= type %>"
               data-auto-dismiss="<%= content_for?(:disable_auto_dismiss) ? 'false' : 'true' %>">
            
            <%# ã‚¢ãƒ©ãƒ¼ãƒˆå†…å®¹ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰ %>
            <div class="d-flex align-items-start">
              <%# ã‚¢ã‚¤ã‚³ãƒ³éƒ¨åˆ† %>
              <div class="flex-shrink-0 me-3">
                <i class="<%= flash_icon_class(type) %> fs-5" aria-hidden="true"></i>
              </div>
              
              <%# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸éƒ¨åˆ† %>
              <div class="flex-grow-1">
                <%# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ %>
                <% if content_for?(:flash_titles) && flash_title = flash_title_for(type) %>
                  <h6 class="alert-heading mb-1"><%= flash_title %></h6>
                <% end %>
                
                <%# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ¬æ–‡ %>
                <div class="flash-message-content">
                  <%= msg.html_safe if msg.respond_to?(:html_safe) %>
                </div>
                
                <%# è©³ç´°æƒ…å ±ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ %>
                <% if content_for?(:flash_details) && flash_detail = flash_detail_for(type, msg) %>
                  <small class="text-muted d-block mt-1">
                    <i class="bi bi-info-circle me-1"></i>
                    <%= flash_detail %>
                  </small>
                <% end %>
              </div>
              
              <%# é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ %>
              <button type="button" 
                      class="btn-close" 
                      data-bs-dismiss="alert" 
                      aria-label="<%= t('flash.close', default: 'é–‰ã˜ã‚‹') %>"
                      data-flash-close="<%= type %>">
              </button>
            </div>
            
            <%# ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆè‡ªå‹•æ¶ˆå¤±ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºï¼‰ %>
            <% unless content_for?(:disable_auto_dismiss) %>
              <div class="flash-progress-container mt-2">
                <div class="progress" style="height: 3px;">
                  <div class="progress-bar flash-auto-dismiss-progress"
                       role="progressbar"
                       style="width: 100%; animation: flashDismiss 5s linear;"
                       aria-valuenow="100"
                       aria-valuemin="0"
                       aria-valuemax="100">
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
  
  <%# ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨CSSï¼ˆã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ï¼‰ %>
  <style>
    .flash-messages-container {
      position: relative;
      z-index: 1040;
    }
    
    .flash-message {
      margin-bottom: 1rem;
      border-radius: var(--radius-lg, 0.5rem);
      border: none;
      border-left: 4px solid;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    
    .flash-message.show {
      animation: flashSlideIn 0.3s ease-out;
    }
    
    .flash-message:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* è‡ªå‹•æ¶ˆå¤±ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes flashDismiss {
      from { width: 100%; }
      to { width: 0%; }
    }
    
    /* ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ */
    @keyframes flashSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 767.98px) {
      .flash-message {
        margin-left: 1rem;
        margin-right: 1rem;
        border-radius: var(--radius-md, 0.375rem);
      }
      
      .flash-message .fs-5 {
        font-size: 1.1rem !important;
      }
    }
    
    /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
    @media (prefers-color-scheme: dark) {
      .flash-message {
        box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
      }
    }
    
    /* å‹•ä½œã‚’æ¸›ã‚‰ã™è¨­å®šå¯¾å¿œ */
    @media (prefers-reduced-motion: reduce) {
      .flash-message {
        animation: none;
        transition: none;
      }
      
      .flash-auto-dismiss-progress {
        animation: none;
      }
    }
    
    /* ãƒ—ãƒªãƒ³ãƒˆæ™‚ã¯éè¡¨ç¤º */
    @media print {
      .flash-messages-container {
        display: none !important;
      }
    }
  </style>
  
  <%# ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”¨JavaScriptï¼ˆè‡ªå‹•æ¶ˆå¤±ãƒ»ã‚¨ãƒ³ãƒãƒ³ã‚¹ãƒ¡ãƒ³ãƒˆï¼‰ %>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸ”” Flash messages system initialized');
      
      // è‡ªå‹•æ¶ˆå¤±æ©Ÿèƒ½
      const autoDismissMessages = document.querySelectorAll('.flash-message[data-auto-dismiss="true"]');
      
      autoDismissMessages.forEach(function(message) {
        const type = message.dataset.flashType;
        
        // ã‚¿ã‚¤ãƒ—åˆ¥ã®è‡ªå‹•æ¶ˆå¤±æ™‚é–“è¨­å®š
        let dismissTime = 5000; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5ç§’
        
        switch(type) {
          case 'alert':
          case 'error':
            dismissTime = 8000; // ã‚¨ãƒ©ãƒ¼ã¯8ç§’
            break;
          case 'notice':
          case 'success':
            dismissTime = 4000; // æˆåŠŸã¯4ç§’
            break;
          case 'warning':
            dismissTime = 6000; // è­¦å‘Šã¯6ç§’
            break;
        }
        
        // è‡ªå‹•æ¶ˆå¤±ã‚¿ã‚¤ãƒãƒ¼è¨­å®š
        setTimeout(function() {
          const bsAlert = bootstrap.Alert.getOrCreateInstance(message);
          if (bsAlert && message.classList.contains('show')) {
            console.log(`ğŸ”” Auto-dismissing flash message: ${type}`);
            bsAlert.close();
          }
        }, dismissTime);
      });
      
      // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é–‰ã˜ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆåˆ†æç”¨ï¼‰
      document.addEventListener('click', function(e) {
        if (e.target.matches('[data-flash-close]')) {
          const flashType = e.target.dataset.flashClose;
          console.log(`ğŸ”” Flash message manually closed: ${flashType}`);
        }
      });
      
      // ãƒ›ãƒãƒ¼æ™‚ã«è‡ªå‹•æ¶ˆå¤±ä¸€æ™‚åœæ­¢æ©Ÿèƒ½
      autoDismissMessages.forEach(function(message) {
        const progressBar = message.querySelector('.flash-auto-dismiss-progress');
        
        if (progressBar) {
          message.addEventListener('mouseenter', function() {
            progressBar.style.animationPlayState = 'paused';
          });
          
          message.addEventListener('mouseleave', function() {
            progressBar.style.animationPlayState = 'running';
          });
        }
      });
    });
    
    // Turboå¯¾å¿œï¼ˆãƒšãƒ¼ã‚¸é·ç§»æ™‚ã®å†åˆæœŸåŒ–ï¼‰
    document.addEventListener('turbo:load', function() {
      console.log('ğŸ”” Flash messages re-initialized for Turbo navigation');
    });
  </script>
<% end %>

<%# ========================================== %>
<%# ä½¿ç”¨æ–¹æ³•ã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºä¾‹ %>
<%# ========================================== %>

<%# 
  åŸºæœ¬ä½¿ç”¨æ–¹æ³•ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å†…ï¼‰:
  
  <%= render 'shared/flash_messages' %>
  
  ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒ†ãƒŠã‚¯ãƒ©ã‚¹æŒ‡å®š:
  
  <% content_for :container_class do %>container-fluid<% end %>
  <%= render 'shared/flash_messages' %>
  
  è‡ªå‹•æ¶ˆå¤±ç„¡åŠ¹åŒ–:
  
  <% content_for :disable_auto_dismiss do %>true<% end %>
  <%= render 'shared/flash_messages' %>
  
  ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚¿ã‚¤ãƒˆãƒ«æœ‰åŠ¹åŒ–:
  
  <% content_for :flash_titles do %>true<% end %>
  <%= render 'shared/flash_messages' %>
  
  ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã®è¤‡æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¨­å®šä¾‹:
  
  flash[:notice] = ['å•†å“ãŒæ­£å¸¸ã«ç™»éŒ²ã•ã‚Œã¾ã—ãŸ', 'åœ¨åº«ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ']
  flash[:alert] = 'å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™'
  
  HTMLå«æœ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆå®‰å…¨ã«ä½¿ç”¨ï¼‰:
  
  flash[:notice] = 'å•†å“ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<a href="/inventories">åœ¨åº«ä¸€è¦§</a>ã§ç¢ºèªã§ãã¾ã™ã€‚'.html_safe
%>

<%# ========================================== %>
<%# TODO: ğŸŸ¡ Phase 3ï¼ˆé‡è¦ï¼‰- é«˜åº¦ãªãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ©Ÿèƒ½ %>
<%# å„ªå…ˆåº¦: ä¸­ï¼ˆåŸºæœ¬çµ±åˆå®Œäº†å¾Œï¼‰ %>
<%# å®Ÿè£…å†…å®¹: %>
<%#   - ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã¨ã®çµ±åˆ %>
<%#   - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ä»˜ããƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆUndoæ©Ÿèƒ½ç­‰ï¼‰ %>
<%#   - è¤‡æ•°è¨€èªå¯¾å¿œï¼ˆi18nï¼‰ %>
<%#   - éŸ³å£°é€šçŸ¥å¯¾å¿œï¼ˆã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼‰ %>
<%#   - ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å±¥æ­´æ©Ÿèƒ½ %>
<%# æœŸå¾…åŠ¹æœ: ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šã€ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¼·åŒ– %>
<%# å·¥æ•°è¦‹ç©: 2-3æ—¥ %>
<%# ä¾å­˜é–¢ä¿‚: i18nè¨­å®šã€éŸ³å£°APIã€localStorageç®¡ç† %>
<%# ========================================== %>