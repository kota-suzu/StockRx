<%# åœ¨åº«è©³ç´° - çµ±ä¸€UIç‰ˆ %>
<div class="container-fluid py-4">
  <%# çµ±ä¸€ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ %>
  <%= render 'admin_controllers/shared/page_header',
             title: @inventory.name,
             subtitle: "æœ€çµ‚æ›´æ–°: #{l(@inventory.updated_at, format: :short) if @inventory.updated_at.present?}",
             icon: 'bi-box',
             icon_color: 'primary',
             back_path: admin_inventories_path,
             back_text: 'ä¸€è¦§ã«æˆ»ã‚‹',
             breadcrumbs: [
               { text: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', path: admin_root_path, icon: 'bi-house' },
               { text: 'åœ¨åº«ç®¡ç†', path: admin_inventories_path, icon: 'bi-box' },
               { text: @inventory.name, active: true }
             ],
             actions: [
               {
                 text: 'ç·¨é›†',
                 path: edit_admin_inventory_path(@inventory),
                 icon: 'bi-pencil',
                 class: 'btn-warning'
               },
               {
                 text: 'å‰Šé™¤',
                 path: admin_inventory_path(@inventory),
                 method: :delete,
                 icon: 'bi-trash',
                 class: 'btn-danger',
                 confirm: 'ã“ã®åœ¨åº«ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ'
               }
             ] %>

  <%# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸è¡¨ç¤º %>
  <div class="mb-4 d-flex align-items-center gap-3">
    <%= render 'admin_controllers/shared/status_badge',
               status: @inventory.status,
               type: 'status' %>
    <%= render 'admin_controllers/shared/status_badge',
               status: @inventory.alert_level,
               type: 'level' %>
  </div>

  <%# ãƒ¡ã‚¤ãƒ³æƒ…å ±ã‚«ãƒ¼ãƒ‰ç¾¤ %>
  <div class="row g-4 mb-4">
    <%# åŸºæœ¬æƒ…å ± %>
    <div class="col-lg-4">
      <div class="card admin-card h-100">
        <div class="card-header bg-primary text-white">
          <h2 class="card-title mb-0">
            <i class="bi bi-info-circle me-2"></i>åŸºæœ¬æƒ…å ±
          </h2>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="bg-light p-3 rounded">
                <h6 class="text-muted mb-1">å•†å“å</h6>
                <h4 class="mb-0"><%= @inventory.name %></h4>
              </div>
            </div>
            <div class="col-6">
              <div class="text-center">
                <div class="h5 text-success mb-1">
                  <i class="bi bi-currency-yen me-1"></i><%= number_with_delimiter(@inventory.price) %>
                </div>
                <small class="text-muted">ä¾¡æ ¼ï¼ˆå††ï¼‰</small>
              </div>
            </div>
            <div class="col-6">
              <div class="text-center">
                <div class="h5 mb-1 <%= @inventory.quantity <= 0 ? 'text-danger' : @inventory.quantity < 10 ? 'text-warning' : 'text-success' %>">
                  <i class="bi bi-boxes me-1"></i><%= @inventory.quantity %>
                </div>
                <small class="text-muted">åœ¨åº«æ•°ï¼ˆå€‹ï¼‰</small>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</span>
                <%= @inventory.status_badge %>
              </div>
            </div>
            <div class="col-12">
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted">åœ¨åº«çŠ¶æ…‹</span>
                <%= @inventory.alert_badge %>
              </div>
            </div>
            <div class="col-12">
              <small class="text-muted">
                æœ€çµ‚æ›´æ–°: <%= l(@inventory.updated_at, format: :long) if @inventory.updated_at.present? %>
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%# ãƒãƒƒãƒæƒ…å ±ã‚µãƒãƒªãƒ¼ %>
    <div class="col-lg-4">
      <div class="card admin-card h-100">
        <div class="card-header bg-info text-white">
          <h2 class="card-title mb-0">
            <i class="bi bi-layers me-2"></i>ãƒ­ãƒƒãƒˆæƒ…å ±
          </h2>
        </div>
        <div class="card-body">
          <div class="row g-3 text-center">
            <div class="col-12">
              <div class="bg-light p-3 rounded">
                <div class="h3 text-info mb-1">
                  <i class="bi bi-boxes me-1"></i><%= @inventory.batches_count %>
                </div>
                <h6 class="text-muted mb-0">ãƒ­ãƒƒãƒˆç·æ•°</h6>
              </div>
            </div>
            <div class="col-6">
              <% expired_count = @inventory.batches.select(&:expired?).count %>
              <div class="p-2 <%= expired_count > 0 ? 'bg-danger bg-opacity-10' : 'bg-light' %> rounded">
                <div class="h5 mb-1 <%= expired_count > 0 ? 'text-danger' : 'text-muted' %>">
                  <i class="bi bi-exclamation-triangle me-1"></i><%= expired_count %>
                </div>
                <small class="text-muted">æœŸé™åˆ‡ã‚Œ</small>
                <% if expired_count > 0 %>
                  <div class="mt-1">
                    <span class="badge bg-danger">è¦ç¢ºèª</span>
                  </div>
                <% end %>
              </div>
            </div>
            <div class="col-6">
              <% expiring_soon_count = @inventory.batches.select(&:expiring_soon?).count %>
              <div class="p-2 <%= expiring_soon_count > 0 ? 'bg-warning bg-opacity-10' : 'bg-light' %> rounded">
                <div class="h5 mb-1 <%= expiring_soon_count > 0 ? 'text-warning' : 'text-muted' %>">
                  <i class="bi bi-clock me-1"></i><%= expiring_soon_count %>
                </div>
                <small class="text-muted">æœŸé™é–“è¿‘</small>
                <% if expiring_soon_count > 0 %>
                  <div class="mt-1">
                    <span class="badge bg-warning">ç¢ºèªæ¨å¥¨</span>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
          <% if @inventory.batches_count > 0 %>
            <div class="mt-3">
              <div class="progress" style="height: 8px;">
                <% 
                  normal_count = @inventory.batches_count - expired_count - expiring_soon_count
                  normal_percentage = (normal_count.to_f / @inventory.batches_count * 100).round(1)
                  expiring_percentage = (expiring_soon_count.to_f / @inventory.batches_count * 100).round(1)
                  expired_percentage = (expired_count.to_f / @inventory.batches_count * 100).round(1)
                %>
                <div class="progress-bar bg-success" style="width: <%= normal_percentage %>%" title="æ­£å¸¸: <%= normal_count %>ä»¶"></div>
                <div class="progress-bar bg-warning" style="width: <%= expiring_percentage %>%" title="æœŸé™é–“è¿‘: <%= expiring_soon_count %>ä»¶"></div>
                <div class="progress-bar bg-danger" style="width: <%= expired_percentage %>%" title="æœŸé™åˆ‡ã‚Œ: <%= expired_count %>ä»¶"></div>
              </div>
              <div class="mt-1 small text-muted text-center">
                æ­£å¸¸ <%= normal_count %>ä»¶ | æœŸé™é–“è¿‘ <%= expiring_soon_count %>ä»¶ | æœŸé™åˆ‡ã‚Œ <%= expired_count %>ä»¶
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <%# æ“ä½œå±¥æ­´ãƒ»çµ±è¨ˆæƒ…å ± %>
    <div class="col-lg-4">
      <div class="card admin-card h-100">
        <div class="card-header bg-secondary text-white">
          <h2 class="card-title mb-0">
            <i class="bi bi-graph-up me-2"></i>çµ±è¨ˆãƒ»å±¥æ­´
          </h2>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12">
              <div class="alert alert-info">
                <h6 class="alert-heading">
                  <i class="fas fa-info-circle me-2"></i>çµ±è¨ˆæƒ…å ±
                </h6>
                <ul class="mb-0 small">
                  <li>å•†å“ç™»éŒ²æ—¥: <%= l(@inventory.created_at, format: :short) %></li>
                  <li>æœ€å¾Œã®æ›´æ–°: <%= l(@inventory.updated_at, format: :short) %></li>
                  <li>åœ¨åº«ID: #<%= @inventory.id %></li>
                </ul>
              </div>
            </div>
            <div class="col-12">
              <div class="alert alert-warning">
                <h6 class="alert-heading">
                  <i class="fas fa-tools me-2"></i>å°†æ¥å®Ÿè£…äºˆå®š
                </h6>
                <ul class="mb-0 small">
                  <li>åœ¨åº«ã®æ“ä½œå±¥æ­´è¡¨ç¤º</li>
                  <li>å…¥å‡ºåº«å±¥æ­´ã®è©³ç´°</li>
                  <li>å£²ä¸Šãƒ»å›è»¢ç‡çµ±è¨ˆ</li>
                  <li>ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»é€šçŸ¥è¨­å®š</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# ãƒãƒƒãƒä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ« %>
  <div class="card admin-card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2 class="card-title mb-0">
        <i class="bi bi-layers me-2"></i>ãƒ­ãƒƒãƒˆä¸€è¦§
      </h2>
      <div>
        <%# TODO: ğŸŸ¡ Phase 3ï¼ˆé‡è¦ï¼‰- ãƒãƒƒãƒè¿½åŠ ãƒ»ç·¨é›†æ©Ÿèƒ½ã®å®Ÿè£… %>
        <%# å„ªå…ˆåº¦: ä¸­ï¼ˆåœ¨åº«ç®¡ç†æ©Ÿèƒ½ã®å®Œæˆï¼‰ %>
        <%# å®Ÿè£…å†…å®¹: CRUDæ©Ÿèƒ½ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€æ¨©é™åˆ¶å¾¡ %>
        <%# æœŸå¾…åŠ¹æœ: åœ¨åº«ç®¡ç†ã®å®Œå…¨è‡ªå‹•åŒ–ã€ãƒ‡ãƒ¼ã‚¿ç²¾åº¦å‘ä¸Š %>
        <button class="btn btn-success" disabled>
          <i class="bi bi-plus me-2"></i>ãƒ­ãƒƒãƒˆè¿½åŠ 
        </button>
        <small class="text-muted ms-2">ï¼ˆå®Ÿè£…äºˆå®šï¼‰</small>
      </div>
    </div>

    <div class="card-body p-0">
      <div class="table-responsive admin-table">
        <table class="table table-hover mb-0">
          <thead class="table-dark">
            <tr>
              <th scope="col">
                <i class="bi bi-upc me-1"></i>ãƒ­ãƒƒãƒˆã‚³ãƒ¼ãƒ‰
              </th>
              <th scope="col">
                <i class="bi bi-boxes me-1"></i>æ•°é‡
              </th>
              <th scope="col">
                <i class="bi bi-percent me-1"></i>å‰²åˆ
              </th>
              <th scope="col">
                <i class="bi bi-calendar-event me-1"></i>æœ‰åŠ¹æœŸé™
              </th>
              <th scope="col">
                <i class="bi bi-traffic-light me-1"></i>çŠ¶æ…‹
              </th>
              <th scope="col" class="text-end">
                <i class="bi bi-gear me-1"></i>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
              </th>
            </tr>
          </thead>
          <tbody>
            <% if @inventory.batches.present? %>
              <% @inventory.batches.each do |batch| %>
                <tr class="<%= batch_row_class(batch) %>">
                  <td class="fw-bold">
                    <code class="text-primary"><%= batch.lot_code %></code>
                  </td>
                  <td>
                    <span class="badge bg-secondary">
                      <%= batch.quantity %> å€‹
                    </span>
                    <% if batch.quantity > 0 %>
                      <div class="progress mt-1" style="height: 5px;">
                        <div class="progress-bar bg-info" 
                             style="width: <%= lot_quantity_percentage(batch, @inventory.quantity) %>%" 
                             title="åœ¨åº«æ•°ã«å¯¾ã™ã‚‹å‰²åˆ"></div>
                      </div>
                    <% end %>
                  </td>
                  <td class="text-center">
                    <% if @inventory.quantity > 0 %>
                      <span class="badge bg-light text-dark">
                        <%= lot_quantity_percentage(batch, @inventory.quantity) %>%
                      </span>
                    <% else %>
                      <span class="text-muted">-</span>
                    <% end %>
                  </td>
                  <td>
                    <% if batch.expires_on.present? %>
                      <i class="bi bi-calendar-event me-1 text-muted"></i>
                      <%= l(batch.expires_on, format: :short) %>
                    <% else %>
                      <span class="text-muted">-</span>
                    <% end %>
                  </td>
                  <td>
                    <% if batch.expired? %>
                      <%= render 'admin_controllers/shared/status_badge',
                                 status: 'expired',
                                 text: 'æœŸé™åˆ‡ã‚Œ',
                                 type: 'level' %>
                    <% elsif batch.expiring_soon? %>
                      <%= render 'admin_controllers/shared/status_badge',
                                 status: 'expiring_soon',
                                 text: 'æœŸé™é–“è¿‘',
                                 type: 'level' %>
                    <% else %>
                      <%= render 'admin_controllers/shared/status_badge',
                                 status: 'normal',
                                 text: 'æ­£å¸¸',
                                 type: 'level' %>
                    <% end %>
                  </td>
                  <td class="text-end">
                    <%= render 'admin_controllers/shared/action_buttons',
                               buttons: [
                                 {
                                   text: 'ç·¨é›†',
                                   path: nil,
                                   icon: 'bi-pencil',
                                   class: 'btn-outline-warning',
                                   disabled: true,
                                   tooltip: 'å®Ÿè£…äºˆå®š'
                                 },
                                 {
                                   text: 'å‰Šé™¤',
                                   path: nil,
                                   icon: 'bi-trash',
                                   class: 'btn-outline-danger',
                                   disabled: true,
                                   tooltip: 'å®Ÿè£…äºˆå®š'
                                 }
                               ],
                               size: 'sm',
                               layout: 'group' %>
                  </td>
                </tr>
              <% end %>
            <% else %>
              <tr>
                <td colspan="6" class="text-center py-5">
                  <div class="text-muted">
                    <i class="bi bi-box display-4 mb-3"></i>
                    <h6>ãƒ­ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</h6>
                    <p class="mb-0">ã€Œãƒ­ãƒƒãƒˆè¿½åŠ ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ­ãƒƒãƒˆã‚’ç™»éŒ²ã—ã¦ãã ã•ã„</p>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<%# Enhanced JavaScript for interactive features %>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®åˆæœŸåŒ–ï¼ˆBootstrap 5ï¼‰
  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ãƒ›ãƒãƒ¼åŠ¹æœ
  const progressBars = document.querySelectorAll('.progress-bar');
  progressBars.forEach(bar => {
    bar.addEventListener('mouseenter', function() {
      this.style.opacity = '0.8';
    });
    bar.addEventListener('mouseleave', function() {
      this.style.opacity = '1';
    });
  });

  // ã‚«ãƒ¼ãƒ‰ã®ãƒ›ãƒãƒ¼åŠ¹æœ
  const cards = document.querySelectorAll('.card');
  cards.forEach(card => {
    card.addEventListener('mouseenter', function() {
      this.style.transform = 'translateY(-2px)';
      this.style.transition = 'all 0.2s ease-in-out';
    });
    card.addEventListener('mouseleave', function() {
      this.style.transform = 'translateY(0)';
    });
  });

  // å‰Šé™¤ãƒœã‚¿ãƒ³ã®ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°å¼·åŒ–
  const deleteButton = document.querySelector('button[formmethod="delete"]');
  if (deleteButton) {
    deleteButton.addEventListener('click', function(e) {
      e.preventDefault();
      
      const inventoryName = '<%= j(@inventory.name) %>';
      const confirmText = `å•†å“ã€Œ${inventoryName}ã€ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚é–¢é€£ã™ã‚‹ãƒ­ãƒƒãƒˆæƒ…å ±ã‚‚å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚`;
      
      if (confirm(confirmText)) {
        this.closest('form').submit();
      }
    });
  }
});
</script>

<%# TODO: ğŸŸ¡ Phase 3-4ï¼ˆé‡è¦ï¼‰- åœ¨åº«ç®¡ç†æ©Ÿèƒ½å®Œå…¨å®Ÿè£… %>
<%# å„ªå…ˆåº¦: ä¸­ï¼ˆæ©Ÿèƒ½å®Œæˆåº¦å‘ä¸Šï¼‰ %>
<%# å®Ÿè£…å†…å®¹: %>
<%#   - ãƒ­ãƒƒãƒˆCRUDæ©Ÿèƒ½ï¼ˆè¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼‰ %>
<%#   - åœ¨åº«æ“ä½œå±¥æ­´ã®è¡¨ç¤ºæ©Ÿèƒ½ %>
<%#   - åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆãƒ»é€šçŸ¥è¨­å®š %>
<%#   - åœ¨åº«çµ±è¨ˆãƒ»åˆ†ææ©Ÿèƒ½ %>
<%#   - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆPDFãƒ»Excelï¼‰ %>
<%# æœŸå¾…åŠ¹æœ: å®Œå…¨ãªåœ¨åº«ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€æ¥­å‹™åŠ¹ç‡åŒ–ã€ãƒ‡ãƒ¼ã‚¿åˆ†æå¼·åŒ– %>
<%# - ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ï¼ˆPDFãƒ»Excelï¼‰ %> 