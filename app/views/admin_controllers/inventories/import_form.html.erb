<% content_for :page_title, "CSVインポート" %>

<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="fas fa-file-csv"></i>
            在庫データCSVインポート
          </h4>
        </div>
        
        <div class="card-body">
          <%# Phase 3 開発中の通知 %>
          <div class="alert alert-info alert-dismissible fade show" role="alert">
            <i class="fas fa-info-circle"></i>
            <strong>開発中の機能</strong>
            <p class="mb-0">CSVインポート機能は現在Phase 3で実装予定です。</p>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>

          <%# TODO: Phase 3 - CSVインポートフォーム実装
              実装予定機能:
              1. ファイルアップロード
                 - ドラッグ&ドロップ対応
                 - ファイルサイズ制限表示（10MB）
                 - 対応フォーマット表示（CSV）
              
              2. インポートオプション
                 - 重複データの処理方法選択
                 - 既存データの更新/スキップ選択
                 - バリデーションエラー時の処理選択
              
              3. プレビュー機能
                 - CSVの最初の5行表示
                 - カラムマッピング確認
                 - バリデーションエラー事前表示
              
              4. 進捗表示
                 - リアルタイム進捗バー
                 - 処理件数表示
                 - エラー件数表示
          %>

          <%# 基本的なフォーム構造（プレースホルダー） %>
          <%= form_with url: import_admin_inventories_path, 
                        local: false,
                        html: { 
                          id: "csv-import-form",
                          data: { 
                            turbo: false,
                            controller: "csv-import"
                          }
                        } do |form| %>
            
            <div class="mb-4">
              <h5 class="mb-3">CSVファイル選択</h5>
              <div class="border rounded p-4 text-center bg-light">
                <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                <p class="text-muted">
                  ここにCSVファイルをドラッグ&ドロップ<br>
                  または
                </p>
                <%= form.file_field :file, 
                                   class: "form-control",
                                   accept: ".csv",
                                   disabled: true,
                                   data: { 
                                     csv_import_target: "fileInput" 
                                   } %>
                <small class="text-muted d-block mt-2">
                  最大ファイルサイズ: 10MB / 対応形式: CSV
                </small>
              </div>
            </div>

            <div class="mb-4">
              <h5 class="mb-3">インポート設定</h5>
              <div class="form-check mb-2">
                <%= form.check_box :update_existing, 
                                  class: "form-check-input",
                                  disabled: true %>
                <%= form.label :update_existing, 
                              "既存データを更新する",
                              class: "form-check-label" %>
              </div>
              <div class="form-check mb-2">
                <%= form.check_box :skip_validation_errors, 
                                  class: "form-check-input",
                                  disabled: true %>
                <%= form.label :skip_validation_errors, 
                              "エラー行をスキップして続行",
                              class: "form-check-label" %>
              </div>
            </div>

            <div class="mb-4">
              <h5 class="mb-3">CSVフォーマット</h5>
              <div class="alert alert-secondary">
                <p class="mb-2"><strong>必須カラム:</strong></p>
                <ul class="mb-0">
                  <li>name - 商品名</li>
                  <li>quantity - 在庫数</li>
                  <li>price - 価格</li>
                </ul>
              </div>
              
              <div class="d-flex justify-content-between align-items-center">
                <a href="#" class="btn btn-sm btn-outline-primary disabled">
                  <i class="fas fa-download"></i>
                  サンプルCSVダウンロード
                </a>
                <a href="#" class="btn btn-sm btn-outline-secondary disabled">
                  <i class="fas fa-question-circle"></i>
                  インポートガイド
                </a>
              </div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <%= link_to admin_inventories_path, class: "btn btn-secondary" do %>
                <i class="fas fa-arrow-left"></i>
                戻る
              <% end %>
              <%= form.submit "インポート開始", 
                             class: "btn btn-primary",
                             disabled: true,
                             data: { 
                               csv_import_target: "submitButton" 
                             } %>
            </div>
          <% end %>

          <%# TODO: Phase 3 - 進捗表示エリア
              ActionCableを使用したリアルタイム進捗表示
              - プログレスバー
              - 処理状況メッセージ
              - エラーログ表示
          %>
          <div id="import-progress" class="mt-4 d-none">
            <h5>インポート進捗</h5>
            <div class="progress mb-2">
              <div class="progress-bar progress-bar-striped progress-bar-animated" 
                   role="progressbar" 
                   style="width: 0%"
                   aria-valuenow="0" 
                   aria-valuemin="0" 
                   aria-valuemax="100">
              </div>
            </div>
            <small class="text-muted">
              <span id="processed-count">0</span> / <span id="total-count">0</span> 件処理済み
            </small>
          </div>

        </div>
      </div>

      <%# TODO: Phase 3 - サンプルデータ表示カード
          最初の数行をプレビュー表示する機能
      %>
      <div class="card shadow-sm mt-4 d-none" id="preview-card">
        <div class="card-header">
          <h5 class="mb-0">データプレビュー</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>name</th>
                  <th>quantity</th>
                  <th>price</th>
                </tr>
              </thead>
              <tbody id="preview-tbody">
                <!-- プレビューデータがここに表示される -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<%# TODO: Phase 3 - JavaScript実装
    Stimulus controllerの実装:
    - ファイルドロップ処理
    - ファイル検証（サイズ、形式）
    - CSVプレビュー機能
    - ActionCable購読
    - 進捗更新処理
    - エラーハンドリング
%>