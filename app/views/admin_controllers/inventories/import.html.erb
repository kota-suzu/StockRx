<%# CSVインポート - 管理画面 %>
<div class="container mx-auto px-4 py-8">
  <div class="flex items-center mb-6">
    <%= link_to admin_inventories_path, class: "text-blue-500 hover:text-blue-700 mr-2" do %>
      <i class="fas fa-arrow-left"></i> 一覧に戻る
    <% end %>
    <h1 class="text-2xl font-bold">CSVインポート</h1>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="md:col-span-2">
      <div class="bg-white rounded-lg shadow overflow-hidden p-6">
        <%= form_with url: import_admin_inventories_path, method: :post, multipart: true, class: "space-y-6" do |form| %>
          <div>
            <h2 class="text-lg font-medium text-gray-900 mb-4">ファイルアップロード</h2>
            <div class="border-2 border-dashed border-gray-300 rounded-md p-6">
              <div class="space-y-4">
                <div class="text-center">
                  <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z" />
                  </svg>
                  <h3 class="mt-2 text-sm font-medium text-gray-900">CSVファイルを選択</h3>
                  <p class="mt-1 text-sm text-gray-500">
                    CSVファイルをアップロードしてください（最大サイズ: 10MB）
                  </p>
                </div>
                <div class="flex justify-center">
                  <%= form.file_field :file, accept: ".csv", required: true, class: "text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none" %>
                </div>
              </div>
            </div>
          </div>
          
          <div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">オプション</h3>
            <div class="bg-gray-50 p-4 rounded-md">
              <div class="flex items-center">
                <%= form.check_box :replace_all, class: "h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" %>
                <%= form.label :replace_all, "既存データを全て置き換える（注意: 全ての既存データが削除されます）", class: "ml-2 text-sm text-gray-700" %>
              </div>
            </div>
          </div>

          <div class="flex justify-end space-x-3 pt-5">
            <%= link_to "キャンセル", admin_inventories_path, class: "py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
            <%= form.submit "インポート開始", class: "py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500", data: { turbo: false } %>
          </div>
        <% end %>
      </div>
      
      <!-- インポート進捗表示 -->
      <div id="csv-import-progress" class="mt-6 bg-white rounded-lg shadow overflow-hidden p-6 hidden" data-controller="import-progress">
        <h3 class="text-lg font-medium text-gray-900 mb-4">インポート進捗</h3>
        <div class="space-y-4">
          <div class="text-sm text-gray-600">
            ステータス: <span data-import-progress-target="status" class="font-medium">初期化中...</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-2.5">
            <div data-import-progress-target="bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
          </div>
          <div data-import-progress-target="progressText" class="text-sm text-gray-600">
            0 / 0 件の処理完了
          </div>
        </div>
      </div>
    </div>

    <div>
      <div class="bg-white rounded-lg shadow overflow-hidden p-6">
        <h2 class="text-lg font-medium text-gray-900 mb-4">CSVフォーマット</h2>
        <div class="space-y-4">
          <p class="text-sm text-gray-600">
            以下の形式でCSVファイルを作成してください。1行目はヘッダー行として処理されます。
          </p>
          
          <div class="overflow-hidden border border-gray-200 rounded-md">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">列名</th>
                  <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">説明</th>
                  <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">必須</th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <tr>
                  <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">name</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">商品名</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">必須</td>
                </tr>
                <tr>
                  <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">quantity</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">数量（整数）</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">必須</td>
                </tr>
                <tr>
                  <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">price</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">価格（整数/小数）</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">必須</td>
                </tr>
                <tr>
                  <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">status</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">ステータス（active/archived）</td>
                  <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">任意</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h3 class="text-sm font-medium text-gray-900">サンプル</h3>
          <div class="bg-gray-50 p-3 rounded-md">
            <pre class="text-xs text-gray-600 overflow-x-auto"><%= csv_sample_format %></pre>
          </div>

          <div class="bg-yellow-50 p-3 rounded-md border border-yellow-100">
            <h3 class="text-sm font-medium text-yellow-800">注意事項</h3>
            <ul class="mt-2 text-sm text-yellow-700 list-disc pl-5 space-y-1">
              <li>文字コードはUTF-8を使用してください</li>
              <li>大量データ（1万行以上）の場合、処理に時間がかかります</li>
              <li>CSV内でバリデーションエラーがある行はスキップされます</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 