<%# frozen_string_literal: true %>
<%# çµ±ä¸€ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆCLAUDE.mdæº–æ‹ ï¼‰ %>

<!--
  æ–°ã—ã„ä½¿ç”¨ä¾‹: 
  render 'admin_controllers/shared/action_buttons',
         resource: inventory,
         buttons: [:detail, :edit, :delete]
             
  ã‚«ã‚¹ã‚¿ãƒ ãƒœã‚¿ãƒ³ä¾‹:
  render 'admin_controllers/shared/action_buttons',
         resource: store,
         buttons: [
           { type: :detail, path: admin_store_path(store) },
           { type: :dashboard, path: dashboard_admin_store_path(store), text: 'åˆ†æ' },
           { type: :inventory, path: admin_store_inventories_path(store), text: 'åœ¨åº«' }
         ]
             
  ãƒ¬ã‚¬ã‚·ãƒ¼å½¢å¼ï¼ˆäº’æ›æ€§ç¶­æŒï¼‰:
  render 'admin_controllers/shared/action_buttons',
         buttons: [
           { 
             text: 'ç·¨é›†', 
             path: edit_path, 
             icon: 'bi-pencil', 
             class: 'btn-warning',
             tooltip: 'ã“ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç·¨é›†'
           }
         ],
         legacy: true

  Parameters:
  - resource: ActiveRecord object (for auto-path generation)
  - buttons: Array of button symbols or configurations
  - additional_classes: Additional CSS classes
  - legacy: Use legacy format (default: false)
-->

<%
  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
  resource ||= nil
  buttons ||= []
  additional_classes ||= ""
  legacy ||= false
  
  # ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§ãªã„å ´åˆã€æ–°ã—ã„å½¢å¼ã§ãƒœã‚¿ãƒ³ã‚’æ­£è¦åŒ–
  unless legacy
    normalized_buttons = buttons.map do |button|
      if button.is_a?(Symbol)
        # ã‚·ãƒ³ãƒ—ãƒ«ãªã‚·ãƒ³ãƒœãƒ«æŒ‡å®šã®å ´åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ä½¿ç”¨
        default_button_config(button, resource)
      elsif button.is_a?(Hash) && button[:type]
        # æ–°å½¢å¼ã®ãƒãƒƒã‚·ãƒ¥æŒ‡å®š
        default_config = default_button_config(button[:type], resource)
        default_config.merge(button)
      else
        # ãƒ¬ã‚¬ã‚·ãƒ¼å½¢å¼ã®ãƒãƒƒã‚·ãƒ¥ã¾ãŸã¯ä¸æ˜ãªå½¢å¼
        legacy_button_to_new_format(button)
      end
    end
  else
    # ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ãã®ã¾ã¾ä½¿ç”¨
    normalized_buttons = buttons.map { |button| legacy_button_to_new_format(button) }
  end
%>

<div class="action-buttons-group d-flex justify-content-center gap-1 <%= additional_classes %>" role="group" aria-label="æ“ä½œãƒœã‚¿ãƒ³">
  <% normalized_buttons.each do |btn| %>
    <% next unless btn[:path] %>
    
    <% if btn[:method] == :delete %>
      <%# Delete buttons use button_to for proper HTTP method %>
      <%= button_to btn[:path],
                   method: btn[:method],
                   form: {
                     data: {
                       turbo_confirm: btn[:confirm] || "æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ",
                       turbo_method: btn[:method]
                     }
                   },
                   class: "btn btn-#{btn[:variant]} btn-sm action-btn #{btn[:css_class]}",
                   title: btn[:tooltip],
                   data: {
                     bs_toggle: "tooltip",
                     bs_placement: "top"
                   },
                   "aria-label": btn[:aria_label] do %>
        <i class="<%= btn[:icon] %>" aria-hidden="true"></i>
        <span class="btn-text d-none d-lg-inline ms-1"><%= btn[:text] %></span>
      <% end %>
    <% else %>
      <%# Regular action buttons use link_to %>
      <%= link_to btn[:path],
                  class: "btn btn-#{btn[:variant]} btn-sm action-btn #{btn[:css_class]}",
                  title: btn[:tooltip],
                  data: {
                    bs_toggle: "tooltip",
                    bs_placement: "top"
                  },
                  "aria-label": btn[:aria_label] do %>
        <i class="<%= btn[:icon] %>" aria-hidden="true"></i>
        <span class="btn-text d-none d-lg-inline ms-1"><%= btn[:text] %></span>
      <% end %>
    <% end %>
  <% end %>
</div>

<%
  # ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰ï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒœã‚¿ãƒ³è¨­å®š
  def default_button_config(type, resource)
    resource_name = resource&.class&.name&.downcase || 'item'
    base_path = controller_path.gsub('admin_controllers/', 'admin/')
    
    case type
    when :detail
      {
        type: :detail,
        path: resource ? "/#{base_path}/#{resource.id}" : nil,
        icon: "bi bi-eye",
        text: "è©³ç´°",
        tooltip: "è©³ç´°è¡¨ç¤º",
        aria_label: "#{resource_name}ã®è©³ç´°ã‚’è¡¨ç¤º",
        variant: "primary",
        css_class: "detail-btn"
      }
    when :edit
      {
        type: :edit,
        path: resource ? "/#{base_path}/#{resource.id}/edit" : nil,
        icon: "bi bi-pencil",
        text: "ç·¨é›†",
        tooltip: "ç·¨é›†",
        aria_label: "#{resource_name}ã‚’ç·¨é›†",
        variant: "warning",
        css_class: "edit-btn"
      }
    when :delete
      {
        type: :delete,
        path: resource ? "/#{base_path}/#{resource.id}" : nil,
        icon: "bi bi-trash",
        text: "å‰Šé™¤",
        tooltip: "å‰Šé™¤",
        aria_label: "#{resource_name}ã‚’å‰Šé™¤",
        variant: "danger",
        css_class: "delete-btn",
        method: :delete,
        confirm: "#{resource&.try(:name) || resource_name}ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ"
      }
    when :dashboard
      {
        type: :dashboard,
        path: nil,
        icon: "bi bi-graph-up",
        text: "åˆ†æ",
        tooltip: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰",
        aria_label: "#{resource_name}ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º",
        variant: "info",
        css_class: "dashboard-btn"
      }
    when :inventory
      {
        type: :inventory,
        path: nil,
        icon: "bi bi-boxes",
        text: "åœ¨åº«",
        tooltip: "åœ¨åº«ä¸€è¦§",
        aria_label: "#{resource_name}ã®åœ¨åº«ä¸€è¦§ã‚’è¡¨ç¤º",
        variant: "success",
        css_class: "inventory-btn"
      }
    when :approval
      {
        type: :approval,
        path: nil,
        icon: "bi bi-check-lg",
        text: "æ‰¿èª",
        tooltip: "æ‰¿èªãƒ»å´ä¸‹",
        aria_label: "#{resource_name}ã‚’æ‰¿èªãƒ»å´ä¸‹",
        variant: "success",
        css_class: "approval-btn"
      }
    else
      {
        type: type,
        path: nil,
        icon: "bi bi-question",
        text: type.to_s.humanize,
        tooltip: type.to_s.humanize,
        aria_label: "#{type}æ“ä½œ",
        variant: "secondary",
        css_class: "#{type}-btn"
      }
    end
  end

  # ãƒ¬ã‚¬ã‚·ãƒ¼å½¢å¼ã‚’æ–°å½¢å¼ã«å¤‰æ›
  def legacy_button_to_new_format(button)
    return button unless button.is_a?(Hash)
    
    {
      type: :custom,
      path: button[:path],
      icon: button[:icon],
      text: button[:text] || 'Action',
      tooltip: button[:tooltip],
      aria_label: button[:tooltip] || button[:text] || 'Action',
      variant: extract_variant_from_class(button[:class]) || 'secondary',
      css_class: button[:class] || '',
      method: button[:method],
      confirm: button[:confirm]
    }
  end

  # Bootstrapã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒãƒªã‚¢ãƒ³ãƒˆIDã‚’æŠ½å‡º
  def extract_variant_from_class(css_class)
    return nil unless css_class
    
    if css_class.include?('primary')
      'primary'
    elsif css_class.include?('warning')
      'warning'
    elsif css_class.include?('danger')
      'danger'
    elsif css_class.include?('success')
      'success'
    elsif css_class.include?('info')
      'info'
    else
      'secondary'
    end
  end
%>

<%# çµ±ä¸€ã•ã‚ŒãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ« %>
<style>
  /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
  .action-buttons-group {
    min-width: 120px;
  }
  
  .action-btn {
    min-width: 38px;
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.375rem 0.5rem;
    font-size: 0.875rem;
    border-radius: 0.375rem;
    transition: all 0.15s ease-in-out;
    position: relative;
  }
  
  /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—è¡¨ç¤ºï¼šã‚¢ã‚¤ã‚³ãƒ³ + ãƒ†ã‚­ã‚¹ãƒˆ */
  @media (min-width: 992px) {
    .action-btn {
      min-width: 70px;
      padding: 0.375rem 0.75rem;
    }
  }
  
  /* Bootstrap 5æ–°æ©Ÿèƒ½ï¼šãƒœã‚¿ãƒ³ãƒãƒªã‚¢ãƒ³ãƒˆæ¯ã®ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
  .detail-btn:hover, .detail-btn:focus {
    background-color: var(--bs-primary-border-subtle);
    border-color: var(--bs-primary-border-subtle);
    transform: translateY(-1px);
    box-shadow: var(--bs-box-shadow);
  }
  
  .edit-btn:hover, .edit-btn:focus {
    background-color: var(--bs-warning-border-subtle);
    border-color: var(--bs-warning-border-subtle);
    transform: translateY(-1px);
    box-shadow: var(--bs-box-shadow);
  }
  
  .delete-btn:hover, .delete-btn:focus {
    background-color: var(--bs-danger-border-subtle);
    border-color: var(--bs-danger-border-subtle);
    transform: translateY(-1px);
    box-shadow: var(--bs-box-shadow-lg);
  }
  
  .dashboard-btn:hover, .dashboard-btn:focus {
    background-color: var(--bs-info-border-subtle);
    border-color: var(--bs-info-border-subtle);
    transform: translateY(-1px);
    box-shadow: var(--bs-box-shadow);
  }
  
  .inventory-btn:hover, .inventory-btn:focus {
    background-color: var(--bs-success-border-subtle);
    border-color: var(--bs-success-border-subtle);
    transform: translateY(-1px);
    box-shadow: var(--bs-box-shadow);
  }
  
  .approval-btn:hover, .approval-btn:focus {
    background-color: var(--bs-success-border-subtle);
    border-color: var(--bs-success-border-subtle);
    transform: translateY(-1px);
    box-shadow: var(--bs-box-shadow);
  }
  
  /* ãƒ•ã‚©ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã®èª¿æ•´ */
  .action-buttons-group form {
    display: inline-block;
    margin: 0;
  }
  
  .action-buttons-group form .btn {
    margin: 0;
  }
  
  /* ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼šãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¡¨ç¤ºã®å¼·åŒ– */
  .action-btn:focus {
    outline: 2px solid var(--bs-primary);
    outline-offset: 2px;
  }
  
  /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼šã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ã§ã®ã‚¿ãƒƒãƒ—é ˜åŸŸç¢ºä¿ */
  @media (max-width: 991.98px) {
    .action-btn {
      min-width: 44px;
      height: 44px;
      margin: 0 1px;
    }
    
    .btn-text {
      display: none !important;
    }
  }
</style>

<%# TODO: ğŸŸ¡ Phase 3ï¼ˆé‡è¦ï¼‰- é«˜åº¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³æ©Ÿèƒ½æ‹¡å¼µ %>
<%# å„ªå…ˆåº¦: ä¸­ï¼ˆé–‹ç™ºåŠ¹ç‡å‘ä¸Šï¼‰ %>
<%# å®Ÿè£…å†…å®¹: %>
<%#   - æ¡ä»¶åˆ†å²ã«ã‚ˆã‚‹å‹•çš„ãƒœã‚¿ãƒ³è¡¨ç¤º/éè¡¨ç¤ºåˆ¶å¾¡ %>
<%#   - æ¨©é™ãƒ™ãƒ¼ã‚¹ã®ãƒœã‚¿ãƒ³è¡¨ç¤ºåˆ¶å¾¡ï¼ˆAdmin.can_? ãƒ¡ã‚½ãƒƒãƒ‰é€£æºï¼‰ %>
<%#   - ä¸€æ‹¬æ“ä½œãƒœã‚¿ãƒ³ç¾¤ã¨ã®çµ±åˆ %>
<%#   - ã‚«ã‚¹ã‚¿ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ãƒ”ãƒŠãƒ¼ã€ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºï¼‰ %>
<%#   - ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ç®¡ç†ï¼ˆloadingã€disabledã€successçŠ¶æ…‹ï¼‰ %>
<%# æœŸå¾…åŠ¹æœ: é–‹ç™ºåŠ¹ç‡30%å‘ä¸Šã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å¼·åŒ–ã€æ¨©é™åˆ¶å¾¡ã®è‡ªå‹•åŒ– %>

<%# TODO: ğŸŸ¢ Phase 4ï¼ˆæ¨å¥¨ï¼‰- ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ»å›½éš›åŒ–å¯¾å¿œ %>
<%# å„ªå…ˆåº¦: ä¸­ï¼ˆåŒ…æ‹¬çš„è¨­è¨ˆå¯¾å¿œï¼‰ %>
<%# å®Ÿè£…å†…å®¹: %>
<%#   - å¤šè¨€èªå¯¾å¿œï¼ˆi18nï¼‰ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ %>
<%#   - ãƒã‚¤ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ %>
<%#   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ– %>
<%#   - éŸ³å£°èª­ã¿ä¸Šã’æœ€é©åŒ– %>
<%#   - RTLï¼ˆå³ã‹ã‚‰å·¦ï¼‰è¨€èªå¯¾å¿œ %>
<%# æœŸå¾…åŠ¹æœ: WCAG 2.1 AAæº–æ‹ ã€å›½éš›å±•é–‹å¯¾å¿œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼å±¤æ‹¡å¤§ %>