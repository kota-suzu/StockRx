<%# ğŸª åº—èˆ—ãƒ•ã‚©ãƒ¼ãƒ å…±é€šéƒ¨å“ - Phase 2: Multi-Store Management %>
<%= form_with model: [:admin, store], local: true, class: "row g-3" do |form| %>
  <%# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º %>
  <% if store.errors.any? %>
    <div class="col-12">
      <div class="alert alert-danger" role="alert">
        <h5 class="alert-heading">
          <i class="bi bi-exclamation-triangle me-2" aria-hidden="true"></i>
          å…¥åŠ›å†…å®¹ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™
        </h5>
        <ul class="mb-0">
          <% store.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <%# åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-bottom">
        <h6 class="mb-0 fw-bold">
          <i class="bi bi-info-circle me-2" aria-hidden="true"></i>
          åŸºæœ¬æƒ…å ±
        </h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <%# åº—èˆ—å %>
          <div class="col-md-6">
            <%= form.label :name, "åº—èˆ—å", class: "form-label" %>
            <span class="text-danger">*</span>
            <%= form.text_field :name, 
                               class: "form-control #{'is-invalid' if store.errors[:name].any?}",
                               placeholder: "ä¾‹: ä¸­å¤®è–¬å±€",
                               required: true,
                               maxlength: 100 %>
            <% if store.errors[:name].any? %>
              <div class="invalid-feedback">
                <%= store.errors[:name].first %>
              </div>
            <% end %>
          </div>

          <%# åº—èˆ—ã‚³ãƒ¼ãƒ‰ %>
          <div class="col-md-6">
            <%= form.label :code, "åº—èˆ—ã‚³ãƒ¼ãƒ‰", class: "form-label" %>
            <span class="text-danger">*</span>
            <%= form.text_field :code, 
                               class: "form-control #{'is-invalid' if store.errors[:code].any?}",
                               placeholder: "ä¾‹: ST001",
                               required: true,
                               maxlength: 20,
                               pattern: "[A-Za-z0-9_-]+",
                               title: "è‹±æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨å¯èƒ½" %>
            <% if store.errors[:code].any? %>
              <div class="invalid-feedback">
                <%= store.errors[:code].first %>
              </div>
            <% else %>
              <div class="form-text">è‹±æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿ä½¿ç”¨å¯èƒ½</div>
            <% end %>
          </div>

          <%# åº—èˆ—ç¨®åˆ¥ %>
          <div class="col-md-6">
            <%= form.label :store_type, "åº—èˆ—ç¨®åˆ¥", class: "form-label" %>
            <span class="text-danger">*</span>
            <%= form.select :store_type,
                           options_for_select([
                             ["è–¬å±€", "pharmacy"],
                             ["å€‰åº«", "warehouse"],
                             ["æœ¬éƒ¨", "headquarters"]
                           ], store.store_type),
                           { prompt: "åº—èˆ—ç¨®åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„" },
                           { class: "form-select #{'is-invalid' if store.errors[:store_type].any?}",
                             required: true } %>
            <% if store.errors[:store_type].any? %>
              <div class="invalid-feedback">
                <%= store.errors[:store_type].first %>
              </div>
            <% end %>
          </div>

          <%# åœ°åŸŸ %>
          <div class="col-md-6">
            <%= form.label :region, "åœ°åŸŸ", class: "form-label" %>
            <%= form.text_field :region, 
                               class: "form-control",
                               placeholder: "ä¾‹: æ±äº¬éƒ½",
                               maxlength: 50 %>
            <div class="form-text">éƒ½é“åºœçœŒåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
          </div>

          <%# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ %>
          <div class="col-md-12">
            <div class="form-check form-switch">
              <%= form.check_box :active, 
                                class: "form-check-input",
                                id: "store_active" %>
              <%= form.label :active, "ã“ã®åº—èˆ—ã‚’æœ‰åŠ¹ã«ã™ã‚‹", class: "form-check-label", for: "store_active" %>
            </div>
            <div class="form-text">ç„¡åŠ¹ã«ã™ã‚‹ã¨ã€åœ¨åº«ç§»å‹•ã‚„æ–°è¦åœ¨åº«è¿½åŠ ãŒã§ããªããªã‚Šã¾ã™</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# é€£çµ¡å…ˆæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-white border-bottom">
        <h6 class="mb-0 fw-bold">
          <i class="bi bi-telephone me-2" aria-hidden="true"></i>
          é€£çµ¡å…ˆæƒ…å ±
        </h6>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <%# ä½æ‰€ %>
          <div class="col-12">
            <%= form.label :address, "ä½æ‰€", class: "form-label" %>
            <%= form.text_area :address, 
                              class: "form-control",
                              placeholder: "ä¾‹: æ±äº¬éƒ½æ¸¯åŒºèµ¤å‚1-1-1",
                              rows: 3 %>
          </div>

          <%# é›»è©±ç•ªå· %>
          <div class="col-md-6">
            <%= form.label :phone, "é›»è©±ç•ªå·", class: "form-label" %>
            <%= form.telephone_field :phone, 
                                    class: "form-control #{'is-invalid' if store.errors[:phone].any?}",
                                    placeholder: "ä¾‹: 03-1234-5678",
                                    maxlength: 20 %>
            <% if store.errors[:phone].any? %>
              <div class="invalid-feedback">
                <%= store.errors[:phone].first %>
              </div>
            <% end %>
          </div>

          <%# ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ %>
          <div class="col-md-6">
            <%= form.label :email, "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", class: "form-label" %>
            <%= form.email_field :email, 
                                class: "form-control #{'is-invalid' if store.errors[:email].any?}",
                                placeholder: "ä¾‹: store@example.com",
                                maxlength: 100 %>
            <% if store.errors[:email].any? %>
              <div class="invalid-feedback">
                <%= store.errors[:email].first %>
              </div>
            <% end %>
          </div>

          <%# åº—èˆ—è²¬ä»»è€…å %>
          <div class="col-md-6">
            <%= form.label :manager_name, "åº—èˆ—è²¬ä»»è€…å", class: "form-label" %>
            <%= form.text_field :manager_name, 
                               class: "form-control",
                               placeholder: "ä¾‹: ç”°ä¸­å¤ªéƒ",
                               maxlength: 50 %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ %>
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <%= link_to "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", 
                       store.persisted? ? admin_store_path(store) : admin_stores_path,
                       class: "btn btn-outline-secondary" %>
          </div>
          <div>
            <%= form.submit store.persisted? ? "æ›´æ–°ã™ã‚‹" : "ä½œæˆã™ã‚‹",
                           class: "btn btn-admin-primary",
                           data: { 
                             confirm: store.persisted? ? "åº—èˆ—æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™ã‹ï¼Ÿ" : "æ–°ã—ã„åº—èˆ—ã‚’ä½œæˆã—ã¾ã™ã‹ï¼Ÿ",
                             disable_with: "å‡¦ç†ä¸­..."
                           } %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>

<%# ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« %>
<style>
  .btn-admin-primary {
    background-color: var(--admin-primary);
    border-color: var(--admin-primary);
    color: white;
  }
  
  .btn-admin-primary:hover {
    background-color: var(--admin-primary-dark, #0056b3);
    border-color: var(--admin-primary-dark, #0056b3);
  }
  
  .form-check-input:checked {
    background-color: var(--admin-primary);
    border-color: var(--admin-primary);
  }
  
  .is-invalid {
    border-color: #dc3545;
  }
  
  .invalid-feedback {
    display: block;
  }
</style>

<%# ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ JavaScript %>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åº—èˆ—ã‚³ãƒ¼ãƒ‰æ¤œè¨¼
    const codeInput = document.querySelector('#store_code');
    if (codeInput) {
      codeInput.addEventListener('input', function() {
        const value = this.value;
        const isValid = /^[A-Za-z0-9_-]*$/.test(value);
        
        if (!isValid && value.length > 0) {
          this.classList.add('is-invalid');
        } else {
          this.classList.remove('is-invalid');
        }
      });
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‰ã®æœ€çµ‚æ¤œè¨¼
    const form = document.querySelector('form');
    if (form) {
      form.addEventListener('submit', function(e) {
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
          if (!field.value.trim()) {
            field.classList.add('is-invalid');
            isValid = false;
          } else {
            field.classList.remove('is-invalid');
          }
        });
        
        if (!isValid) {
          e.preventDefault();
          alert('å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        }
      });
    }
  });
</script>