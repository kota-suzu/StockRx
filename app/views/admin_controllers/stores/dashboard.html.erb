<%# ­ЪЈф т║ЌУѕЌсЃђсЃЃсѓисЃЦсЃюсЃ╝сЃЅ - Phase 2: Multi-Store Management %>
<div class="container-fluid py-4">
  <%# сЃЉсЃ│сЂЈсЂџсЃісЃЊсѓ▓сЃ╝сѓисЃДсЃ│ %>
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <%= link_to admin_stores_path, class: "text-decoration-none" do %>
          <i class="bi bi-shop me-1" aria-hidden="true"></i>т║ЌУѕЌу«Ауљє
        <% end %>
      </li>
      <li class="breadcrumb-item">
        <%= link_to admin_store_path(@store), class: "text-decoration-none" do %>
          <%= @store.name %>
        <% end %>
      </li>
      <li class="breadcrumb-item active" aria-current="page">сЃђсЃЃсѓисЃЦсЃюсЃ╝сЃЅ</li>
    </ol>
  </nav>

  <%# сЃђсЃЃсѓисЃЦсЃюсЃ╝сЃЅсЃўсЃЃсЃђсЃ╝ %>
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <div class="row align-items-center">
            <div class="col-lg-8">
              <div class="d-flex align-items-center mb-2">
                <div class="store-dashboard-icon me-3">
                  <% if @store.pharmacy? %>
                    <i class="bi bi-hospital text-admin-primary"></i>
                  <% elsif @store.warehouse? %>
                    <i class="bi bi-building text-info"></i>
                  <% else %>
                    <i class="bi bi-building-check text-success"></i>
                  <% end %>
                </div>
                <div>
                  <h1 class="h2 mb-1 fw-bold"><%= @store.name %> сЃђсЃЃсѓисЃЦсЃюсЃ╝сЃЅ</h1>
                  <p class="text-muted mb-0">
                    сЃфсѓбсЃФсѓ┐сѓцсЃат║ЌУѕЌсЃЉсЃЋсѓЕсЃ╝сЃъсЃ│сѓ╣сЃ╗тюет║ФуЏБУдќ
                    <span class="badge bg-success ms-2">
                      <i class="bi bi-circle-fill text-success me-1" style="font-size: 8px;" aria-hidden="true"></i>
                      сѓфсЃ│сЃЕсѓцсЃ│
                    </span>
                  </p>
                </div>
              </div>
            </div>
            <div class="col-lg-4 text-lg-end mt-3 mt-lg-0">
              <div class="d-flex flex-column align-items-lg-end">
                <small class="text-muted mb-1">
                  <i class="bi bi-clock me-1" aria-hidden="true"></i>
                  ТюђухѓТЏ┤Тќ░: <%= l(Time.current, format: :short) %>
                </small>
                <div class="efficiency-score">
                  <span class="badge bg-admin-primary fs-6">
                    ті╣ујЄсѓ╣сѓ│сѓб: <%= @dashboard_stats[:efficiency_score] %>%
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# KPIух▒УеѕсѓФсЃ╝сЃЅ %>
  <div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="icon-lg mb-3 mx-auto bg-primary-subtle text-primary rounded-circle d-flex align-items-center justify-content-center">
            <i class="bi bi-boxes" aria-hidden="true"></i>
          </div>
          <h3 class="fw-bold text-primary mb-1"><%= @dashboard_stats[:total_items] %></h3>
          <p class="text-muted small mb-2">уиЈтюет║ФсѓбсѓцсЃєсЃа</p>
          <div class="progress" style="height: 4px;">
            <div class="progress-bar bg-primary" 
                 role="progressbar" 
                 style="width: <%= [@dashboard_stats[:total_items] * 2, 100].min %>%"
                 aria-valuenow="<%= @dashboard_stats[:total_items] %>" 
                 aria-valuemin="0" 
                 aria-valuemax="50"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="icon-lg mb-3 mx-auto bg-success-subtle text-success rounded-circle d-flex align-items-center justify-content-center">
            <i class="bi bi-currency-yen" aria-hidden="true"></i>
          </div>
          <h3 class="fw-bold text-success mb-1">┬Ц<%= number_with_delimiter(@dashboard_stats[:total_value]) %></h3>
          <p class="text-muted small mb-2">уиЈтюет║ФСЙАтђц</p>
          <div class="d-flex justify-content-between small text-muted">
            <span>тѕЕућетЈ»УЃй: ┬Ц<%= number_with_delimiter(@dashboard_stats[:available_value]) %></span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="icon-lg mb-3 mx-auto bg-warning-subtle text-warning rounded-circle d-flex align-items-center justify-content-center">
            <i class="bi bi-exclamation-triangle" aria-hidden="true"></i>
          </div>
          <h3 class="fw-bold text-warning mb-1"><%= @dashboard_stats[:low_stock_count] %></h3>
          <p class="text-muted small mb-2">Сйјтюет║ФсѓбсЃЕсЃ╝сЃѕ</p>
          <div class="d-flex justify-content-between small text-muted">
            <span>тЇ▒жЎ║: <%= @dashboard_stats[:critical_stock_count] %></span>
            <span>тюет║ФтѕЄсѓї: <%= @dashboard_stats[:out_of_stock_count] %></span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-lg-3 col-md-6 mb-3">
      <div class="card border-0 shadow-sm h-100">
        <div class="card-body text-center">
          <div class="icon-lg mb-3 mx-auto bg-info-subtle text-info rounded-circle d-flex align-items-center justify-content-center">
            <i class="bi bi-arrow-repeat" aria-hidden="true"></i>
          </div>
          <h3 class="fw-bold text-info mb-1"><%= @dashboard_stats[:transfers_completed_today] %></h3>
          <p class="text-muted small mb-2">ТюгТЌЦт«їС║єуД╗тІЋ</p>
          <div class="d-flex justify-content-between small text-muted">
            <span>т╣│тЮЄТЎѓжќЊ: <%= @dashboard_stats[:average_transfer_time] %>h</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# сЃАсѓцсЃ│сѓ│сЃ│сЃєсЃ│сЃёсѓесЃфсѓб %>
  <div class="row">
    <%# тидсѓФсЃЕсЃа: сѓбсЃЕсЃ╝сЃѕсЃ╗уД╗тІЋућ│УФІ %>
    <div class="col-lg-8">
      <%# Сйјтюет║ФсѓбсЃЕсЃ╝сЃѕ %>
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold text-warning">
              <i class="bi bi-exclamation-triangle me-2" aria-hidden="true"></i>
              Сйјтюет║ФсѓбсЃЕсЃ╝сЃѕ
            </h5>
            <span class="badge bg-warning text-dark"><%= @low_stock_items.count %>С╗Х</span>
          </div>
        </div>
        <div class="card-body p-0">
          <% if @low_stock_items.any? %>
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th scope="col" class="ps-4">тЋєтЊЂтљЇ</th>
                    <th scope="col">уЈЙтюетюет║Ф</th>
                    <th scope="col">т«ЅтЁетюет║Ф</th>
                    <th scope="col">сѓ╣сЃєсЃ╝сѓ┐сѓ╣</th>
                    <th scope="col" class="text-center pe-4">сѓбсѓ»сѓисЃДсЃ│</th>
                  </tr>
                </thead>
                <tbody>
                  <% @low_stock_items.each do |item| %>
                    <tr>
                      <td class="ps-4">
                        <div class="fw-bold"><%= item.inventory.name %></div>
                        <small class="text-muted">
                          <%= item.inventory.code if item.inventory.respond_to?(:code) %>
                        </small>
                      </td>
                      <td>
                        <span class="fw-bold text-<%= item.quantity == 0 ? 'danger' : 'warning' %>">
                          <%= item.quantity %>
                        </span>
                        <% if item.reserved_quantity > 0 %>
                          <small class="text-muted d-block">С║ѕу┤ё: <%= item.reserved_quantity %></small>
                        <% end %>
                      </td>
                      <td><%= item.safety_stock_level %></td>
                      <td>
                        <% case item.stock_level_status %>
                        <% when :out_of_stock %>
                          <span class="badge bg-danger">тюет║ФтѕЄсѓї</span>
                        <% when :critical %>
                          <span class="badge bg-danger">тЇ▒жЎ║</span>
                        <% when :low %>
                          <span class="badge bg-warning text-dark">Сйјтюет║Ф</span>
                        <% end %>
                      </td>
                      <td class="text-center pe-4">
                        <%= link_to new_admin_inter_store_transfer_path(
                                      source_store_id: @store.id,
                                      inventory_id: item.inventory.id
                                    ),
                                   class: "btn btn-sm btn-outline-primary",
                                   title: "уД╗тІЋућ│УФІ" do %>
                          <i class="bi bi-plus-circle" aria-hidden="true"></i>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="text-center py-4">
              <div class="icon-lg mb-3 text-success">РюЁ</div>
              <h6 class="text-success mb-2">Сйјтюет║ФсѓбсЃЕсЃ╝сЃѕсЂфсЂЌ</h6>
              <p class="text-muted small">сЂЎсЂ╣сЂдсЂ«сѓбсѓцсЃєсЃасЂїт«ЅтЁетюет║ФсЃгсЃЎсЃФС╗ЦСИісѓњуХГТїЂсЂЌсЂдсЂёсЂЙсЂЎсђѓ</p>
            </div>
          <% end %>
        </div>
      </div>

      <%# уД╗тІЋућ│УФІуіХТ│Ђ %>
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0 fw-bold">
              <i class="bi bi-arrow-repeat me-2" aria-hidden="true"></i>
              С┐ЮуЋЎСИГсЂ«уД╗тІЋућ│УФІ
            </h5>
            <span class="badge bg-info"><%= @pending_transfers.count %>С╗Х</span>
          </div>
        </div>
        <div class="card-body p-0">
          <% if @pending_transfers.any? %>
            <div class="list-group list-group-flush">
              <% @pending_transfers.each do |transfer| %>
                <div class="list-group-item border-0 px-3 py-2">
                  <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                      <div class="fw-bold small">
                        <i class="bi bi-arrow-right text-primary me-1"></i>
                        Рєњ <%= transfer.destination_store.name %>
                      </div>
                      <div class="text-muted small">
                        <%= transfer.inventory.name %> ├Ќ <%= transfer.quantity %>
                      </div>
                      <div class="text-muted small">
                        <%= time_ago_in_words(transfer.requested_at) %>тЅЇ
                      </div>
                    </div>
                    <span class="badge bg-warning text-dark small">
                      ТЅ┐УфЇтЙЁсЂА
                    </span>
                  </div>
                </div>
              <% end %>
            </div>
          <% else %>
            <div class="text-center py-4">
              <div class="icon-lg mb-3 text-muted">­ЪЊІ</div>
              <h6 class="text-muted mb-2">С┐ЮуЋЎСИГсЂ«уД╗тІЋућ│УФІсЂфсЂЌ</h6>
              <p class="text-muted small">уЈЙтюесђЂТЅ┐УфЇтЙЁсЂАсЂ«уД╗тІЋућ│УФІсЂ»сЂѓсѓісЂЙсЂЏсѓЊсђѓ</p>
            </div>
          <% end %>
        </div>
        <div class="card-footer bg-white border-top">
          <%= link_to admin_inter_store_transfers_path(store_id: @store.id),
                     class: "btn btn-sm btn-outline-primary w-100" do %>
            сЂЎсЂ╣сЂдсЂ«уД╗тІЋт▒ЦТГ┤сѓњУАеуц║
          <% end %>
        </div>
      </div>
    </div>

    <%# тЈ│сѓФсЃЕсЃа: сЃЉсЃЋсѓЕсЃ╝сЃъсЃ│сѓ╣ТїЄТеЎсЃ╗сѓ»сѓцсЃЃсѓ»сѓбсѓ»сѓисЃДсЃ│ %>
    <div class="col-lg-4">
      <%# сЃЉсЃЋсѓЕсЃ╝сЃъсЃ│сѓ╣ТїЄТеЎ %>
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <h6 class="mb-0 fw-bold">
            <i class="bi bi-graph-up me-2" aria-hidden="true"></i>
            сЃЉсЃЋсѓЕсЃ╝сЃъсЃ│сѓ╣ТїЄТеЎ
          </h6>
        </div>
        <div class="card-body">
          <div class="performance-metric mb-3">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <span class="small text-muted">тюет║ФтЏъУ╗бујЄ</span>
              <span class="fw-bold"><%= @dashboard_stats[:inventory_turnover_rate].round(1) %>тЏъ/т╣┤</span>
            </div>
            <div class="progress" style="height: 6px;">
              <div class="progress-bar bg-success" 
                   role="progressbar" 
                   style="width: <%= [@dashboard_stats[:inventory_turnover_rate] * 20, 100].min %>%"
                   aria-valuenow="<%= @dashboard_stats[:inventory_turnover_rate] %>" 
                   aria-valuemin="0" 
                   aria-valuemax="5"></div>
            </div>
          </div>
          
          <div class="performance-metric mb-3">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <span class="small text-muted">тюет║Фті╣ујЄ</span>
              <span class="fw-bold">
                <%= ((@dashboard_stats[:available_value].to_f / @dashboard_stats[:total_value]) * 100).round(1) %>%
              </span>
            </div>
            <div class="progress" style="height: 6px;">
              <div class="progress-bar bg-info" 
                   role="progressbar" 
                   style="width: <%= ((@dashboard_stats[:available_value].to_f / @dashboard_stats[:total_value]) * 100).round(1) %>%"></div>
            </div>
          </div>
          
          <div class="performance-metric">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <span class="small text-muted">ті╣ујЄсѓ╣сѓ│сѓб</span>
              <span class="fw-bold text-admin-primary"><%= @dashboard_stats[:efficiency_score] %>%</span>
            </div>
            <div class="progress" style="height: 6px;">
              <div class="progress-bar bg-admin-primary" 
                   role="progressbar" 
                   style="width: <%= @dashboard_stats[:efficiency_score] %>%"
                   aria-valuenow="<%= @dashboard_stats[:efficiency_score] %>" 
                   aria-valuemin="0" 
                   aria-valuemax="100"></div>
            </div>
          </div>
        </div>
      </div>

      <%# сѓ»сѓцсЃЃсѓ»сѓбсѓ»сѓисЃДсЃ│ %>
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-white border-bottom">
          <h6 class="mb-0 fw-bold">
            <i class="bi bi-lightning me-2" aria-hidden="true"></i>
            сѓ»сѓцсЃЃсѓ»сѓбсѓ»сѓисЃДсЃ│
          </h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <%= link_to new_admin_inter_store_transfer_path(source_store_id: @store.id),
                       class: "btn btn-admin-primary btn-sm" do %>
              <i class="bi bi-plus-circle me-1" aria-hidden="true"></i>
              уД╗тІЋућ│УФІсѓњСйюТѕљ
            <% end %>
            <%= link_to admin_store_path(@store),
                       class: "btn btn-outline-primary btn-sm" do %>
              <i class="bi bi-eye me-1" aria-hidden="true"></i>
              т║ЌУѕЌУЕ│у┤░сѓњУАеуц║
            <% end %>
            <% if current_admin.can_manage_store?(@store) %>
              <%= link_to edit_admin_store_path(@store),
                         class: "btn btn-outline-warning btn-sm" do %>
                <i class="bi bi-pencil me-1" aria-hidden="true"></i>
                т║ЌУѕЌТЃЁта▒сѓњуиежЏє
              <% end %>
            <% end %>
            <%= link_to admin_inter_store_transfers_path(source_store_id: @store.id),
                       class: "btn btn-outline-info btn-sm" do %>
              <i class="bi bi-list me-1" aria-hidden="true"></i>
              уД╗тІЋт▒ЦТГ┤сѓњУАеуц║
            <% end %>
          </div>
        </div>
      </div>

      <%# жђ▒жќЊсЃЉсЃЋсѓЕсЃ╝сЃъсЃ│сѓ╣ТдѓУдЂ %>
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom">
          <h6 class="mb-0 fw-bold">
            <i class="bi bi-calendar-week me-2" aria-hidden="true"></i>
            жђ▒жќЊсЃЉсЃЋсѓЕсЃ╝сЃъсЃ│сѓ╣
          </h6>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <div class="border-end pe-3">
                <div class="h4 fw-bold text-success mb-1">
                  <%= @weekly_performance[:outgoing_transfers]&.values&.sum || 0 %>
                </div>
                <div class="small text-muted">жђЂтЄ║уД╗тІЋ</div>
              </div>
            </div>
            <div class="col-6">
              <div class="ps-3">
                <div class="h4 fw-bold text-info mb-1">
                  <%= @weekly_performance[:incoming_transfers]&.values&.sum || 0 %>
                </div>
                <div class="small text-muted">тЈЌтЁЦуД╗тІЋ</div>
              </div>
            </div>
          </div>
          <hr class="my-3">
          <div class="text-center">
            <small class="text-muted">жЂјтј╗7ТЌЦжќЊсЂ«т«ЪуИЙ</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%# сѓФсѓ╣сѓ┐сЃасѓ╣сѓ┐сѓцсЃФ %>
<style>
  .store-dashboard-icon {
    font-size: 48px;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(13, 110, 253, 0.1), rgba(220, 53, 69, 0.1));
    border-radius: 50%;
  }
  
  .icon-lg {
    width: 64px;
    height: 64px;
    font-size: 28px;
  }
  
  .efficiency-score .badge {
    font-size: 0.8rem;
    padding: 0.5rem 0.75rem;
  }
  
  .performance-metric .progress {
    border-radius: 3px;
  }
  
  .btn-admin-primary {
    background-color: var(--admin-primary);
    border-color: var(--admin-primary);
    color: white;
  }
  
  .btn-admin-primary:hover {
    background-color: var(--admin-primary-dark, #0056b3);
    border-color: var(--admin-primary-dark, #0056b3);
  }
  
  .progress-bar.bg-admin-primary {
    background-color: var(--admin-primary) !important;
  }
</style>

<%# УЄфтІЋТЏ┤Тќ░JavaScript№╝ѕPhase 3сЂДт«ЪУБЁС║ѕт«џ№╝Ѕ %>
<script>
  // TODO: ­ЪЪА Phase 3№╝ѕСИГ№╝Ѕ- сЃфсѓбсЃФсѓ┐сѓцсЃаТЏ┤Тќ░ТЕЪУЃй
  // тёфтЁѕт║д: СИГ№╝ѕсЃдсЃ╝сѓХсЃ╝СйЊжеЊтљЉСИі№╝Ѕ
  // т«ЪУБЁтєЁт«╣: ActionCableсЂФсѓѕсѓІсЃфсѓбсЃФсѓ┐сѓцсЃатюет║ФсЃ╗уД╗тІЋуіХТ│ЂТЏ┤Тќ░
  // ТюЪтЙЁті╣Тъю: ТюђТќ░ТЃЁта▒сЂ«уб║т«ЪсЂфТііТЈАсђЂТёЈТђЮТ▒║т«џсЂ«У┐ЁжђЪтїќ
  
  document.addEventListener('DOMContentLoaded', function() {
    // УЄфтІЋТЏ┤Тќ░ТЕЪУЃйсЂ«сЃЌсЃгсЃ╝сѓ╣сЃЏсЃФсЃђсЃ╝
    console.log('Store Dashboard loaded for <%= @store.name %>');
  });
</script>