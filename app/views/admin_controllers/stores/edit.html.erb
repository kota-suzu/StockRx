<%# ğŸª åº—èˆ—æƒ…å ±ç·¨é›† - Phase 2: Multi-Store Management %>
<div class="container-fluid py-4">
  <%# çµ±ä¸€ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ - UIä¸€è²«æ€§å‘ä¸Š %>
  <% 
    # åº—èˆ—ã‚¿ã‚¤ãƒ—åˆ¥ã®ã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²ã®å‹•çš„è¨­å®š
    store_icon = @store.pharmacy? ? 'bi-hospital' : (@store.warehouse? ? 'bi-building' : 'bi-building-check')
    store_color = @store.pharmacy? ? 'primary' : (@store.warehouse? ? 'info' : 'success')
  %>
  
  <%= render 'shared/admin/page_header',
             title: "#{@store.name} ã®ç·¨é›†",
             subtitle: "åº—èˆ—æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™ï¼ˆåº—èˆ—ã‚³ãƒ¼ãƒ‰: #{@store.code}ï¼‰",
             icon: store_icon,
             icon_color: store_color,
             back_path: admin_store_path(@store),
             back_text: 'è©³ç´°ã«æˆ»ã‚‹',
             breadcrumbs: [
               { text: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', path: admin_root_path, icon: 'bi-house' },
               { text: 'åº—èˆ—ç®¡ç†', path: admin_stores_path, icon: 'bi-shop' },
               { text: @store.name, path: admin_store_path(@store) },
               { text: 'ç·¨é›†', active: true }
             ],
             actions: [
               { text: 'è©³ç´°è¡¨ç¤º', path: admin_store_path(@store), icon: 'bi-eye', class: 'btn-outline-primary' },
               { text: 'ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰', path: dashboard_admin_store_path(@store), icon: 'bi-graph-up', class: 'btn-outline-info' }
             ] %>

  <%# ç·¨é›†æ³¨æ„äº‹é … %>
  <div class="row mb-4">
    <div class="col-12">
      <div class="alert alert-warning border-0" role="alert">
        <div class="d-flex">
          <div class="flex-shrink-0">
            <i class="bi bi-exclamation-triangle fs-4" aria-hidden="true"></i>
          </div>
          <div class="flex-grow-1 ms-3">
            <h5 class="alert-heading">ç·¨é›†æ™‚ã®æ³¨æ„äº‹é …</h5>
            <p class="mb-2">åº—èˆ—æƒ…å ±ã‚’å¤‰æ›´ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®ç‚¹ã«ã”æ³¨æ„ãã ã•ã„ï¼š</p>
            <ul class="mb-0">
              <li><strong>åº—èˆ—ã‚³ãƒ¼ãƒ‰</strong>ã®å¤‰æ›´ã¯æ—¢å­˜ã®åœ¨åº«ç§»å‹•å±¥æ­´ã«å½±éŸ¿ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™</li>
              <li><strong>åº—èˆ—ç¨®åˆ¥</strong>ã®å¤‰æ›´ã¯æ¨©é™ãƒ»æ©Ÿèƒ½åˆ¶é™ã«å½±éŸ¿ã—ã¾ã™</li>
              <li><strong>éæœ‰åŠ¹åŒ–</strong>ã™ã‚‹ã¨æ–°è¦åœ¨åº«ç§»å‹•ãŒã§ããªããªã‚Šã¾ã™</li>
              <li>é‡è¦ãªå¤‰æ›´ã¯äº‹å‰ã«é–¢ä¿‚è€…ã«é€šçŸ¥ã—ã¦ãã ã•ã„</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <%# ãƒ•ã‚©ãƒ¼ãƒ  %>
  <div class="row">
    <div class="col-12">
      <%= render 'form', store: @store %>
    </div>
  </div>

  <%# å±é™ºãªæ“ä½œã‚»ã‚¯ã‚·ãƒ§ãƒ³ %>
  <% if current_admin.headquarters_admin? %>
    <div class="row mt-4">
      <div class="col-12">
        <div class="card border-danger">
          <div class="card-header bg-danger-subtle border-danger">
            <h6 class="mb-0 fw-bold text-danger">
              <i class="bi bi-exclamation-triangle me-2" aria-hidden="true"></i>
              å±é™ºãªæ“ä½œ
            </h6>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-8">
                <h6 class="fw-bold text-danger">åº—èˆ—ã‚’å‰Šé™¤</h6>
                <p class="text-muted small mb-0">
                  ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚åº—èˆ—ã«é–¢é€£ã™ã‚‹åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã€ç§»å‹•å±¥æ­´ã€ç®¡ç†è€…æƒ…å ±ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚
                  å‰Šé™¤å‰ã«é‡è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚
                </p>
              </div>
              <div class="col-md-4 text-md-end mt-3 mt-md-0">
                <%= link_to admin_store_path(@store),
                           method: :delete,
                           class: "btn btn-danger",
                           data: {
                             confirm: "æœ¬å½“ã«ã€Œ#{@store.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚\n- åœ¨åº«ãƒ‡ãƒ¼ã‚¿ãŒã™ã¹ã¦å‰Šé™¤ã•ã‚Œã¾ã™\n- ç§»å‹•å±¥æ­´ãŒå‰Šé™¤ã•ã‚Œã¾ã™\n- é–¢é€£ã™ã‚‹ç®¡ç†è€…ãŒç„¡åŠ¹ã«ãªã‚Šã¾ã™\n\nå‰Šé™¤ã™ã‚‹å ´åˆã¯ã€Œ#{@store.name}ã€ã¨å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚"
                           } do %>
                  <i class="bi bi-trash me-1" aria-hidden="true"></i>
                  åº—èˆ—ã‚’å‰Šé™¤
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <%# é–¢é€£æƒ…å ± %>
  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom">
          <h6 class="mb-0 fw-bold">
            <i class="bi bi-info-circle me-2" aria-hidden="true"></i>
            é–¢é€£ãƒ‡ãƒ¼ã‚¿
          </h6>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-4">
              <div class="h4 fw-bold text-primary"><%= @store.store_inventories.count %></div>
              <div class="small text-muted">åœ¨åº«ã‚¢ã‚¤ãƒ†ãƒ </div>
            </div>
            <div class="col-4">
              <div class="h4 fw-bold text-info"><%= @store.admins.count %></div>
              <div class="small text-muted">ç®¡ç†è€…</div>
            </div>
            <div class="col-4">
              <div class="h4 fw-bold text-success">
                <%= @store.outgoing_transfers.count + @store.incoming_transfers.count %>
              </div>
              <div class="small text-muted">ç§»å‹•å±¥æ­´</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-6 mt-3 mt-md-0">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom">
          <h6 class="mb-0 fw-bold">
            <i class="bi bi-clock-history me-2" aria-hidden="true"></i>
            æ›´æ–°å±¥æ­´
          </h6>
        </div>
        <div class="card-body">
          <div class="small text-muted">
            <div class="mb-2">
              <strong>ä½œæˆæ—¥æ™‚:</strong> <%= l(@store.created_at, format: :long) %>
            </div>
            <div class="mb-2">
              <strong>æœ€çµ‚æ›´æ–°:</strong> <%= l(@store.updated_at, format: :long) %>
            </div>
            <% if @store.created_at != @store.updated_at %>
              <div class="mb-2">
                <strong>æ›´æ–°å›æ•°:</strong> 
                <%= time_ago_in_words(@store.updated_at) %>å‰ã«æ›´æ–°
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%# ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« %>
<style>
  .store-edit-icon {
    font-size: 48px;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(13, 110, 253, 0.1), rgba(220, 53, 69, 0.1));
    border-radius: 50%;
  }
  
  .text-admin-primary {
    color: var(--admin-primary) !important;
  }
  
  .bg-danger-subtle {
    background-color: rgba(220, 53, 69, 0.1) !important;
  }
</style>

<%# å‰Šé™¤ç¢ºèªã®å¼·åŒ– JavaScript %>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // å‰Šé™¤ãƒœã‚¿ãƒ³ã®è¿½åŠ ç¢ºèª
    const deleteButton = document.querySelector('[data-confirm*="å‰Šé™¤"]');
    if (deleteButton) {
      deleteButton.addEventListener('click', function(e) {
        e.preventDefault();
        
        const storeName = '<%= @store.name %>';
        const userInput = prompt(`å±é™ºãªæ“ä½œã§ã™ã€‚å‰Šé™¤ã‚’ç¶šè¡Œã™ã‚‹ã«ã¯åº—èˆ—åã€Œ${storeName}ã€ã‚’æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„:`);
        
        if (userInput === storeName) {
          if (confirm('æœ€çµ‚ç¢ºèª: ã“ã®åº—èˆ—ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚')) {
            // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = this.href;
            
            const methodInput = document.createElement('input');
            methodInput.type = 'hidden';
            methodInput.name = '_method';
            methodInput.value = 'DELETE';
            
            const tokenInput = document.createElement('input');
            tokenInput.type = 'hidden';
            tokenInput.name = 'authenticity_token';
            tokenInput.value = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            
            form.appendChild(methodInput);
            form.appendChild(tokenInput);
            document.body.appendChild(form);
            form.submit();
          }
        } else if (userInput !== null) {
          alert('åº—èˆ—åãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚å‰Šé™¤ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚');
        }
      });
    }
  });
</script>