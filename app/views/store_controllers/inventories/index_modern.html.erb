<%# 店舗在庫一覧ビュー - Bootstrap Modern UI %>
<%# CLAUDE.md準拠: 最新Bootstrap 5 + モダンUIデザインシステム %>
<%# メタ認知: 店舗スタッフの作業効率とユーザビリティを重視 %>
<%# 横展開: 全店舗画面で統一されたモダンUI体験 %>

<% content_for :title, "在庫管理" %>

<!-- ページヘッダー - Bootstrap 5 モダンデザイン -->
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <!-- ページタイトルエリア -->
      <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 p-4 bg-white rounded-3 shadow-sm border">
        <div class="mb-3 mb-lg-0">
          <div class="d-flex align-items-center mb-2">
            <div class="icon-wrapper bg-light text-primary rounded-circle p-3 me-3 border border-primary border-opacity-25">
              <i class="bi bi-box-seam fs-4"></i>
            </div>
            <div>
              <h1 class="h2 mb-1 fw-bold text-dark">在庫管理</h1>
              <p class="text-muted mb-0 fs-6">
                <i class="bi bi-geo-alt me-1"></i>
                <% if @authenticated_access && current_store %>
                  <%= current_store.name %> の在庫状況
                <% else %>
                  公開在庫情報
                <% end %>
              </p>
            </div>
          </div>
        </div>
        
        <!-- アクションボタングループ -->
        <div class="d-flex flex-column flex-sm-row gap-2">
          <!-- CSVエクスポートボタン -->
          <% if @authenticated_access && current_store %>
            <%= link_to "/store/inventories.csv?#{request.query_string}", 
                        class: "btn btn-success d-flex align-items-center",
                        title: "在庫データをCSVファイルでダウンロード",
                        data: { 
                          bs_toggle: "tooltip", 
                          bs_placement: "bottom",
                          confirm: "在庫データ（#{@store_inventories.total_count}件）をCSVでダウンロードしますか？"
                        } do %>
              <i class="bi bi-download me-2"></i>
              <span>CSVエクスポート</span>
            <% end %>
          <% else %>
            <button class="btn btn-success d-flex align-items-center" disabled title="ログインが必要です">
              <i class="bi bi-download me-2"></i>
              <span>CSVエクスポート</span>
            </button>
          <% end %>
          
          <!-- 在庫調整ボタン -->
          <% if @authenticated_access && current_store %>
            <button class="btn btn-primary d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#bulkAdjustModal">
              <i class="bi bi-clipboard-check me-2"></i>
              <span>一括調整</span>
            </button>
          <% else %>
            <button class="btn btn-primary d-flex align-items-center" disabled title="ログインが必要です">
              <i class="bi bi-clipboard-check me-2"></i>
              <span>一括調整</span>
            </button>
          <% end %>
          
          <!-- 更新ボタン -->
          <button class="btn btn-outline-primary d-flex align-items-center" onclick="location.reload()">
            <i class="bi bi-arrow-clockwise me-2"></i>
            <span class="d-none d-sm-inline">更新</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 統計サマリーカード - モダンデザイン -->
  <% if @authenticated_access && @statistics %>
  <div class="row g-4 mb-4">
    <div class="col-sm-6 col-xl-3">
      <div class="card border-0 shadow-sm h-100 position-relative overflow-hidden">
        <div class="card-body p-4">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="bg-light text-primary rounded-circle p-3 border border-primary border-opacity-25">
                <i class="bi bi-boxes fs-3"></i>
              </div>
            </div>
            <div class="flex-grow-1">
              <div class="h3 mb-1 fw-bold text-primary"><%= number_with_delimiter(@statistics[:total_items]) %></div>
              <div class="text-muted fw-medium">商品種類</div>
              <div class="progress mt-2" style="height: 4px;">
                <div class="progress-bar bg-primary" style="width: 100%;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="position-absolute bottom-0 end-0 p-3 opacity-25">
          <i class="bi bi-boxes" style="font-size: 3rem;"></i>
        </div>
      </div>
    </div>
    
    <div class="col-sm-6 col-xl-3">
      <div class="card border-0 shadow-sm h-100 position-relative overflow-hidden">
        <div class="card-body p-4">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="bg-success bg-opacity-10 text-success rounded-circle p-3">
                <i class="bi bi-stack fs-3"></i>
              </div>
            </div>
            <div class="flex-grow-1">
              <div class="h3 mb-1 fw-bold text-success"><%= number_with_delimiter(@statistics[:total_quantity]) %></div>
              <div class="text-muted fw-medium">総在庫数</div>
              <div class="progress mt-2" style="height: 4px;">
                <div class="progress-bar bg-success" style="width: 85%;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="position-absolute bottom-0 end-0 p-3 opacity-25">
          <i class="bi bi-stack" style="font-size: 3rem;"></i>
        </div>
      </div>
    </div>
    
    <div class="col-sm-6 col-xl-3">
      <div class="card border-0 shadow-sm h-100 position-relative overflow-hidden">
        <div class="card-body p-4">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="bg-info bg-opacity-10 text-info rounded-circle p-3">
                <i class="bi bi-currency-yen fs-3"></i>
              </div>
            </div>
            <div class="flex-grow-1">
              <div class="h3 mb-1 fw-bold text-info">¥<%= number_with_delimiter(@statistics[:total_value]) %></div>
              <div class="text-muted fw-medium">総在庫金額</div>
              <div class="progress mt-2" style="height: 4px;">
                <div class="progress-bar bg-info" style="width: 70%;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="position-absolute bottom-0 end-0 p-3 opacity-25">
          <i class="bi bi-currency-yen" style="font-size: 3rem;"></i>
        </div>
      </div>
    </div>
    
    <div class="col-sm-6 col-xl-3">
      <div class="card border-0 shadow-sm h-100 position-relative overflow-hidden">
        <div class="card-body p-4">
          <div class="d-flex align-items-center">
            <div class="me-3">
              <div class="bg-warning bg-opacity-10 text-warning rounded-circle p-3">
                <i class="bi bi-exclamation-triangle fs-3"></i>
              </div>
            </div>
            <div class="flex-grow-1">
              <div class="h3 mb-1 fw-bold text-warning"><%= @statistics[:low_stock_percentage] %>%</div>
              <div class="text-muted fw-medium">低在庫率</div>
              <div class="progress mt-2" style="height: 4px;">
                <div class="progress-bar bg-warning" style="width: <%= @statistics[:low_stock_percentage] %>%;"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="position-absolute bottom-0 end-0 p-3 opacity-25">
          <i class="bi bi-exclamation-triangle" style="font-size: 3rem;"></i>
        </div>
      </div>
    </div>
  </div>
  <% end %>

  <!-- 検索・フィルターカード - モダンデザイン -->
  <div class="row">
    <div class="col-12">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-gradient-info text-white border-bottom" style="background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%) !important;">
          <div class="d-flex align-items-center">
            <div class="bg-white bg-opacity-20 text-white rounded-circle p-2 me-3 border border-white border-opacity-50">
              <i class="bi bi-funnel fs-5"></i>
            </div>
            <div class="flex-grow-1">
              <h5 class="card-title mb-0 fw-bold text-white">検索・フィルター</h5>
              <small class="text-white text-opacity-75">商品名、メーカー、在庫数で絞り込み</small>
            </div>
            <button class="btn btn-outline-light btn-sm text-white border-white border-opacity-50" type="button" data-bs-toggle="collapse" data-bs-target="#searchFilters" aria-expanded="true">
              <i class="bi bi-chevron-down"></i>
            </button>
          </div>
        </div>
        <div class="collapse show" id="searchFilters">
          <div class="card-body p-4">
            <%= form_with url: "/store/inventories", method: :get, local: true, class: "row g-3", data: { turbo_frame: "inventory_list" } do |f| %>
              <div class="col-lg-4">
                <label class="form-label fw-medium text-dark">
                  <i class="bi bi-search me-1"></i>商品名検索
                </label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-end-0">
                    <i class="bi bi-box text-muted"></i>
                  </span>
                  <%= f.text_field "q[name_cont]", 
                                   placeholder: "商品名を入力...", 
                                   class: "form-control border-start-0 bg-white text-dark", 
                                   style: "background-color: #ffffff !important; color: #1a1a1a !important;",
                                   value: params.dig(:q, :name_cont) %>
                </div>
              </div>
              
              <div class="col-lg-3">
                <label class="form-label fw-medium text-dark">
                  <i class="bi bi-building me-1"></i>メーカー
                </label>
                <%= f.select "q[manufacturer_eq]", 
                             options_for_select([['すべてのメーカー', '']] + @manufacturers.map { |m| [m, m] },
                                               params.dig(:q, :manufacturer_eq)),
                             {},
                             { class: "form-select bg-white text-dark", 
                               style: "background-color: #ffffff !important; color: #1a1a1a !important;" } %>
              </div>
              
              <div class="col-lg-3">
                <label class="form-label fw-medium text-dark">
                  <i class="bi bi-traffic-light me-1"></i>在庫状態
                </label>
                <%= f.select "q[stock_level_eq]", 
                             options_for_select([['すべての状態', '']] + @stock_levels,
                                               params.dig(:q, :stock_level_eq)),
                             {},
                             { class: "form-select bg-white text-dark", 
                               style: "background-color: #ffffff !important; color: #1a1a1a !important;" } %>
              </div>
              
              <div class="col-lg-3">
                <label class="form-label fw-medium text-dark">
                  <i class="bi bi-stack me-1"></i>在庫数範囲
                </label>
                <div class="input-group">
                  <%= f.number_field "q[quantity_gteq]", 
                                     placeholder: "最小値", 
                                     class: "form-control bg-white text-dark",
                                     style: "background-color: #ffffff !important; color: #1a1a1a !important; min-width: 80px;",
                                     value: params.dig(:q, :quantity_gteq) %>
                  <span class="input-group-text bg-light px-2">〜</span>
                  <%= f.number_field "q[quantity_lteq]", 
                                     placeholder: "最大値", 
                                     class: "form-control bg-white text-dark",
                                     style: "background-color: #ffffff !important; color: #1a1a1a !important; min-width: 80px;",
                                     value: params.dig(:q, :quantity_lteq) %>
                </div>
              </div>
              
              <div class="col-12">
                <div class="d-flex flex-column flex-sm-row gap-2 pt-3 border-top">
                  <div class="flex-grow-1">
                    <small class="text-muted">
                      <i class="bi bi-info-circle me-1"></i>
                      リアルタイム検索に対応しています
                    </small>
                  </div>
                  <div class="d-flex gap-2">
                    <%= f.submit "検索実行", class: "btn btn-primary d-flex align-items-center", 
                                                    data: { bs_toggle: "tooltip", title: "現在の条件で検索" } do %>
                      <i class="bi bi-search me-2"></i>検索
                    <% end %>
                    <%= link_to "/store/inventories", class: "btn btn-outline-secondary d-flex align-items-center",
                                                       data: { bs_toggle: "tooltip", title: "すべての条件をクリア" } do %>
                      <i class="bi bi-arrow-counterclockwise me-2"></i>リセット
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 在庫一覧テーブル - モダンデザイン -->
  <div class="row">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom">
          <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center">
            <div class="d-flex align-items-center mb-2 mb-lg-0">
              <div class="bg-primary bg-opacity-10 text-primary rounded-circle p-2 me-3">
                <i class="bi bi-list fs-5"></i>
              </div>
              <div>
                <h5 class="card-title mb-0 fw-bold">在庫一覧</h5>
                <small class="text-muted">
                  <i class="bi bi-info-circle me-1"></i>
                  <%= @store_inventories.total_count %>件中 
                  <%= @store_inventories.offset_value + 1 %>-<%= [@store_inventories.offset_value + @store_inventories.limit_value, @store_inventories.total_count].min %>件を表示
                </small>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0 table-modern">
              <thead class="bg-light">
                <tr>
                  <th class="border-0 py-3 px-4">
                    <%= link_to "/store/inventories?#{params.permit!.merge(sort: 'inventories.name', direction: sort_direction == 'asc' ? 'desc' : 'asc').to_query}", 
                                class: "text-decoration-none d-flex align-items-center fw-semibold" do %>
                      <i class="bi bi-box me-2 text-primary"></i>商品名
                      <% if params[:sort] == 'inventories.name' %>
                        <i class="bi bi-chevron-<%= sort_direction == 'asc' ? 'up' : 'down' %> ms-1 text-primary"></i>
                      <% else %>
                        <i class="bi bi-chevron-expand ms-1 text-muted opacity-50"></i>
                      <% end %>
                    <% end %>
                  </th>
                  <th class="border-0 py-3 px-4">
                    <%= link_to "/store/inventories?#{params.permit!.merge(sort: 'quantity', direction: sort_direction == 'asc' ? 'desc' : 'asc').to_query}", 
                                class: "text-decoration-none d-flex align-items-center fw-semibold" do %>
                      <i class="bi bi-stack me-2 text-success"></i>在庫数
                      <% if params[:sort] == 'quantity' %>
                        <i class="bi bi-chevron-<%= sort_direction == 'asc' ? 'up' : 'down' %> ms-1 text-primary"></i>
                      <% else %>
                        <i class="bi bi-chevron-expand ms-1 text-muted opacity-50"></i>
                      <% end %>
                    <% end %>
                  </th>
                  <th class="border-0 py-3 px-4 text-center">
                    <div class="d-flex align-items-center justify-content-center">
                      <i class="bi bi-shield-check me-2 text-info"></i>
                      <span class="fw-semibold">安全在庫</span>
                    </div>
                  </th>
                  <th class="border-0 py-3 px-4">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-currency-yen me-2 text-warning"></i>
                      <span class="fw-semibold">単価</span>
                    </div>
                  </th>
                  <th class="border-0 py-3 px-4">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-traffic-light me-2 text-danger"></i>
                      <span class="fw-semibold">状態</span>
                    </div>
                  </th>
                  <th class="border-0 py-3 px-4">
                    <div class="d-flex align-items-center">
                      <i class="bi bi-clock me-2 text-secondary"></i>
                      <span class="fw-semibold">回転日数</span>
                    </div>
                  </th>
                  <th class="border-0 py-3 px-4 text-end">
                    <div class="d-flex align-items-center justify-content-end">
                      <i class="bi bi-gear me-2 text-secondary"></i>
                      <span class="fw-semibold">アクション</span>
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <% if @store_inventories.present? %>
                  <% @store_inventories.each_with_index do |store_inventory, index| %>
                    <tr class="border-bottom">
                      <td class="py-3 px-4">
                        <div class="d-flex align-items-center">
                          <div class="bg-primary bg-opacity-10 rounded-circle p-2 me-3">
                            <i class="bi bi-box text-primary"></i>
                          </div>
                          <div class="flex-grow-1">
                            <div class="fw-bold text-dark mb-1">
                              <%= link_to store_inventory.inventory.name, 
                                          "/store/inventories/#{store_inventory.inventory.id}", 
                                          class: "text-decoration-none text-dark hover-text-primary" %>
                            </div>
                            <% if store_inventory.inventory.manufacturer.present? %>
                              <div class="d-flex align-items-center text-muted small">
                                <i class="bi bi-building me-1"></i>
                                <span><%= store_inventory.inventory.manufacturer %></span>
                              </div>
                            <% end %>
                            <% if index < 3 %>
                              <span class="badge bg-warning bg-opacity-10 text-warning small mt-1">HOT</span>
                            <% end %>
                          </div>
                        </div>
                      </td>
                      
                      <td class="py-3 px-4">
                        <div class="d-flex align-items-center">
                          <div class="me-3">
                            <div class="h5 mb-0 fw-bold text-success">
                              <%= number_with_delimiter(store_inventory.quantity) %>
                            </div>
                            <small class="text-muted">個</small>
                          </div>
                          <div class="flex-grow-1">
                            <% if store_inventory.quantity > 0 %>
                              <% percentage = [(store_inventory.quantity.to_f / ([store_inventory.safety_stock_level * 2, 1].max) * 100), 100].min %>
                              <div class="progress" style="height: 6px;">
                                <% 
                                  bar_class = case percentage
                                  when 0..30 then "bg-danger"
                                  when 31..60 then "bg-warning"
                                  else "bg-success"
                                  end
                                %>
                                <div class="progress-bar <%= bar_class %>" style="width: <%= percentage %>%"></div>
                              </div>
                              <small class="text-muted"><%= percentage.round(1) %>% 安全水準</small>
                            <% else %>
                              <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-danger" style="width: 100%"></div>
                              </div>
                              <small class="text-danger">在庫切れ</small>
                            <% end %>
                          </div>
                        </div>
                      </td>
                      
                      <td class="py-3 px-4 text-center">
                        <% 
                          safety_level = store_inventory.safety_stock_level
                          badge_data = case safety_level
                                       when 0..5 then { class: "bg-danger", icon: "exclamation-triangle", text: "低水準" }
                                       when 6..10 then { class: "bg-warning", icon: "dash-circle", text: "注意" }
                                       when 11..20 then { class: "bg-info", icon: "check-circle", text: "適正" }
                                       else { class: "bg-success", icon: "shield-check", text: "十分" }
                                       end
                        %>
                        <div class="d-flex flex-column align-items-center">
                          <span class="badge <%= badge_data[:class] %> bg-opacity-10 text-<%= badge_data[:class].split('-').last %> fw-bold px-3 py-2 mb-2">
                            <i class="bi bi-<%= badge_data[:icon] %> me-1"></i><%= number_with_delimiter(safety_level) %> 個
                          </span>
                          <small class="text-muted"><%= badge_data[:text] %></small>
                        </div>
                      </td>
                      
                      <td class="py-3 px-4">
                        <div class="d-flex flex-column justify-content-center">
                          <span class="h6 mb-0 fw-bold text-success">
                            ¥<%= number_with_delimiter(store_inventory.inventory.price.to_i) %>
                          </span>
                        </div>
                      </td>
                      
                      <td class="py-3 px-4">
                        <% badge = stock_level_badge(store_inventory) %>
                        <span class="<%= badge[:class] %> fw-medium"><%= badge[:text] %></span>
                      </td>
                      
                      <td class="py-3 px-4">
                        <div class="d-flex flex-column">
                          <span class="fw-bold text-dark">
                            <%= turnover_days(store_inventory) %>
                          </span>
                          <small class="text-muted">日</small>
                        </div>
                      </td>
                      
                      <td class="py-3 px-4 text-end">
                        <div class="d-flex gap-1 justify-content-end">
                          <!-- 詳細ボタン -->
                          <%= link_to "/store/inventories/#{store_inventory.inventory.id}", 
                                      class: "btn btn-outline-primary btn-sm d-flex align-items-center",
                                      title: "在庫詳細情報と履歴を確認",
                                      data: { bs_toggle: "tooltip", bs_placement: "top" } do %>
                            <i class="bi bi-eye"></i>
                            <span class="d-none d-xl-inline ms-1">詳細</span>
                          <% end %>
                          
                          <!-- 調整ボタン -->
                          <% if @authenticated_access && current_store %>
                            <%= link_to adjust_form_store_inventory_path(store_inventory.inventory),
                                        class: "btn btn-outline-warning btn-sm d-flex align-items-center",
                                        title: "在庫数量を調整（棚卸し対応）",
                                        data: { bs_toggle: "tooltip", bs_placement: "top" } do %>
                              <i class="bi bi-pencil"></i>
                              <span class="d-none d-xl-inline ms-1">調整</span>
                            <% end %>
                          <% else %>
                            <button class="btn btn-outline-warning btn-sm d-flex align-items-center" 
                                    disabled 
                                    title="ログインが必要です"
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="top">
                              <i class="bi bi-pencil"></i>
                              <span class="d-none d-xl-inline ms-1">調整</span>
                            </button>
                          <% end %>
                          
                          <!-- 移動ボタン -->
                          <% if @authenticated_access && current_store %>
                            <%= link_to request_transfer_form_store_inventory_path(store_inventory.inventory),
                                        class: "btn btn-outline-info btn-sm d-flex align-items-center",
                                        title: "他店舗への移動申請を作成",
                                        data: { bs_toggle: "tooltip", bs_placement: "top" } do %>
                              <i class="bi bi-arrow-left-right"></i>
                              <span class="d-none d-xl-inline ms-1">移動</span>
                            <% end %>
                          <% else %>
                            <button class="btn btn-outline-info btn-sm d-flex align-items-center" 
                                    disabled 
                                    title="ログインが必要です"
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="top">
                              <i class="bi bi-arrow-left-right"></i>
                              <span class="d-none d-xl-inline ms-1">移動</span>
                            </button>
                          <% end %>
                        </div>
                      </td>
                    </tr>
                  <% end %>
                <% else %>
                  <tr>
                    <td colspan="7" class="text-center py-5">
                      <div class="py-5">
                        <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                          <i class="bi bi-box text-muted" style="font-size: 2rem;"></i>
                        </div>
                        <h5 class="text-muted mb-2">在庫データがありません</h5>
                        <p class="text-muted mb-3">条件を変更して再度検索してください</p>
                        <button class="btn btn-outline-primary" onclick="document.getElementById('searchFilters').scrollIntoView()">
                          <i class="bi bi-funnel me-2"></i>検索条件を変更
                        </button>
                      </div>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
          
          <!-- カードフッター - サマリー情報 -->
          <div class="card-footer bg-light border-top">
            <div class="row align-items-center">
              <div class="col-lg-8">
                <div class="d-flex flex-wrap align-items-center gap-3">
                  <small class="text-muted fw-medium">
                    <i class="bi bi-info-circle me-1"></i>安全在庫レベル:
                  </small>
                  <div class="d-flex flex-wrap gap-2">
                    <span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 px-2 py-1">
                      <i class="bi bi-exclamation-triangle me-1"></i>0-5個 (低水準)
                    </span>
                    <span class="badge bg-warning bg-opacity-10 text-warning border border-warning border-opacity-25 px-2 py-1">
                      <i class="bi bi-dash-circle me-1"></i>6-10個 (注意)
                    </span>
                    <span class="badge bg-info bg-opacity-10 text-info border border-info border-opacity-25 px-2 py-1">
                      <i class="bi bi-check-circle me-1"></i>11-20個 (適正)
                    </span>
                    <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 px-2 py-1">
                      <i class="bi bi-shield-check me-1"></i>21個以上 (十分)
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-lg-4 text-lg-end mt-2 mt-lg-0">
                <small class="text-muted">
                  <i class="bi bi-clock me-1"></i>最終更新: <%= Time.current.strftime("%Y/%m/%d %H:%M") %>
                </small>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ページネーション -->
        <% if @store_inventories.present? %>
          <div class="card-footer bg-white">
            <div class="d-flex flex-column flex-lg-row justify-content-between align-items-center">
              <div class="mb-3 mb-lg-0">
                <small class="text-muted">
                  全 <%= @store_inventories.total_count %> 件中 
                  <%= @store_inventories.offset_value + 1 %>-<%= [@store_inventories.offset_value + @store_inventories.limit_value, @store_inventories.total_count].min %> 件を表示
                </small>
              </div>
              <div class="pagination-wrapper">
                <% begin %>
                  <% if @store_inventories.respond_to?(:current_page) %>
                    <%= paginate @store_inventories, theme: :custom_bootstrap_5 %>
                  <% else %>
                    <div class="text-muted text-center">
                      ページネーション機能は認証後利用可能
                    </div>
                  <% end %>
                <% rescue => e %>
                  <!-- 緊急時フォールバック: デフォルトページネーション -->
                  <% if @store_inventories.respond_to?(:current_page) %>
                    <%= paginate @store_inventories %>
                  <% else %>
                    <div class="text-muted text-center">
                      ページネーション処理中にエラーが発生: <%= e.message %>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<!-- 一括調整モーダル -->
<div class="modal fade" id="bulkAdjustModal" tabindex="-1" aria-labelledby="bulkAdjustModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="bulkAdjustModalLabel">
          <i class="bi bi-clipboard-check me-2"></i>一括在庫調整
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="閉じる"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-info d-flex align-items-center">
          <i class="bi bi-info-circle me-2"></i>
          <div>
            <strong>注意:</strong> この機能は現在開発中です。個別の在庫調整は各商品の「調整」ボタンから実行できます。
          </div>
        </div>
        <p class="text-muted">複数の商品を同時に調整する機能を準備中です。</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap 5 JavaScript初期化 -->
<script>
  // Tooltip初期化
  document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
  });
</script>

<style>
  /* カスタムスタイル */
  .hover-text-primary:hover {
    color: var(--bs-primary) !important;
  }
  
  .icon-wrapper {
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  
  .table-modern tbody tr {
    transition: all 0.2s ease-in-out;
  }
  
  .table-modern tbody tr:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .pagination-wrapper .pagination {
    margin-bottom: 0;
  }
  
  @media (max-width: 768px) {
    .table-modern th span,
    .table-modern td span.d-none.d-xl-inline {
      display: none !important;
    }
  }
</style>