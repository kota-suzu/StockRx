<%# ============================================ %>
<%# StockRx Store Selection - Modern Design %>
<%# ============================================ %>
<%# Phase 2: „É¢„ÉÄ„É≥UI„Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÂÆüË£Ö %>
<%# CLAUDE.mdÊ∫ñÊã†: „Éô„Çπ„Éà„Éó„É©„ÇØ„ÉÜ„Ç£„Çπ„Éª„Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£ÂØæÂøú %>

<div class="store-selection-container">
  <div class="store-selection-content">
    <div class="container">
      <%# Hero Section %>
      <div class="text-center mb-8">
        <h1 class="display-heading">
          <i class="bi bi-shop me-3"></i>
          Â∫óËàó„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        </h1>
        <p class="section-subtitle section-subtitle--light">
          „ÅîÂà©Áî®„Å´„Å™„ÇãÂ∫óËàó„ÇíÈÅ∏Êäû„Åó„Å¶„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑ
        </p>
      </div>

      <%# ÊúÄËøë„Ç¢„ÇØ„Çª„Çπ„Åó„ÅüÂ∫óËàó„Çª„ÇØ„Ç∑„Éß„É≥ %>
      <% if @recent_stores.any? %>
        <section class="recent-stores-section" aria-labelledby="recent-stores-heading">
          <h2 id="recent-stores-heading" class="section-heading section-heading--light">
            <i class="bi bi-clock-history me-2"></i>
            ÊúÄËøë„Ç¢„ÇØ„Çª„Çπ„Åó„ÅüÂ∫óËàó
          </h2>
          
          <div class="store-grid">
            <% @recent_store_slugs.each do |slug| %>
              <% store = @recent_stores[slug] %>
              <% if store %>
                <article class="store-card store-card--recent" role="button" tabindex="0" 
                         aria-label="<%= store.name %>Â∫óËàó„Å´„É≠„Ç∞„Ç§„É≥" 
                         onclick="window.location='<%= store_login_page_path(slug: store.slug) %>'"
                         onkeypress="if(event.key==='Enter'||event.key===' ')window.location='<%= store_login_page_path(slug: store.slug) %>'">
                  
                  <%# „Ç∑„Éû„Éº„Ç®„Éï„Çß„ÇØ„Éà %>
                  <div class="store-card__shimmer" aria-hidden="true"></div>
                  
                  <%# „Ç´„Éº„Éâ„Éò„ÉÉ„ÉÄ„Éº %>
                  <header class="store-card__header">
                    <div class="store-card__icon" aria-hidden="true">
                      <i class="<%= store_type_icon_class(store.store_type) %>"></i>
                    </div>
                    <div>
                      <h3 class="store-card__title"><%= store.name %></h3>
                      <div class="store-card__code">
                        <i class="bi bi-upc-scan me-1"></i>
                        <%= store.code %>
                      </div>
                    </div>
                  </header>
                  
                  <%# „Ç´„Éº„Éâ„Éú„Éá„Ç£ %>
                  <div class="store-card__body">
                    <div class="store-card__info">
                      <i class="bi bi-tag icon" aria-hidden="true"></i>
                      <span><%= store_type_display_name(store.store_type) %></span>
                    </div>
                    
                    <% if store.region.present? %>
                      <div class="store-card__info">
                        <i class="bi bi-geo-alt icon" aria-hidden="true"></i>
                        <span><%= store.region %></span>
                      </div>
                    <% end %>
                    
                    <div class="store-card__info">
                      <i class="bi bi-box-seam icon" aria-hidden="true"></i>
                      <span>Âú®Â∫´: <%= number_with_delimiter(store.store_inventories_count) %>ÂìÅÁõÆ</span>
                    </div>
                    
                    <%# „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏ %>
                    <div class="store-card__status">
                      <% badge = store_status_badge(store) %>
                      <% case badge[:text] %>
                      <% when /Ê≠£Â∏∏/ %>
                        <span class="status-badge status-badge--success" role="status" aria-live="polite">
                          <i class="bi bi-check-circle"></i>
                          <%= badge[:text] %>
                        </span>
                      <% when /Âú®Â∫´‰∏çË∂≥/ %>
                        <span class="status-badge status-badge--warning" role="status" aria-live="polite">
                          <i class="bi bi-exclamation-triangle"></i>
                          <%= badge[:text] %>
                        </span>
                      <% else %>
                        <span class="status-badge status-badge--info" role="status" aria-live="polite">
                          <i class="bi bi-info-circle"></i>
                          <%= badge[:text] %>
                        </span>
                      <% end %>
                    </div>
                  </div>
                  
                  <%# „Ç´„Éº„Éâ„Éï„ÉÉ„Çø„Éº %>
                  <footer class="store-card__footer">
                    <%= link_to store_login_page_path(slug: store.slug), 
                                class: "btn-modern btn-modern--full",
                                'aria-label': "#{store.name}Â∫óËàó„Å´„É≠„Ç∞„Ç§„É≥" do %>
                      <i class="bi bi-box-arrow-in-right me-2"></i>
                      „É≠„Ç∞„Ç§„É≥
                    <% end %>
                  </footer>
                </article>
              <% end %>
            <% end %>
          </div>
        </section>
      <% end %>

      <%# ÂÖ®Â∫óËàó‰∏ÄË¶ß„Çª„ÇØ„Ç∑„Éß„É≥ %>
      <section class="all-stores-section" aria-labelledby="all-stores-heading">
        <h2 id="all-stores-heading" class="section-heading section-heading--light">
          <i class="bi bi-list-ul me-2"></i>
          „Åô„Åπ„Å¶„ÅÆÂ∫óËàó
        </h2>
        
        <% if @stores_by_type.any? %>
          <% @stores_by_type.each do |store_type, stores| %>
            <div class="store-type-group">
              <div class="store-type-title">
                <div class="icon" aria-hidden="true">
                  <i class="<%= store_type_icon_class(store_type) %>"></i>
                </div>
                <span><%= store_type_display_name(store_type) %></span>
                <span class="badge bg-white text-dark ms-auto"><%= stores.count %>Â∫óËàó</span>
              </div>
              
              <div class="store-grid">
                <% stores.each do |store| %>
                  <article class="store-card" role="button" tabindex="0" 
                           aria-label="<%= store.name %>Â∫óËàó„Å´„É≠„Ç∞„Ç§„É≥"
                           onclick="window.location='<%= store_login_page_path(slug: store.slug) %>'"
                           onkeypress="if(event.key==='Enter'||event.key===' ')window.location='<%= store_login_page_path(slug: store.slug) %>'">
                    
                    <%# „Ç∑„Éû„Éº„Ç®„Éï„Çß„ÇØ„Éà %>
                    <div class="store-card__shimmer" aria-hidden="true"></div>
                    
                    <%# „Ç´„Éº„Éâ„Éò„ÉÉ„ÉÄ„Éº %>
                    <header class="store-card__header">
                      <div class="store-card__icon" aria-hidden="true">
                        <i class="<%= store_type_icon_class(store.store_type) %>"></i>
                      </div>
                      <div>
                        <h3 class="store-card__title"><%= store.name %></h3>
                        <div class="store-card__code">
                          <i class="bi bi-upc-scan me-1"></i>
                          <%= store.code %>
                        </div>
                      </div>
                    </header>
                    
                    <%# „Ç´„Éº„Éâ„Éú„Éá„Ç£ %>
                    <div class="store-card__body">
                      <% if store.region.present? %>
                        <div class="store-card__info">
                          <i class="bi bi-geo-alt icon" aria-hidden="true"></i>
                          <span><%= store.region %></span>
                        </div>
                      <% end %>
                      
                      <div class="store-card__info">
                        <i class="bi bi-box-seam icon" aria-hidden="true"></i>
                        <span>Âú®Â∫´: <%= number_with_delimiter(store.store_inventories_count) %>ÂìÅÁõÆ</span>
                      </div>
                      
                      <% if store.manager_name.present? %>
                        <div class="store-card__info">
                          <i class="bi bi-person-badge icon" aria-hidden="true"></i>
                          <span>Ë≤¨‰ªªËÄÖ: <%= store.manager_name %></span>
                        </div>
                      <% end %>
                      
                      <%# „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„ÉÉ„Ç∏ %>
                      <div class="store-card__status">
                        <% badge = store_status_badge(store) %>
                        <% case badge[:text] %>
                        <% when /Ê≠£Â∏∏/ %>
                          <span class="status-badge status-badge--success" role="status" aria-live="polite">
                            <i class="bi bi-check-circle"></i>
                            <%= badge[:text] %>
                          </span>
                        <% when /Âú®Â∫´‰∏çË∂≥/ %>
                          <span class="status-badge status-badge--warning" role="status" aria-live="polite">
                            <i class="bi bi-exclamation-triangle"></i>
                            <%= badge[:text] %>
                          </span>
                        <% else %>
                          <span class="status-badge status-badge--info" role="status" aria-live="polite">
                            <i class="bi bi-info-circle"></i>
                            <%= badge[:text] %>
                          </span>
                        <% end %>
                      </div>
                    </div>
                    
                    <%# „Ç´„Éº„Éâ„Éï„ÉÉ„Çø„Éº %>
                    <footer class="store-card__footer">
                      <%= link_to store_login_page_path(slug: store.slug), 
                                  class: "btn-modern btn-modern--outline btn-modern--full",
                                  'aria-label': "#{store.name}Â∫óËàó„Å´„É≠„Ç∞„Ç§„É≥" do %>
                        <i class="bi bi-box-arrow-in-right me-2"></i>
                        „É≠„Ç∞„Ç§„É≥
                      <% end %>
                    </footer>
                  </article>
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <%# Á©∫Áä∂ÊÖã %>
          <div class="empty-state" role="status" aria-live="polite">
            <div class="empty-state__icon">
              <i class="bi bi-exclamation-circle"></i>
            </div>
            <h3 class="empty-state__title">Âà©Áî®ÂèØËÉΩ„Å™Â∫óËàó„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
            <p class="empty-state__description">
              „Ç∑„Çπ„ÉÜ„É†ÁÆ°ÁêÜËÄÖ„Å´„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åè„Å†„Åï„ÅÑ„ÄÇ
            </p>
            <%= link_to new_admin_session_path, class: "btn-modern btn-modern--outline mt-4" do %>
              <i class="bi bi-person-gear me-2"></i>
              ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥
            <% end %>
          </div>
        <% end %>
      </section>
    </div>
  </div>
</div>

<%# ============================================ %>
<%# Enhanced JavaScript for Modern Interactions %>
<%# ============================================ %>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ============================================
  // „Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Âº∑Âåñ
  // ============================================
  
  // „Ç≠„Éº„Éú„Éº„Éâ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ÂØæÂøú
  const storeCards = document.querySelectorAll('.store-card[role="button"]');
  
  storeCards.forEach(card => {
    // „Éï„Ç©„Éº„Ç´„ÇπÁÆ°ÁêÜ
    card.addEventListener('focus', function() {
      this.style.outline = '2px solid rgba(99, 102, 241, 0.8)';
      this.style.outlineOffset = '2px';
    });
    
    card.addEventListener('blur', function() {
      this.style.outline = '';
      this.style.outlineOffset = '';
    });
    
    // „Éû„Ç¶„ÇπÊìç‰Ωú„ÅÆ„Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£Âêë‰∏ä
    card.addEventListener('mouseenter', function() {
      this.setAttribute('aria-pressed', 'false');
    });
    
    card.addEventListener('mouseleave', function() {
      this.removeAttribute('aria-pressed');
    });
  });
  
  // ============================================
  // Intersection Observer „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
  // ============================================
  
  if ('IntersectionObserver' in window) {
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
          observer.unobserve(entry.target);
        }
      });
    }, observerOptions);
    
    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂØæË±°Ë¶ÅÁ¥†„ÅÆÂàùÊúüË®≠ÂÆö
    storeCards.forEach((card, index) => {
      card.style.opacity = '0';
      card.style.transform = 'translateY(30px)';
      card.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
      observer.observe(card);
    });
  }
  
  // ============================================
  // „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ
  // ============================================
  
  // Preconnect to improve performance
  const preconnectLinks = [
    'https://cdn.jsdelivr.net',
    'https://fonts.googleapis.com'
  ];
  
  preconnectLinks.forEach(href => {
    const link = document.createElement('link');
    link.rel = 'preconnect';
    link.href = href;
    document.head.appendChild(link);
  });
  
  // Passive event listeners for better scroll performance
  document.addEventListener('touchstart', function() {}, { passive: true });
  document.addEventListener('touchmove', function() {}, { passive: true });
  
  // ============================================
  // ÊúÄËøë„Ç¢„ÇØ„Çª„ÇπÂ∫óËàó„ÅÆËá™ÂãïÊõ¥Êñ∞
  // ============================================
  
  // „Ç´„Éº„ÉâÈÅ∏ÊäûÊôÇ„ÅÆÂàÜÊûê„Éá„Éº„ÇøÈÄÅ‰ø°
  storeCards.forEach(card => {
    card.addEventListener('click', function() {
      const storeName = this.querySelector('.store-card__title')?.textContent?.trim();
      const storeType = this.querySelector('.store-card__info')?.textContent?.trim();
      
      // Analytics event (if analytics is available)
      if (typeof gtag !== 'undefined') {
        gtag('event', 'store_selection', {
          'store_name': storeName,
          'store_type': storeType,
          'selection_source': this.closest('.recent-stores-section') ? 'recent' : 'all'
        });
      }
    });
  });
  
  // ============================================
  // Reduced MotionÂØæÂøú
  // ============================================
  
  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
  
  if (prefersReducedMotion.matches) {
    document.documentElement.style.setProperty('--transition-fast', '0ms');
    document.documentElement.style.setProperty('--transition-base', '0ms');
    document.documentElement.style.setProperty('--transition-slow', '0ms');
    
    // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíÁÑ°ÂäπÂåñ
    storeCards.forEach(card => {
      card.style.transition = 'none';
      card.style.opacity = '1';
      card.style.transform = 'none';
    });
  }
});
</script>

<%# ============================================ %>
<%# TODO: Phase 4‰ª•Èôç„ÅÆÊã°Âºµ‰∫àÂÆö %>
<%# ============================================ %>
<%# üî¥ Phase 4: Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„É™„É≥„Ç∞Ê©üËÉΩÔºàÊé®ÂÆö2Êó•Ôºâ %>
<%# - Â∫óËàóÂêç„Åß„ÅÆÈÉ®ÂàÜ‰∏ÄËá¥Ê§úÁ¥¢ %>
<%# - Âú∞ÂüüÂà•„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ %>
<%# - Â∫óËàó„Çø„Ç§„ÉóÂà•Áµû„ÇäËæº„Åø %>
<%# - Âú®Â∫´Áä∂Ê≥Å„Åß„ÅÆ„Éï„Ç£„É´„Çø„É™„É≥„Ç∞ %>
<%# %>
<%# üü° Phase 5: Âú∞Âõ≥Ë°®Á§∫Ê©üËÉΩÔºàÊé®ÂÆö3Êó•Ôºâ %>
<%# - Google Maps APIÁµ±Âêà %>
<%# - Â∫óËàó‰ΩçÁΩÆË°®Á§∫ %>
<%# - ÊúÄÂØÑ„ÇäÂ∫óËàó„ÅÆËá™ÂãïÊèêÊ°à %>
<%# - GPSÈÄ£Êê∫„Åß„ÅÆË∑ùÈõ¢Ë°®Á§∫ %>
<%# %>
<%# üü¢ Phase 6: PWAÂØæÂøúÔºàÊé®ÂÆö2Êó•Ôºâ %>
<%# - „Ç™„Éï„É©„Ç§„É≥ÂØæÂøú %>
<%# - „Éó„ÉÉ„Ç∑„É•ÈÄöÁü• %>
<%# - „Ç§„É≥„Çπ„Éà„Éº„É´ÂèØËÉΩÂåñ %>
<%# - „Ç≠„É£„ÉÉ„Ç∑„É≥„Ç∞Êà¶Áï• %>
<%# %>
<%# ============================================ %>
<%# „É°„ÇøË™çÁü•ÁöÑÊîπÂñÑ„Éù„Ç§„É≥„ÉàÔºà‰ªäÂõû„ÅÆÂÆüË£Ö„Åã„ÇâÂæó„ÅüÊïôË®ìÔºâ %>
<%# ============================================ %>
<%# 1. **„Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„Éï„Ç°„Éº„Çπ„ÉàË®≠Ë®à**: %>
<%#    - ÂàùÊúüË®≠Ë®àÊÆµÈöé„Åß„ÅÆaria-label„ÄÅroleË®≠ÂÆö %>
<%#    - „Ç≠„Éº„Éú„Éº„Éâ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥„ÅÆÂÑ™ÂÖàÂÆüË£Ö %>
<%#    - „Çπ„ÇØ„É™„Éº„É≥„É™„Éº„ÉÄ„ÉºÂØæÂøú„ÅÆÂæπÂ∫ï %>
<%# %>
<%# 2. **„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊÑèË≠ò„ÅÆÁµÑ„ÅøËæº„Åø**: %>
<%#    - Intersection ObserverÊ¥ªÁî®„Å´„Çà„Çã„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÊúÄÈÅ©Âåñ %>
<%#    - Passive event listeners„ÅÆÊ¥ªÁî® %>
<%#    - Preconnect„Å´„Çà„Çã„É™„ÇΩ„Éº„ÇπË™≠„ÅøËæº„ÅøÊúÄÈÅ©Âåñ %>
<%# %>
<%# 3. **„Éó„É≠„Ç∞„É¨„ÉÉ„Ç∑„Éñ„Ç®„É≥„Éè„É≥„Çπ„É°„É≥„Éà**: %>
<%#    - JavaScriptÁÑ°ÂäπÊôÇ„Åß„ÇÇÂü∫Êú¨Ê©üËÉΩÂãï‰Ωú %>
<%#    - CSS Features„ÅÆÊÆµÈöéÁöÑÈÅ©Áî® %>
<%#    - Reduced Motion„Å∏„ÅÆÈÖçÊÖÆ %>
<%# %>
<%# 4. **Â∞ÜÊù•Êã°ÂºµÊÄß„Å∏„ÅÆÈÖçÊÖÆ**: %>
<%#    - „Ç≥„É≥„Éù„Éº„Éç„É≥„ÉàÂåñ„Åï„Çå„Åü„Éû„Éº„ÇØ„Ç¢„ÉÉ„Éó %>
<%#    - CSSÂ§âÊï∞„Å´„Çà„ÇãÊüîËªü„Å™Ë®≠Ë®à %>
<%#    - AnalyticsÈÄ£Êê∫„ÅÆÊ∫ñÂÇô %>
<%# %>
<%# 5. **Ê®™Â±ïÈñã„ÉÅ„Çß„ÉÉ„ÇØ„É™„Çπ„Éà**: %>
<%#    - [ ] ‰ªñ„ÅÆÂ∫óËàóÈñ¢ÈÄ£„Éö„Éº„Ç∏„Åß„ÅÆÂêåÊßò„Éë„Çø„Éº„É≥ÈÅ©Áî® %>
<%#    - [ ] „Ç¢„Ç§„Ç≥„É≥„Ç∑„Çπ„ÉÜ„É†„ÅÆÂÖ®‰ΩìÁµ±‰∏ÄÁ¢∫Ë™ç %>
<%#    - [ ] „Ç´„É©„Éº„Ç∑„Çπ„ÉÜ„É†„ÅÆ‰∏ÄË≤´ÊÄßÁ¢∫‰øù %>
<%#    - [ ] „É¨„Çπ„Éù„É≥„Ç∑„ÉñË®≠Ë®à„ÅÆÊ®ôÊ∫ñÂåñ %>