<%#
  EmailAuth - ‰∏ÄÊôÇ„Éë„Çπ„ÉØ„Éº„Éâ„É™„ÇØ„Ç®„Çπ„Éà„Éï„Ç©„Éº„É†
  ============================================================================
  CLAUDE.mdÊ∫ñÊã†: „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥„Éª„É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£ÈáçË¶ñ
  
  Áî®ÈÄî:
  - „Éë„Çπ„ÉØ„Éº„ÉâÂøò„ÇåÊôÇ„ÅÆ‰∏ÄÊôÇ„Éë„Çπ„ÉØ„Éº„ÉâÁô∫Ë°å
  - ÂàùÂõû„É≠„Ç∞„Ç§„É≥ÊôÇ„ÅÆË™çË®ºÊîØÊè¥
  - „Çª„Ç≠„É•„É™„ÉÜ„Ç£Âº∑Âåñ„Åï„Çå„ÅüË™çË®º„Éï„É≠„Éº
  
  „Éá„Ç∂„Ç§„É≥ÊÄùÊÉ≥:
  - „É¢„Éê„Ç§„É´„Éï„Ç°„Éº„Çπ„ÉàÔºàÂ∫óËàóÁèæÂ†¥„Åß„ÅÆ‰ΩøÁî®ÊÉ≥ÂÆöÔºâ
  - ÊòéÁ¢∫„Å™„Éï„Ç©„Éº„É†„Ç¨„Ç§„ÉÄ„É≥„Çπ
  - „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ê≥®ÊÑè‰∫ãÈ†Ö„ÅÆÈÅ©Âàá„Å™Ë°®Á§∫
  ============================================================================
%>

<% content_for :title, t('email_auth.titles.request_form') %>

<div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
  <div class="sm:mx-auto sm:w-full sm:max-w-md">
    <!-- „Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ -->
    <div class="text-center">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">
        üè™ <%= @store.name %>
      </h1>
      <h2 class="text-xl font-semibold text-gray-700 mb-6">
        <%= t('email_auth.titles.request_form') %>
      </h2>
    </div>

    <!-- „É°„Ç§„É≥„Éï„Ç©„Éº„É† -->
    <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
      <%= form_with model: @email_auth_request, 
                    url: store_request_temp_password_path(store_slug: @store.slug),
                    local: true,
                    class: "space-y-6" do |form| %>
        
        <!-- „É°„Éº„É´„Ç¢„Éâ„É¨„ÇπÂÖ•Âäõ -->
        <div>
          <%= form.label :email, t('email_auth.labels.email'), 
                         class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-1">
            <%= form.email_field :email, 
                                 placeholder: "your-email@example.com",
                                 required: true,
                                 autofocus: true,
                                 autocomplete: "email",
                                 class: "appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" %>
          </div>
        </div>

        <!-- Â∫óËàóÊÉÖÂ†±ÔºàÈö†„Åó„Éï„Ç£„Éº„É´„ÉâÔºâ -->
        <%= form.hidden_field :store_id, value: @store.id %>
        <%= form.hidden_field :store_slug, value: @store.slug %>

        <!-- „Éò„É´„Éó„ÉÜ„Ç≠„Çπ„Éà -->
        <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <div class="ml-3">
              <p class="text-sm text-blue-700">
                <%= simple_format(t('email_auth.help.request_form')) %>
              </p>
            </div>
          </div>
        </div>

        <!-- ÈÄÅ‰ø°„Éú„Çø„É≥ -->
        <div>
          <%= form.submit t('email_auth.buttons.request_password'),
                          class: "w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out" %>
        </div>

        <!-- Êàª„Çã„É™„É≥„ÇØ -->
        <div class="flex items-center justify-between">
          <%= link_to t('email_auth.buttons.back_to_login'),
                      new_store_user_session_path,
                      class: "text-sm text-blue-600 hover:text-blue-500 font-medium" %>
          <%= link_to t('email_auth.buttons.back_to_store_selection'),
                      store_selection_path,
                      class: "text-sm text-gray-600 hover:text-gray-500" %>
        </div>
      <% end %>
    </div>

    <!-- „Çª„Ç≠„É•„É™„ÉÜ„Ç£Ê≥®ÊÑè‰∫ãÈ†Ö -->
    <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-md p-4">
      <div class="flex">
        <div class="flex-shrink-0">
          <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium text-yellow-800">
            „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Å´„Å§„ÅÑ„Å¶
          </h3>
          <p class="mt-1 text-sm text-yellow-700">
            <%= t('email_auth.security.one_time_use') %><br>
            <%= t('email_auth.security.change_password_recommended') %>
          </p>
        </div>
      </div>
    </div>

    <!-- „Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞ -->
    <div class="mt-6">
      <details class="bg-white border border-gray-200 rounded-lg">
        <summary class="px-4 py-3 text-sm font-medium text-gray-700 cursor-pointer hover:bg-gray-50">
          <%= t('email_auth.troubleshooting.title') %>
        </summary>
        <div class="px-4 pb-4 pt-2 border-t border-gray-100">
          <ul class="text-sm text-gray-600 space-y-1">
            <% t('email_auth.troubleshooting.steps').each do |step| %>
              <li class="flex items-start">
                <span class="inline-block w-2 h-2 bg-gray-400 rounded-full mt-2 mr-3 flex-shrink-0"></span>
                <%= step %>
              </li>
            <% end %>
          </ul>
        </div>
      </details>
    </div>
  </div>
</div>

<!-- JavaScript for enhanced UX -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.querySelector('form');
  const submitButton = form.querySelector('input[type="submit"]');
  const emailField = form.querySelector('input[type="email"]');
  
  // Form submission handling
  form.addEventListener('submit', function(e) {
    if (!emailField.value.trim()) {
      e.preventDefault();
      alert('<%= t("email_auth.validations.email.blank") %>');
      emailField.focus();
      return false;
    }
    
    // Disable submit button to prevent double submission
    submitButton.disabled = true;
    submitButton.value = 'ÈÄÅ‰ø°‰∏≠...';
    submitButton.classList.add('opacity-50', 'cursor-not-allowed');
  });
  
  // Email validation feedback
  emailField.addEventListener('blur', function() {
    const email = this.value.trim();
    if (email && !isValidEmail(email)) {
      this.classList.add('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
      showValidationMessage(this, '<%= t("email_auth.validations.email.invalid") %>');
    } else {
      this.classList.remove('border-red-500', 'focus:border-red-500', 'focus:ring-red-500');
      hideValidationMessage(this);
    }
  });
  
  function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }
  
  function showValidationMessage(field, message) {
    hideValidationMessage(field);
    const errorDiv = document.createElement('div');
    errorDiv.className = 'mt-1 text-sm text-red-600 validation-error';
    errorDiv.textContent = message;
    field.parentNode.appendChild(errorDiv);
  }
  
  function hideValidationMessage(field) {
    const existingError = field.parentNode.querySelector('.validation-error');
    if (existingError) {
      existingError.remove();
    }
  }
});
</script>

<style>
/* Additional responsive styles */
@media (max-width: 640px) {
  .min-h-screen {
    min-height: 100vh;
    padding: 1rem;
  }
}

/* Focus improvements for accessibility */
button:focus,
input:focus,
select:focus,
textarea:focus {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

/* Loading state animation */
.opacity-50 {
  transition: opacity 0.2s ease-in-out;
}
</style>