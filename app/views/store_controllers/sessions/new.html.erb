<%# ============================================ %>
<%# StockRx Store Login - Bootstrap 5 UI Version %>
<%# ============================================ %>
<%# CLAUDE.mdæº–æ‹ : Bootstrapç’°å¢ƒã§ã®æ­£ã—ã„å®Ÿè£… %>
<%# ãƒ¡ã‚¿èªçŸ¥: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®CSSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«åˆã‚ã›ãŸå®Ÿè£… %>
<%# æ¨ªå±•é–‹: ä»–ã®èªè¨¼ç”»é¢ã‚‚Bootstrapçµ±ä¸€ %>
<%# ============================================ %>

<% content_for :title, "ãƒ­ã‚°ã‚¤ãƒ³" %>

<style>
  /* ğŸ¨ ç¾ã—ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èªè¨¼ç”»é¢ã®ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾© */
  :root {
    --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --success-color: #10b981;
    --error-color: #ef4444;
    --focus-ring: rgba(102, 126, 234, 0.4);
  }
  
  /* ç¾ã—ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ */
  .gradient-bg {
    background: var(--primary-gradient);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }
  
  /* ã‚«ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆç¾ã—ã„ã‚·ãƒ£ãƒ‰ã‚¦åŠ¹æœï¼‰ */
  .card-custom {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    border: none;
    border-radius: 1rem;
    overflow: hidden;
    max-width: 800px;
    width: 100%;
    margin: 0 auto;
  }
  
  /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç¾ã—ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœï¼‰ */
  .nav-tabs-custom {
    border-bottom: 2px solid #e5e7eb;
    background-color: #f8f9fa;
  }
  
  .nav-tabs-custom .nav-link {
    border: none;
    border-bottom: 3px solid transparent;
    color: #6b7280;
    font-weight: 500;
    padding: 1rem 1.5rem;
    margin-bottom: -2px;
    transition: all 0.2s ease;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: transparent;
  }
  
  .nav-tabs-custom .nav-link:hover {
    color: #4b5563;
    border-color: transparent;
    background-color: rgba(124, 58, 237, 0.05);
    border-bottom-color: rgba(124, 58, 237, 0.3);
  }
  
  .nav-tabs-custom .nav-link.active {
    color: #7c3aed;
    background-color: #ffffff;
    border-color: transparent;
    border-bottom-color: #7c3aed;
    font-weight: 600;
  }
  
  /* ç¾ã—ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
  .btn-gradient {
    background: linear-gradient(to right, #7c3aed, #ec4899);
    color: white;
    font-weight: 600;
    border: none;
    transition: all 0.2s ease;
  }
  
  .btn-gradient:hover {
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
  }
  
  .btn-gradient:disabled {
    opacity: 0.7;
    transform: none;
  }
  
  .btn-success-gradient {
    background: linear-gradient(to right, #10b981, #059669);
    color: white;
    font-weight: 600;
    border: none;
    transition: all 0.2s ease;
  }
  
  .btn-success-gradient:hover {
    color: white;
    background: linear-gradient(to right, #059669, #047857);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }
  
  /* ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ */
  .passcode-input {
    font-size: 2rem;
    letter-spacing: 1rem;
    text-align: center;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
  }
  
  /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-slide-up {
    animation: slideUp 0.5s ease-out;
  }
  
  /* èƒŒæ™¯ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ */
  body {
    margin: 0;
    padding: 0;
    background: transparent !important;
  }
  
  /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´ - PCãƒ–ãƒ©ã‚¦ã‚¶æœ€é©åŒ– */
  @media (max-width: 576px) {
    .gradient-bg {
      padding: 0.5rem;
    }
    
    .card-custom {
      margin: 0;
      max-width: 100%;
    }
    
    .nav-tabs-custom .nav-link {
      padding: 0.75rem 0.5rem;
      font-size: 0.875rem;
      min-height: 50px;
    }
    
    .nav-tabs-custom .nav-link i {
      display: none;
    }
  }
  
  @media (min-width: 577px) and (max-width: 991px) {
    .card-custom {
      max-width: 700px;
    }
  }
  
  @media (min-width: 992px) and (max-width: 1199px) {
    .card-custom {
      max-width: 750px;
    }
  }
  
  @media (min-width: 1200px) and (max-width: 1399px) {
    .card-custom {
      max-width: 800px;
    }
  }
  
  @media (min-width: 1400px) {
    .card-custom {
      max-width: 850px;
    }
  }
</style>

<div class="animate-slide-up">
  <% if @store %>
    <!-- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ -->
    <div class="card card-custom">
      <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
      <ul class="nav nav-tabs nav-tabs-custom" id="loginTabs" role="tablist">
        <li class="nav-item flex-fill" role="presentation">
          <button class="nav-link active w-100" id="password-tab" data-bs-toggle="tab" data-bs-target="#password-login" type="button" role="tab" aria-controls="password-login" aria-selected="true">
            <i class="bi bi-key-fill me-2"></i>
            ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³
          </button>
        </li>
        <li class="nav-item flex-fill" role="presentation">
          <button class="nav-link w-100" id="passcode-tab" data-bs-toggle="tab" data-bs-target="#passcode-login" type="button" role="tab" aria-controls="passcode-login" aria-selected="false">
            <i class="bi bi-phone me-2"></i>
            ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³
          </button>
        </li>
      </ul>
      
      <div class="card-body p-4 p-md-5">
        <div class="tab-content" id="loginTabContent">
          <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¡¨ç¤ºï¼‰ -->
          <div class="tab-pane fade show active" id="password-login" role="tabpanel" aria-labelledby="password-tab">
            <div class="text-center mb-4">
              <div class="d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded-circle mb-3" style="width: 64px; height: 64px;">
                <i class="bi bi-key-fill fs-3 text-primary"></i>
              </div>
              <h2 class="h4 fw-semibold mb-2">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³</h2>
              <p class="text-muted">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³</p>
            </div>
            
            <%= form_with scope: :store_user, 
                          url: store_user_session_path(store_slug: @store.slug),
                          local: true,
                          class: "needs-validation",
                          html: { novalidate: true } do |f| %>
              <!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ -->
              <div class="mb-3">
                <label class="form-label fw-medium">
                  <i class="bi bi-envelope me-1"></i>
                  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                </label>
                <%= f.email_field :email,
                                  autofocus: true,
                                  autocomplete: "email",
                                  class: "form-control",
                                  placeholder: "email@example.com",
                                  required: true %>
                <div class="invalid-feedback">
                  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                </div>
              </div>
              
              <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ -->
              <div class="mb-3">
                <label class="form-label fw-medium">
                  <i class="bi bi-lock me-1"></i>
                  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
                </label>
                <%= f.password_field :password,
                                     autocomplete: "current-password",
                                     class: "form-control",
                                     placeholder: "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",
                                     required: true %>
                <div class="invalid-feedback">
                  ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                </div>
              </div>
              
              <!-- ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿æŒ -->
              <div class="form-check mb-4">
                <%= f.check_box :remember_me, class: "form-check-input" %>
                <label class="form-check-label small" for="store_user_remember_me">
                  ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹
                </label>
              </div>
              
              <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ -->
              <div class="d-grid mb-3">
                <%= f.submit "ãƒ­ã‚°ã‚¤ãƒ³",
                             class: "btn btn-gradient btn-lg py-3",
                             data: { disable_with: "ãƒ­ã‚°ã‚¤ãƒ³ä¸­..." } %>
              </div>
            <% end %>
            
            <!-- ãƒ˜ãƒ«ãƒ—ãƒªãƒ³ã‚¯ -->
            <div class="text-center mt-4">
              <p class="mb-2">
                <%= link_to "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¿˜ã‚ŒãŸæ–¹ã¯ã“ã¡ã‚‰", 
                            store_email_auth_path(store_slug: @store.slug),
                            class: "text-decoration-none fw-medium" %>
              </p>
              <div class="alert alert-info border-0 mt-3">
                <small class="text-info-emphasis">
                  <i class="bi bi-info-circle me-1"></i>
                  åˆå›ãƒ­ã‚°ã‚¤ãƒ³ã®æ–¹ã¯ã€ç®¡ç†è€…ã‹ã‚‰é…å¸ƒã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ã”åˆ©ç”¨ãã ã•ã„
                </small>
              </div>
            </div>
          </div>
          
          <!-- ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ -->
          <div class="tab-pane fade" id="passcode-login" role="tabpanel" aria-labelledby="passcode-tab">
            <!-- Step 1: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ› -->
            <div id="passcode-step1">
              <div class="text-center mb-4">
                <div class="d-inline-flex align-items-center justify-content-center bg-success bg-opacity-10 rounded-circle mb-3" style="width: 64px; height: 64px;">
                  <i class="bi bi-envelope-check fs-3 text-success"></i>
                </div>
                <h2 class="h4 fw-semibold mb-2">ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³</h2>
                <p class="text-muted">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å—ã‘å–ã‚‹</p>
              </div>
              
              <%= form_with url: store_request_temp_password_path(store_slug: @store.slug),
                            local: false,
                            id: "passcode-request-form",
                            class: "needs-validation",
                            html: { novalidate: true } do |f| %>
                <div class="mb-3">
                  <label class="form-label fw-medium">
                    <i class="bi bi-envelope me-1"></i>
                    ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                  </label>
                  <%= f.email_field :email,
                                    class: "form-control",
                                    placeholder: "email@example.com",
                                    required: true %>
                  <div class="invalid-feedback">
                    ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                  </div>
                </div>
                
                <%= f.hidden_field :store_id, value: @store.id %>
                <%= f.hidden_field :store_slug, value: @store.slug %>
                
                <div class="d-grid mb-3">
                  <%= f.submit "ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’é€ä¿¡",
                               class: "btn btn-success-gradient btn-lg py-3",
                               data: { disable_with: "é€ä¿¡ä¸­..." } %>
                </div>
              <% end %>
              
              <div class="alert alert-warning border-0">
                <small class="text-warning-emphasis">
                  <i class="bi bi-info-circle me-1"></i>
                  ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã¯15åˆ†é–“æœ‰åŠ¹ã§ã™ã€‚å—ä¿¡ã—ãŸã‚‰é€Ÿã‚„ã‹ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                </small>
              </div>
            </div>
            
            <!-- Step 2: ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰å…¥åŠ›ï¼ˆJavaScript ã§è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆï¼‰ -->
            <div id="passcode-step2" style="display: none;">
              <div class="text-center mb-4">
                <div class="d-inline-flex align-items-center justify-content-center bg-warning bg-opacity-10 rounded-circle mb-3" style="width: 64px; height: 64px;">
                  <i class="bi bi-shield-lock fs-3 text-warning"></i>
                </div>
                <h2 class="h4 fw-semibold mb-2">ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›</h2>
                <p class="text-muted">ãƒ¡ãƒ¼ãƒ«ã§å—ä¿¡ã—ãŸ6æ¡ã®ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
              </div>
              
              <%= form_with url: store_verify_temp_password_path(store_slug: @store.slug),
                            local: true,
                            id: "passcode-verify-form",
                            class: "needs-validation",
                            html: { novalidate: true } do |f| %>
                <div class="mb-3">
                  <label class="form-label fw-medium">
                    <i class="bi bi-shield-lock me-1"></i>
                    6æ¡ã®ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰
                  </label>
                  <%= f.text_field :temp_password,
                                   class: "form-control passcode-input",
                                   placeholder: "â€¢â€¢â€¢â€¢â€¢â€¢",
                                   maxlength: 6,
                                   pattern: "[0-9]{6}",
                                   inputmode: "numeric",
                                   autocomplete: "one-time-code",
                                   required: true %>
                  <div class="invalid-feedback">
                    6æ¡ã®ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                  </div>
                </div>
                
                <%= f.hidden_field :email, id: "passcode_verify_email" %>
                <%= f.hidden_field :store_id, value: @store.id %>
                <%= f.hidden_field :store_slug, value: @store.slug %>
                
                <div class="d-grid mb-3">
                  <%= f.submit "ãƒ­ã‚°ã‚¤ãƒ³",
                               class: "btn btn-success-gradient btn-lg py-3",
                               data: { disable_with: "ãƒ­ã‚°ã‚¤ãƒ³ä¸­..." } %>
                </div>
              <% end %>
              
              <div class="d-flex justify-content-between small">
                <button type="button" class="btn btn-link text-decoration-none p-0" onclick="resetPasscodeForm()">
                  <i class="bi bi-arrow-left me-1"></i>
                  ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å¤‰æ›´
                </button>
                <span class="text-muted">
                  <i class="bi bi-clock me-1"></i>
                  15åˆ†æœ‰åŠ¹
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
      <div class="card-footer bg-light text-center border-0">
        <small class="text-muted">
          <%= link_to store_selection_path, class: "text-decoration-none fw-medium" do %>
            <i class="bi bi-shop me-1"></i>
            åˆ¥ã®åº—èˆ—ã‚’é¸æŠ
          <% end %>
        </small>
      </div>
    </div>

         <!-- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ± -->
     <div class="text-center mt-4">
       <div class="d-inline-flex align-items-center text-muted small">
         <i class="bi bi-shield-check me-2"></i>
         <span>å®‰å…¨ãªæ¥ç¶šã§ä¿è­·ã•ã‚Œã¦ã„ã¾ã™</span>
       </div>
     </div>

  <% else %>
    <!-- åº—èˆ—ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆ -->
    <div class="card card-custom">
      <div class="card-body p-5 text-center">
        <div class="mb-4">
          <i class="bi bi-exclamation-triangle-fill text-warning fs-1"></i>
        </div>
        <h2 class="h4 fw-semibold mb-3">åº—èˆ—ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</h2>
        <p class="text-muted mb-4">ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã«ã¯ã€ã¾ãšåº—èˆ—ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
        <%= link_to "åº—èˆ—ã‚’é¸æŠã™ã‚‹",
                    store_selection_path,
                    class: "btn btn-gradient btn-lg py-3" %>
      </div>
    </div>
  <% end %>
</div>

<%# ğŸ”´ ç·Šæ€¥ä¿®æ­£å®Œäº†: JavaScriptç«¶åˆä¿®æ­£ã¨Turboå¯¾å¿œ %>
<%# å•é¡Œ: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã‚ˆã‚‹CSPé•åã¨ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®ä½ä¸‹ %>
<%# è§£æ±º: å¤–éƒ¨JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆauthentication.jsï¼‰ã«ç§»è¡Œ %>
<%# ãƒ¡ã‚¿èªçŸ¥: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã¨ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Šã®ä¸¡ç«‹ %>
<%# æ¨ªå±•é–‹: ä»–ã®ç”»é¢ã§ã‚‚ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¤–éƒ¨åŒ–ã‚’æ¤œè¨ %>
<%# 
  TODO: ğŸŸ¢ Phase 4ï¼ˆæ¨å¥¨ï¼‰- ã•ã‚‰ãªã‚‹èªè¨¼UXå‘ä¸Š
  å„ªå…ˆåº¦: ä½ï¼ˆåŸºæœ¬æ©Ÿèƒ½å®Œæˆå¾Œï¼‰
  å®Ÿè£…å†…å®¹:
    - Bootstrap Toasté€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ï¼ˆalert()ç½®ãæ›ãˆï¼‰
    - ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–WebAppå¯¾å¿œï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³èªè¨¼ï¼‰
    - ç”Ÿä½“èªè¨¼çµ±åˆï¼ˆWebAuthnï¼‰
    - ãƒãƒ«ãƒãƒ•ã‚¡ã‚¯ã‚¿èªè¨¼ï¼ˆTOTPï¼‰
  æœŸå¾…åŠ¹æœ: æœ€å…ˆç«¯ã®èªè¨¼ä½“é¨“æä¾›
%>

<%# ============================================ %>
<%# âœ… å®Œäº†: JavaScriptæœ€é©åŒ–ã¨Turboå¯¾å¿œ %>
<%# ============================================ %>
<%# 
  âœ… Phase 1: ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆå¤–éƒ¨åŒ–å®Œäº†
  âœ… Phase 2: Bootstrapç«¶åˆè§£æ¶ˆå®Œäº†
  âœ… Phase 3: Turboå¯¾å¿œå¼·åŒ–å®Œäº†
  
  TODO: ğŸŸ¡ Phase 5ï¼ˆé‡è¦ï¼‰- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
  å„ªå…ˆåº¦: ä¸­ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šï¼‰
  å®Ÿè£…å†…å®¹:
    - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¼·åº¦ãƒã‚§ãƒƒã‚¯
    - Bootstrap Progress Barã§ã®è¦–è¦šçš„è¡¨ç¤º
    - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¦ä»¶ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
  æœŸå¾…åŠ¹æœ: ã‚»ã‚­ãƒ¥ã‚¢ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šã®ä¿ƒé€²
  
  TODO: ğŸŸ¢ Phase 6ï¼ˆæ¨å¥¨ï¼‰- ç”Ÿä½“èªè¨¼å¯¾å¿œ
  å„ªå…ˆåº¦: ä½ï¼ˆå…ˆé€²çš„æ©Ÿèƒ½ï¼‰
  å®Ÿè£…å†…å®¹:
    - WebAuthn APIå®Ÿè£…
    - Touch ID/Face IDå¯¾å¿œ
  æœŸå¾…åŠ¹æœ: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¬ã‚¹èªè¨¼ã®å®Ÿç¾
%>

<script>
// ğŸ”¥ ç·Šæ€¥ä¿®æ­£: ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã‚¿ãƒ–ç›´æ¥ä¿®å¾©
// CLAUDE.mdæº–æ‹ : ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£æœ€å„ªå…ˆã®å³åº§ä¿®å¾©ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
// ãƒ¡ã‚¿èªçŸ¥: external JSèª­ã¿è¾¼ã¿å•é¡Œã®è¿‚å›
// æ¨ªå±•é–‹: ä»–ã®èªè¨¼ç”»é¢ã§ã‚‚åŒæ§˜ã®ç›´æ¥ä¿®å¾©ãŒå¯èƒ½

console.log('ğŸ”¥ [EMERGENCY FIX] Direct tab repair script starting...');

// å³åº§ã«å®Ÿè¡Œã•ã‚Œã‚‹é–¢æ•°ï¼ˆDOMçŠ¶æ…‹ã«é–¢ä¿‚ãªãï¼‰
function initTabsImmediately() {
  console.log('âš¡ [Emergency] Immediate tab initialization...');
  
  setTimeout(function() {
    setupTabFunctionality();
  }, 100);
  
  setTimeout(function() {
    setupTabFunctionality();
  }, 500);
  
  setTimeout(function() {
    setupTabFunctionality();
  }, 1000);
}

function setupTabFunctionality() {
  console.log('ğŸ”§ [Emergency] Setting up tab functionality...');
  
  // ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãƒ­ã‚°ã‚¤ãƒ³ã‚¿ãƒ–ã®ç›´æ¥è¨­å®š
  const passcodeTab = document.getElementById('passcode-tab');
  const passwordTab = document.getElementById('password-tab');
  const passcodePane = document.getElementById('passcode-login');
  const passwordPane = document.getElementById('password-login');
  
  console.log('ğŸ” [Emergency] Element check:', {
    passcodeTab: !!passcodeTab,
    passwordTab: !!passwordTab,
    passcodePane: !!passcodePane,
    passwordPane: !!passwordPane
  });
  
  if (!passcodeTab || !passwordTab || !passcodePane || !passwordPane) {
    console.error('âŒ [Emergency] Required tab elements not found');
    return false;
  }
  
  console.log('âœ… [Emergency] All tab elements found, setting up handlers...');
  
  // æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤
  const newPasscodeTab = passcodeTab.cloneNode(true);
  const newPasswordTab = passwordTab.cloneNode(true);
  passcodeTab.parentNode.replaceChild(newPasscodeTab, passcodeTab);
  passwordTab.parentNode.replaceChild(newPasswordTab, passwordTab);
  
  // ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚¿ãƒ–ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
  newPasscodeTab.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    console.log('ğŸ‘† [Emergency] Passcode tab clicked - DIRECT ACTIVATION');
    
    // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
    newPasswordTab.classList.remove('active');
    newPasswordTab.setAttribute('aria-selected', 'false');
    newPasscodeTab.classList.add('active');
    newPasscodeTab.setAttribute('aria-selected', 'true');
    
    // ã™ã¹ã¦ã®ãƒ‘ãƒãƒ«ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
    passwordPane.classList.remove('show', 'active');
    passcodePane.classList.add('show', 'active');
    
    console.log('âœ… [Emergency] Passcode tab activated successfully');
    
    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¨­å®š
    setTimeout(() => {
      const emailField = passcodePane.querySelector('input[type="email"]');
      if (emailField) {
        emailField.focus();
        console.log('ğŸ“§ [Emergency] Email field focused');
      }
    }, 100);
  });
  
  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚¿ãƒ–ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
  newPasswordTab.addEventListener('click', function(e) {
    e.preventDefault();
    e.stopPropagation();
    console.log('ğŸ‘† [Emergency] Password tab clicked - DIRECT ACTIVATION');
    
    // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
    newPasscodeTab.classList.remove('active');
    newPasscodeTab.setAttribute('aria-selected', 'false');
    newPasswordTab.classList.add('active');
    newPasswordTab.setAttribute('aria-selected', 'true');
    
    // ã™ã¹ã¦ã®ãƒ‘ãƒãƒ«ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
    passcodePane.classList.remove('show', 'active');
    passwordPane.classList.add('show', 'active');
    
    console.log('âœ… [Emergency] Password tab activated successfully');
    
    // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¨­å®š
    setTimeout(() => {
      const emailField = passwordPane.querySelector('input[type="email"]');
      if (emailField) {
        emailField.focus();
        console.log('ğŸ“§ [Emergency] Email field focused');
      }
    }, 100);
  });
  
  // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
  [newPasscodeTab, newPasswordTab].forEach(tab => {
    tab.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        e.stopPropagation();
        this.click();
      }
    });
  });
  
  // ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
  [newPasscodeTab, newPasswordTab].forEach(tab => {
    tab.addEventListener('mouseenter', function() {
      if (!this.classList.contains('active')) {
        this.style.backgroundColor = '#f8f9fa';
      }
    });
    
    tab.addEventListener('mouseleave', function() {
      if (!this.classList.contains('active')) {
        this.style.backgroundColor = '';
      }
    });
    
    // ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    tab.addEventListener('mousedown', function() {
      this.style.backgroundColor = '#e9ecef';
    });
    
    tab.addEventListener('mouseup', function() {
      if (!this.classList.contains('active')) {
        this.style.backgroundColor = '#f8f9fa';
      }
    });
  });
  
  console.log('âœ… [Emergency] Direct tab repair completed - tabs should be functional now');
  return true;
}

// å³åº§ã«å®Ÿè¡Œ
initTabsImmediately();

document.addEventListener('DOMContentLoaded', function() {
  console.log('ğŸ”§ [Emergency] DOM ready, ensuring tabs are functional...');
  setupTabFunctionality();
});

// Turboå¯¾å¿œ
document.addEventListener('turbo:load', function() {
  console.log('ğŸ”„ [Emergency] Turbo load detected, tab functionality ready');
});
</script>