<!DOCTYPE html>
<html>
  <head>
    <title>StockRx - ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%# „É≠„Ç∞„Ç¢„Ç¶„Éà„Éú„Çø„É≥„ÅÆË¶ñË™çÊÄßÂêë‰∏ä„ÅÆ„Åü„ÇÅ„ÅÆ„Ç´„Çπ„Çø„É†CSS %>
    <style>
      /* „É¶„Éº„Ç∂„Éº„É°„Éã„É•„Éº„ÅÆÂº∑Ë™ø */
      #userDropdown {
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 0.375rem;
        padding: 0.375rem 0.75rem;
        transition: all 0.3s ease;
      }
      
      #userDropdown:hover,
      #userDropdown:focus,
      #userDropdown[aria-expanded="true"] {
        background-color: rgba(255,255,255,0.1);
        border-color: rgba(255,255,255,0.4);
      }
      
      /* „É≠„Ç∞„Ç¢„Ç¶„Éà„Éú„Çø„É≥„ÅÆÂº∑Ë™ø */
      .logout-btn {
        transition: all 0.3s ease;
        border-top: 1px solid #dee2e6;
        margin-top: 0.5rem;
        padding-top: 0.75rem !important;
        padding-bottom: 0.75rem !important;
      }
      
      .logout-btn:hover {
        background-color: #dc3545 !important;
        color: white !important;
        transform: translateX(5px);
      }
      
      .logout-btn:hover i {
        animation: slide-out 0.3s ease-in-out;
      }
      
      @keyframes slide-out {
        0% { transform: translateX(0); }
        50% { transform: translateX(3px); }
        100% { transform: translateX(0); }
      }
      
      /* „É¢„Éê„Ç§„É´„Éì„É•„Éº„Åß„ÅÆÊîπÂñÑ */
      @media (max-width: 767px) {
        #userDropdown {
          padding: 0.5rem 1rem;
          font-size: 1.1rem;
        }
        
        .dropdown-menu {
          min-width: 200px;
        }
      }
      
      /* „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É°„Éã„É•„Éº„ÅÆÊîπÂñÑ */
      .dropdown-menu-end {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      /* TODO: üü¢ Phase 4ÔºàÊé®Â•®Ôºâ- „ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂØæÂøú */
      /* ÂÑ™ÂÖàÂ∫¶: ‰ΩéÔºà„É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£Âêë‰∏äÔºâ */
      /* ÂÆüË£ÖÂÜÖÂÆπ: „Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö„Å´Âøú„Åò„Åü„ÉÄ„Éº„ÇØ„É¢„Éº„ÉâÂàáÊõø */
      /* „É°„ÇøË™çÁü•: Áèæ‰ª£„ÅÆUI„Éà„É¨„É≥„Éâ„Å´ÂØæÂøú */
    </style>
  </head>

  <body>
    <% if admin_signed_in? %>
      <!-- Enhanced Admin Navigation with Multi-Store Support -->
      <nav class="navbar navbar-expand-lg navbar-dark navbar-admin sticky-top">
        <div class="container-fluid">
          <%= link_to admin_root_path, class: "navbar-brand d-flex align-items-center" do %>
            <i class="bi bi-boxes me-2"></i>
            <span>StockRx</span>
            <small class="badge bg-light text-dark ms-2">ÁÆ°ÁêÜ„Éë„Éç„É´</small>
          <% end %>
          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                  aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
              <!-- „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ -->
              <li class="nav-item">
                <%= link_to admin_root_path, 
                    class: "nav-link #{'active' if current_page?(admin_root_path)}", 
                    title: "„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ" do %>
                  <i class="bi bi-speedometer2 me-1"></i>
                  <span class="d-none d-lg-inline">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</span>
                  <span class="d-lg-none">„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ</span>
                <% end %>
              </li>

              <!-- „Éû„É´„ÉÅ„Çπ„Éà„Ç¢ÁÆ°ÁêÜ„É°„Éã„É•„ÉºÔºàÊ®©Èôê„Å´„Çà„ÇãË°®Á§∫Âà∂Âæ°Ôºâ -->
              <% if current_admin.can_access_all_stores? || current_admin.store_manager? %>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle <%= 'active' if request.path.include?('/admin/stores') %>" 
                     href="#" id="storeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                     title="Â∫óËàóÁÆ°ÁêÜ">
                    <i class="bi bi-shop me-1"></i>
                    <span class="d-none d-lg-inline">Â∫óËàóÁÆ°ÁêÜ</span>
                    <span class="d-lg-none">Â∫óËàó</span>
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <%= link_to admin_stores_path, class: "dropdown-item" do %>
                        <i class="bi bi-list me-2"></i>Â∫óËàó‰∏ÄË¶ß
                      <% end %>
                    </li>
                    <% if current_admin.headquarters_admin? %>
                      <li>
                        <%= link_to new_admin_store_path, class: "dropdown-item" do %>
                          <i class="bi bi-plus-circle me-2"></i>Êñ∞Ë¶èÂ∫óËàó
                        <% end %>
                      </li>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <%= link_to admin_stores_path, class: "dropdown-item" do %>
                          <i class="bi bi-graph-up me-2"></i>Â∫óËàóÂàÜÊûê
                        <% end %>
                      </li>
                    <% end %>
                  </ul>
                </li>

                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle <%= 'active' if request.path.include?('/admin/transfers') %>" 
                     href="#" id="transferDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                     title="Â∫óËàóÈñìÁßªÂãï">
                    <i class="bi bi-truck me-1"></i>
                    <span class="d-none d-lg-inline">ÁßªÂãïÁÆ°ÁêÜ</span>
                    <span class="d-lg-none">ÁßªÂãï</span>
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <%= link_to admin_inter_store_transfers_path, class: "dropdown-item" do %>
                        <i class="bi bi-list me-2"></i>ÁßªÂãï‰∏ÄË¶ß
                      <% end %>
                    </li>
                    <li>
                      <%= link_to new_admin_inter_store_transfer_path, class: "dropdown-item" do %>
                        <i class="bi bi-plus-circle me-2"></i>Êñ∞Ë¶èÁî≥Ë´ã
                      <% end %>
                    </li>
                    <% if current_admin.can_approve_transfers? %>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <%= link_to pending_admin_inter_store_transfers_path, class: "dropdown-item position-relative" do %>
                          <i class="bi bi-clock me-2"></i>ÊâøË™çÂæÖ„Å°
                          <% begin %>
                            <% pending_count = current_admin&.accessible_store_ids&.any? ? InterStoreTransfer.accessible_to_admin(current_admin).pending.count : 0 %>
                            <% if pending_count > 0 %>
                              <span class="badge bg-warning text-dark position-absolute top-0 start-100 translate-middle">
                                <%= pending_count %>
                              </span>
                            <% end %>
                          <% rescue => e %>
                            <%# „Ç®„É©„Éº„É≠„Ç∞Ë®òÈå≤ÔºàÊú¨Áï™Áí∞Â¢É„Åß„ÅÆÈöúÂÆ≥Ë™øÊüªÁî®Ôºâ %>
                            <% Rails.logger.error "ÊâøË™çÂæÖ„Å°‰ª∂Êï∞ÂèñÂæó„Ç®„É©„Éº: #{e.message}" if Rails.env.production? %>
                            <%# ÈñãÁô∫Áí∞Â¢É„Åß„ÅØË≠¶ÂëäË°®Á§∫„ÄÅÊú¨Áï™Áí∞Â¢É„Åß„ÅØÈùô„Åã„Å´Â§±Êïó %>
                            <% unless Rails.env.production? %>
                              <span class="badge bg-danger">!</span>
                            <% end %>
                          <% end %>
                        <% end %>
                      </li>
                    <% end %>
                    <% if current_admin.headquarters_admin? %>
                      <li>
                        <%= link_to analytics_admin_inter_store_transfers_path, class: "dropdown-item" do %>
                          <i class="bi bi-graph-up me-2"></i>ÂàÜÊûê„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ
                        <% end %>
                      </li>
                    <% end %>
                  </ul>
                </li>
              <% end %>

              <!-- Âú®Â∫´ÁÆ°ÁêÜ -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle <%= 'active' if request.path.include?('/admin/inventories') %>" 
                   href="#" id="inventoryDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                   title="Âú®Â∫´ÁÆ°ÁêÜ">
                  <i class="bi bi-boxes me-1"></i>
                  <span class="d-none d-lg-inline">Âú®Â∫´ÁÆ°ÁêÜ</span>
                  <span class="d-lg-none">Âú®Â∫´</span>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <%= link_to admin_inventories_path, class: "dropdown-item" do %>
                      <i class="bi bi-list me-2"></i>ÂïÜÂìÅ‰∏ÄË¶ß
                    <% end %>
                  </li>
                  <li>
                    <%= link_to new_admin_inventory_path, class: "dropdown-item" do %>
                      <i class="bi bi-plus-circle me-2"></i>Êñ∞Ë¶èÁôªÈå≤
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to admin_inventories_path(filter: "low_stock"), class: "dropdown-item" do %>
                      <i class="bi bi-exclamation-triangle me-2"></i>‰ΩéÂú®Â∫´„Ç¢„É©„Éº„Éà
                    <% end %>
                  </li>
                  <li>
                    <%= link_to import_form_admin_inventories_path, class: "dropdown-item" do %>
                      <i class="bi bi-upload me-2"></i>CSV„Ç§„É≥„Éù„Éº„Éà
                    <% end %>
                  </li>
                </ul>
              </li>

              <!-- Â±•Ê≠¥„ÉªÁõ£Ë¶ñ -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="monitorDropdown" role="button" 
                   data-bs-toggle="dropdown" aria-expanded="false" title="Áõ£Ë¶ñ„ÉªÂ±•Ê≠¥">
                  <i class="bi bi-activity me-1"></i>
                  <span class="d-none d-lg-inline">Áõ£Ë¶ñ</span>
                  <span class="d-lg-none">Áõ£Ë¶ñ</span>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <%# ‚úÖ ÂÆå‰∫Ü: Phase 3 - inventory_logsÊ©üËÉΩ„ÅÆÁÆ°ÁêÜÁîªÈù¢Áµ±ÂêàÔºà2025Âπ¥6ÊúàÔºâ %>
                    <%# CLAUDE.mdÊ∫ñÊã†: ÁÆ°ÁêÜÊ©üËÉΩ„ÅÆ‰∏ÄÂÖÉÂåñÂÆå‰∫Ü %>
                    <%= link_to admin_inventory_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-journal-text me-2"></i>Âú®Â∫´Â±•Ê≠¥
                    <% end %>
                  </li>
                  <li>
                    <%= link_to admin_audit_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-shield-check me-2"></i>Áõ£Êüª„É≠„Ç∞
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to security_events_admin_audit_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-shield-exclamation me-2"></i>„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç§„Éô„É≥„Éà
                    <% end %>
                  </li>
                  <li>
                    <%= link_to user_activity_admin_audit_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-person-lines-fill me-2"></i>„É¶„Éº„Ç∂„ÉºÊ¥ªÂãïÂ±•Ê≠¥
                    <% end %>
                  </li>
                  <li>
                    <%= link_to compliance_report_admin_audit_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-file-earmark-check me-2"></i>„Ç≥„É≥„Éó„É©„Ç§„Ç¢„É≥„Çπ„É¨„Éù„Éº„Éà
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%# TODO: üü¢ Phase 4ÔºàÊé®Â•®Ôºâ- Sidekiq Web„Éû„Ç¶„É≥„Éà„Ç®„É≥„Ç∏„É≥„ÅÆ„Éë„ÇπÁÆ°ÁêÜ %>
                    <%# ÂÑ™ÂÖàÂ∫¶: ‰ΩéÔºàÊ©üËÉΩÁöÑ„Å´„ÅØÂïèÈ°å„Å™„ÅóÔºâ %>
                    <%# ÂÆüË£ÖÂÜÖÂÆπ: %>
                    <%#   - Ë®≠ÂÆö„Éï„Ç°„Ç§„É´„ÅßSidekiq Web UI„ÅÆ„Éë„Çπ„ÇíÁÆ°ÁêÜ %>
                    <%#   - helper method„Åß„ÅÆ‰∏ÄÂÖÉÁÆ°ÁêÜ %>
                    <%# ÁêÜÁî±: Sidekiq::Web„ÅØÂ§ñÈÉ®„Ç®„É≥„Ç∏„É≥„ÅÆ„Åü„ÇÅ„ÄÅRails„Éë„Çπ„Éò„É´„Éë„Éº„ÅåËá™ÂãïÁîüÊàê„Åï„Çå„Å™„ÅÑ %>
                    <%# ÁèæÁä∂: „Éè„Éº„Éâ„Ç≥„Éº„Éâ„Éë„Çπ„ÅØÊ≠£Â∏∏Âãï‰ΩúÔºàroutes.rb„Åß„Éû„Ç¶„É≥„ÉàÁ¢∫Ë™çÊ∏à„ÅøÔºâ %>
                    <%= link_to "/admin/sidekiq", class: "dropdown-item", target: "_blank", rel: "noopener" do %>
                      <i class="bi bi-gear me-2"></i>„Ç∏„Éß„ÉñÁõ£Ë¶ñ
                    <% end %>
                  </li>
                </ul>
              </li>
            </ul>
            
            <!-- Âè≥ÂÅ¥„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
            <ul class="navbar-nav">
              <!-- ÈÄöÁü•ÔºàÊú™ÂÆüË£ÖÔºâ -->
              <li class="nav-item">
                <a class="nav-link position-relative" href="#" title="ÈÄöÁü•ÔºàÂÆüË£Ö‰∫àÂÆöÔºâ">
                  <i class="bi bi-bell"></i>
                  <!-- TODO: Phase 3 - ÈÄöÁü•Ê©üËÉΩÂÆüË£ÖÊôÇ„Å´Ë°®Á§∫ -->
                  <!-- <span class="badge bg-danger position-absolute top-0 start-100 translate-middle">3</span> -->
                </a>
              </li>

              <!-- „É¶„Éº„Ç∂„Éº„É°„Éã„É•„ÉºÔºà„É≠„Ç∞„Ç¢„Ç¶„ÉàÂê´„ÇÄÔºâ -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" 
                   role="button" data-bs-toggle="dropdown" aria-expanded="false"
                   aria-haspopup="true" aria-label="„É¶„Éº„Ç∂„Éº„É°„Éã„É•„Éº„ÇíÈñã„Åè"
                   title="„Ç¢„Ç´„Ç¶„É≥„Éà„É°„Éã„É•„ÉºÔºà„É≠„Ç∞„Ç¢„Ç¶„Éà„ÅØ„Åì„Å°„ÇâÔºâ"
                   tabindex="0">
                  <i class="bi bi-person-circle me-2"></i>
                  <div class="d-none d-md-block">
                    <div class="small"><%= current_admin.display_name %></div>
                    <div class="text-muted" style="font-size: 0.75rem;"><%= current_admin.role_text %></div>
                  </div>
                  <%# „É¢„Éê„Ç§„É´„Éì„É•„Éº„Åß„ÇÇÂàÜ„Åã„Çä„ÇÑ„Åô„Åè %>
                  <span class="d-md-none small">„É°„Éã„É•„Éº</span>
                  <i class="bi bi-chevron-down ms-1" style="font-size: 0.75rem;"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li class="dropdown-header">
                    <%= current_admin.email %>
                    <br><small class="text-muted"><%= current_admin.role_text %></small>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <%# TODO: üü° Phase 4ÔºàÈáçË¶ÅÔºâ- „Ç¢„Ç´„Ç¶„É≥„ÉàÁÆ°ÁêÜÊ©üËÉΩ %>
                  <%# ÂÑ™ÂÖàÂ∫¶: ‰∏≠Ôºà„É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£Âêë‰∏äÔºâ %>
                  <%# ÂÆüË£ÖÂÜÖÂÆπ: %>
                  <%#   - „Éó„É≠„Éï„Ç£„Éº„É´Á∑®ÈõÜÊ©üËÉΩÔºàÂêçÂâç„ÄÅ„É°„Éº„É´„Ç¢„Éâ„É¨„ÇπÔºâ %>
                  <%#   - „Éë„Çπ„ÉØ„Éº„ÉâÂ§âÊõ¥Ê©üËÉΩ %>
                  <%#   - ‰∫åË¶ÅÁ¥†Ë™çË®ºË®≠ÂÆö %>
                  <%#   - „É≠„Ç∞„Ç§„É≥Â±•Ê≠¥Ë°®Á§∫ %>
                  <%# „É°„ÇøË™çÁü•: „Çª„Ç≠„É•„É™„ÉÜ„Ç£„Å®„É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£„ÅÆ‰∏°Á´ã %>
                  <%# Ê®™Â±ïÈñã: Â∫óËàó„É¶„Éº„Ç∂„ÉºÂÅ¥„Å´„ÇÇÂêåÊßò„ÅÆÊ©üËÉΩÂÆüË£Ö %>
                  <%# %>
                  <%# TODO: üü¢ Phase 5ÔºàÊé®Â•®Ôºâ- „É≠„Ç∞„Ç¢„Ç¶„ÉàÊ©üËÉΩ„ÅÆÈ´òÂ∫¶Âåñ %>
                  <%# ÂÑ™ÂÖàÂ∫¶: ‰ΩéÔºàÁèæÂú®„ÅÆÊ©üËÉΩ„ÅßÂçÅÂàÜ„Å†„Åå„ÄÅ„Åï„Çâ„Å™„ÇãÂêë‰∏äÔºâ %>
                  <%# ÂÆüË£ÖÂÜÖÂÆπ: %>
                  <%#   - „É≠„Ç∞„Ç¢„Ç¶„ÉàÂâç„ÅÆËá™Âãï„Éá„Éº„Çø‰øùÂ≠òÊ©üËÉΩ %>
                  <%#   - „Çª„ÉÉ„Ç∑„Éß„É≥ÊúüÈôêÂàá„ÇåË≠¶Âëä„É¢„Éº„ÉÄ„É´ %>
                  <%#   - Ë§áÊï∞„Éá„Éê„Ç§„Çπ„Åã„Çâ„ÅÆ‰∏ÄÊã¨„É≠„Ç∞„Ç¢„Ç¶„Éà %>
                  <%#   - „É≠„Ç∞„Ç¢„Ç¶„ÉàÂæå„ÅÆ„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÂÖàÈÅ∏Êäû %>
                  <%# „É°„ÇøË™çÁü•: UXÂêë‰∏ä„Å®„Çª„Ç≠„É•„É™„ÉÜ„Ç£Âº∑Âåñ„ÅÆÁ∂ôÁ∂öÁöÑÊîπÂñÑ %>
                  <%# Ê®™Â±ïÈñã: Â∫óËàó„É¶„Éº„Ç∂„Éº„ÄÅAPIË™çË®º„Åß„ÇÇÂêåÊßò„ÅÆÊ©üËÉΩÊ§úË®é %>
                  <!-- <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>„Éó„É≠„Éï„Ç£„Éº„É´</a></li> -->
                  <!-- <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Ë®≠ÂÆö</a></li> -->
                  <!-- <li><hr class="dropdown-divider"></li> -->
                  <li>
                    <%= button_to destroy_admin_session_path, method: :delete, 
                        class: "dropdown-item text-danger d-flex align-items-center logout-btn", 
                        title: "„É≠„Ç∞„Ç¢„Ç¶„ÉàÔºàÁ¢∫Ë™ç„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÅåË°®Á§∫„Åï„Çå„Åæ„ÅôÔºâ",
                        form: { 
                          data: { 
                            turbo: false,
                            confirm: "Êú¨ÂΩì„Å´„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åô„ÅãÔºü\n\n‰ΩúÊ•≠‰∏≠„ÅÆ„Éá„Éº„Çø„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Çã„Åì„Å®„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"
                          } 
                        } do %>
                      <i class="bi bi-box-arrow-right me-2 fs-5"></i>
                      <strong>„É≠„Ç∞„Ç¢„Ç¶„Éà</strong>
                    <% end %>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    <% end %>

    <!-- Main Content -->
    <main class="<%= admin_signed_in? ? 'container-fluid py-4' : 'container py-5' %>">
      <!-- Flash Messages -->
      <% flash.each do |key, value| %>
        <div class="alert alert-<%= key == 'notice' ? 'success' : 'danger' %> alert-dismissible fade show" role="alert">
          <%= value %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <!-- Footer -->
    <% if admin_signed_in? %>
      <footer class="bg-admin-primary text-white text-center py-3 mt-auto">
        <div class="container-fluid">
          <p class="mb-0">&copy; <%= Date.today.year %> StockRx - ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´ V1.0</p>
        </div>
      </footer>
    <% end %>
    
    <%# TODO: üî¥ Phase 2ÔºàÁ∑äÊÄ•Ôºâ- BootstrapÈáçË§áË™≠„ÅøËæº„ÅøÂïèÈ°åËß£Ê±∫ÂÆå‰∫Ü %>
    <%# ÂïèÈ°å: Bootstrap„ÅåImportmap„Å®CDN„Åß‰∫åÈáçË™≠„ÅøËæº„Åø %>
    <%# Ëß£Ê±∫: CDNÂâäÈô§ÔºàImportmap„ÅßÁµ±‰∏ÄÁÆ°ÁêÜÔºâ %>
    <%# ÁêÜÁî±: JavaScript„Ç≥„É≥„Éï„É™„ÇØ„Éà„Å´„Çà„Çã„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥Âãï‰Ωú‰∏çËâØ %>
    <%# Ê®™Â±ïÈñã: ÂÖ®„É¨„Ç§„Ç¢„Ç¶„Éà„Éï„Ç°„Ç§„É´„ÅßCDNÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÂøÖË¶Å %>
    <%# „É°„ÇøË™çÁü•: „É¢„ÉÄ„É≥RailsÈñãÁô∫„Åß„ÅØImportmapÊé®Â•®„ÄÅCDNÊ∑∑Âú®„ÅØÈÅø„Åë„Çã %>
    
    <%# TODO: üî¥ Phase 1ÔºàÁ∑äÊÄ•Ôºâ- ÂàùÊúüÂåñ„Ç≥„Éº„ÉâÈáçË§áËß£Ê∂àÂÆå‰∫Ü %>
    <%# ÂïèÈ°å: „É¨„Ç§„Ç¢„Ç¶„Éà„Éï„Ç°„Ç§„É´„Å®application.js„ÅßBootstrapÂàùÊúüÂåñ„ÅåÈáçË§á %>
    <%# Ëß£Ê±∫: application.js„Å´‰∏ÄÂÖÉÂåñ„ÄÅ„É¨„Ç§„Ç¢„Ç¶„ÉàÂÅ¥„ÅØÂâäÈô§ %>
    <%# ÁêÜÁî±: ÂàùÊúüÂåñ„ÅÆÁ´∂Âêà„Å´„Çà„Çä„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅåÂãï‰Ωú„Åó„Å™„ÅÑ %>
    <%# „É°„ÇøË™çÁü•: BootstrapÂàùÊúüÂåñ„ÅØ‰∏ÄÁÆáÊâÄ„Å´ÈõÜÁ¥Ñ„Åô„Çã„Åì„Å®„ÅåÈáçË¶Å %>
    <%# Ê®™Â±ïÈñã: store.html.erb„Åß„ÇÇÂêåÊßò„ÅÆ‰øÆÊ≠£„ÅåÂøÖË¶Å %>
    
    <!-- ÁÆ°ÁêÜËÄÖÂú®Â∫´‰∏ÄË¶ßÊ©üËÉΩ -->
    <% if request.path.include?('/admin/inventories') %>
      <%= javascript_include_tag 'admin_inventories', defer: true %>
    <% end %>
    
    <%# üö® Á∑äÊÄ•‰øÆÊ≠£ - „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅåÂÆåÂÖ®„Å´Âãï‰Ωú„Åó„Å™„ÅÑÂïèÈ°å %> 
    <%# ‚úÖ Phase 2ÂÆå‰∫Ü - „É¶„Éº„Ç∂„Éº„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥Â∞ÇÁî®‰øÆÊ≠£Ôºà2025Âπ¥6Êúà17Êó•Ôºâ %>
    <%# ÂïèÈ°å: querySelectorAll('.dropdown-menu')„ÅßÂÖ®„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅåÈÄ£Âãï %>
    <%# ‰øÆÊ≠£: „É¶„Éº„Ç∂„Éº„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅÆ„É°„Éã„É•„Éº„ÅÆ„Åø„ÇíÂØæË±°„Å´Â§âÊõ¥ %>
    <%# „É°„ÇøË™çÁü•: ‰ªñ„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Å®„ÅÆÁã¨Á´ãÊÄßÁ¢∫‰øù„ÅåÈáçË¶Å %>
    <%# Ê®™Â±ïÈñã: Â∫óËàóÁÆ°ÁêÜ„ÉªÁßªÂãïÁÆ°ÁêÜ„ÉªÂú®Â∫´ÁÆ°ÁêÜ„ÉªÁõ£Ë¶ñ„ÅÆÂêÑ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇÇÂÄãÂà•ÂØæÂøúÂøÖË¶Å %>
    <%# ‚úÖ Phase 3ÂÆå‰∫Ü - ‰ªñ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅÆÂÄãÂà•ÂØæÂøúÔºà2025Âπ¥6Êúà17Êó•Ôºâ %>
    <%# ÂÆüË£ÖÂÜÖÂÆπ: Â∫óËàóÁÆ°ÁêÜ„ÉªÁßªÂãïÁÆ°ÁêÜ„ÉªÂú®Â∫´ÁÆ°ÁêÜ„ÉªÁõ£Ë¶ñ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅÆÁã¨Á´ãÂãï‰ΩúÁ¢∫‰øù %>
    <%# „É°„ÇøË™çÁü•: ÂêÑ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Åå‰ªñ„Å´ÂΩ±Èüø„Åó„Å™„ÅÑÁã¨Á´ãÊÄßÂÆüÁèæ %>
    <%# TODO: üü° Phase 4ÔºàÈáçË¶ÅÔºâ- BootstrapÂæ©Êóß„Å®„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó %>
    <%# ÂÑ™ÂÖàÂ∫¶: ‰∏≠ÔºàÊ©üËÉΩÁöÑ„Å´„ÅØÂïèÈ°å„Å™„ÅÑ„Åå„ÄÅÈï∑Êúü‰øùÂÆàÊÄßÂêë‰∏äÔºâ %>
    <%# ÂÆüË£ÖÂÜÖÂÆπ: %>
    <%#   - BootstrapÊ≠£ÂºèÂàùÊúüÂåñ„ÅÆÂæ©ÊóßÔºàTurboÂØæÂøúÂÆåÂÖ®ÁâàÔºâ %>
    <%#   - Á∑äÊÄ•‰øÆÊ≠£„Ç≥„Éº„Éâ„ÅÆÊÆµÈöéÁöÑÂâäÈô§ %>
    <%#   - application.js„Å®„ÅÆÁµ±ÂêàÊúÄÈÅ©Âåñ %>
    <%#   - Áµ±‰∏ÄÁöÑ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†ÊßãÁØâ %>
    <%# Ê®™Â±ïÈñã: store.html.erb„Åß„ÇÇÂêåÊßò„ÅÆÊîπÂñÑÈÅ©Áî® %>
    <%# „É°„ÇøË™çÁü•: ‰∏ÄÊôÇÁöÑËß£Ê±∫„Åã„ÇâÊÅí‰πÖÁöÑËß£Ê±∫„Å∏„ÅÆÁßªË°å %>
    <script>
      // ÊúÄ„ÇÇÂü∫Êú¨ÁöÑ„ÅßÁ¢∫ÂÆü„Å™ÂÆüË£Ö„Å´Âàá„ÇäÊõø„Åà
      document.addEventListener('DOMContentLoaded', function() {
        console.log('üö® EMERGENCY: DOM Content Loaded');
        
        // „Åô„Åπ„Å¶„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Å´Âº∑Âà∂ÁöÑ„Å´ÊâãÂãïÊ©üËÉΩ„ÇíËøΩÂä†
        function forceDropdownFunctionality() {
          console.log('üîß Forcing manual dropdown functionality...');
          
          const userDropdown = document.getElementById('userDropdown');
          if (userDropdown) {
            console.log('‚úÖ Found userDropdown element');
            
            // „Åô„Åπ„Å¶„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíÂâäÈô§„Åó„Å¶„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„Éó
            const newUserDropdown = userDropdown.cloneNode(true);
            userDropdown.parentNode.replaceChild(newUserDropdown, userDropdown);
            
            // Âº∑Âà∂ÁöÑ„Å™ÊâãÂãï„ÇØ„É™„ÉÉ„ÇØ„Éè„É≥„Éâ„É©„Éº
            newUserDropdown.addEventListener('click', function(e) {
              console.log('üö® EMERGENCY CLICK HANDLER TRIGGERED');
              e.preventDefault();
              e.stopPropagation();
              
              // „Çà„ÇäÁ¢∫ÂÆü„Å™„Çª„É¨„ÇØ„Çø„ÉºÔºàË§áÊï∞ÂÄôË£úÔºâ
              let dropdownMenu = document.querySelector('#userDropdown + .dropdown-menu');
              if (!dropdownMenu) {
                dropdownMenu = document.querySelector('.dropdown-menu.dropdown-menu-end');
              }
              if (!dropdownMenu) {
                dropdownMenu = newUserDropdown.parentElement.querySelector('.dropdown-menu');
              }
              if (!dropdownMenu) {
                dropdownMenu = document.querySelector('ul.dropdown-menu');
              }
              if (dropdownMenu) {
                console.log('‚úÖ Found dropdown menu');
                
                // ÁèæÂú®„ÅÆË°®Á§∫Áä∂ÊÖãÁ¢∫Ë™ç
                const isVisible = dropdownMenu.style.display === 'block' || 
                                dropdownMenu.classList.contains('show');
                
                console.log('Current state:', isVisible ? 'visible' : 'hidden');
                
                // ÂÖ®„Å¶„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíÈñâ„Åò„Çã
                document.querySelectorAll('.dropdown-menu').forEach(menu => {
                  menu.style.display = 'none';
                  menu.classList.remove('show');
                });
                
                // ÁèæÂú®„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Çí„Éà„Ç∞„É´
                if (!isVisible) {
                  dropdownMenu.style.display = 'block';
                  dropdownMenu.classList.add('show');
                  console.log('üéØ Dropdown OPENED');
                } else {
                  console.log('üéØ Dropdown CLOSED');
                }
              } else {
                console.error('‚ùå Dropdown menu not found!');
              }
            }, true); // „Ç≠„É£„Éó„ÉÅ„É£„Éï„Çß„Éº„Ç∫„ÅßÁ¢∫ÂÆü„Å´ÂÆüË°å
            
            console.log('‚úÖ Emergency click handler attached');
          } else {
            console.error('‚ùå userDropdown element not found!');
          }
        }
        
        // Âç≥Â∫ß„Å´ÂÆüË°å
        forceDropdownFunctionality();
        
        // ËøΩÂä†„ÅÆ„Éá„Éê„ÉÉ„Ç∞ÊÉÖÂ†±
        console.log('üîç DOM Debug Info:');
        console.log('- Total dropdown-toggle elements:', document.querySelectorAll('.dropdown-toggle').length);
        console.log('- Total dropdown-menu elements:', document.querySelectorAll('.dropdown-menu').length);
        console.log('- UserDropdown exists:', !!document.getElementById('userDropdown'));
        
        // „Åï„Çâ„Å´Á¢∫ÂÆü„Å™‰ª£Êõø„Ç¢„Éó„É≠„Éº„ÉÅ
        document.addEventListener('click', function(e) {
          if (e.target.closest('#userDropdown') || e.target.id === 'userDropdown') {
            console.log('üéØ ALTERNATIVE: UserDropdown area clicked');
            e.preventDefault();
            e.stopPropagation();
            
            // üéØ ‰øÆÊ≠£: „É¶„Éº„Ç∂„Éº„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅÆ„É°„Éã„É•„Éº„ÅÆ„Åø„ÇíÂèñÂæó
            const userMenu = document.querySelector('#userDropdown + .dropdown-menu, #userDropdown ~ .dropdown-menu, .dropdown-menu.dropdown-menu-end');
            console.log('Found user menu:', !!userMenu);
            
            if (userMenu) {
              const isVisible = userMenu.style.display === 'block' || userMenu.classList.contains('show');
              
              // ÂÖ®„Å¶„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíÈñâ„Åò„ÇãÔºà„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÔºâ
              document.querySelectorAll('.dropdown-menu').forEach(menu => {
                menu.style.display = 'none';
                menu.classList.remove('show');
              });
              
              // „É¶„Éº„Ç∂„Éº„É°„Éã„É•„Éº„ÅÆ„Åø„Çí„Éà„Ç∞„É´
              if (!isVisible) {
                userMenu.style.display = 'block';
                userMenu.classList.add('show');
                console.log('üéØ FIXED: User menu opened');
              } else {
                console.log('üéØ FIXED: User menu closed');
              }
            } else {
              console.error('‚ùå User dropdown menu not found');
            }
          }
        }, true);
        
        // üîÑ Phase 3: ‰ªñ„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅÆÂÄãÂà•Ê©üËÉΩËøΩÂä†
        function setupOtherDropdowns() {
          console.log('üîß Setting up other dropdowns individually...');
          
          // Â∫óËàóÁÆ°ÁêÜ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥
          const storeDropdown = document.getElementById('storeDropdown');
          if (storeDropdown) {
            setupIndividualDropdown(storeDropdown, 'store');
          }
          
          // ÁßªÂãïÁÆ°ÁêÜ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥
          const transferDropdown = document.getElementById('transferDropdown');
          if (transferDropdown) {
            setupIndividualDropdown(transferDropdown, 'transfer');
          }
          
          // Âú®Â∫´ÁÆ°ÁêÜ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥
          const inventoryDropdown = document.getElementById('inventoryDropdown');
          if (inventoryDropdown) {
            setupIndividualDropdown(inventoryDropdown, 'inventory');
          }
          
          // Áõ£Ë¶ñ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥
          const monitorDropdown = document.getElementById('monitorDropdown');
          if (monitorDropdown) {
            setupIndividualDropdown(monitorDropdown, 'monitor');
          }
          
          console.log('‚úÖ Other dropdowns setup completed');
        }
        
        // ÂÄãÂà•„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥Ë®≠ÂÆöÈñ¢Êï∞
        function setupIndividualDropdown(dropdownToggle, name) {
          if (dropdownToggle.hasAttribute('data-manual-setup')) {
            return; // „Åô„Åß„Å´Ë®≠ÂÆöÊ∏à„Åø
          }
          
          dropdownToggle.setAttribute('data-manual-setup', 'true');
          dropdownToggle.addEventListener('click', function(e) {
            console.log(`üéØ ${name} dropdown clicked`);
            e.preventDefault();
            e.stopPropagation();
            
            // Ë©≤ÂΩì„Åô„Çã„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„É°„Éã„É•„Éº„ÇíË¶ã„Å§„Åë„Çã
            const parent = this.closest('.dropdown');
            const menu = parent ? parent.querySelector('.dropdown-menu') : this.nextElementSibling;
            
            if (menu && menu.classList.contains('dropdown-menu')) {
              const isCurrentlyOpen = menu.classList.contains('show');
              
              // ÂÖ®„Å¶„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇíÈñâ„Åò„Çã
              document.querySelectorAll('.dropdown-menu').forEach(m => {
                m.classList.remove('show');
                m.style.display = 'none';
              });
              
              // ÁèæÂú®„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Çí„Éà„Ç∞„É´
              if (!isCurrentlyOpen) {
                menu.classList.add('show');
                menu.style.display = 'block';
                console.log(`‚úÖ ${name} dropdown opened`);
              } else {
                console.log(`‚úÖ ${name} dropdown closed`);
              }
            }
          });
        }
        
        // ‰ªñ„ÅÆ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇÇË®≠ÂÆö
        setupOtherDropdowns();
        
        // Â§ñÈÉ®„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        document.addEventListener('click', function(e) {
          if (!e.target.closest('.dropdown')) {
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
              menu.style.display = 'none';
              menu.classList.remove('show');
            });
          }
        });
      });
      
      // TurboÁí∞Â¢É„Åß„ÇÇÂÆüË°å
      document.addEventListener('turbo:load', function() {
        console.log('üö® EMERGENCY: Turbo Load');
        
        // Â∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶Á¢∫ÂÆü„Å´ÂÆüË°å
        setTimeout(function() {
          const userDropdown = document.getElementById('userDropdown');
          if (userDropdown && !userDropdown.hasAttribute('data-emergency-handler')) {
            console.log('üîß Adding emergency handler via Turbo');
            
            userDropdown.setAttribute('data-emergency-handler', 'true');
            userDropdown.addEventListener('click', function(e) {
              console.log('üö® TURBO EMERGENCY CLICK');
              e.preventDefault();
              e.stopPropagation();
              
              // „Çà„ÇäÁ¢∫ÂÆü„Å™„Çª„É¨„ÇØ„Çø„ÉºÔºàË§áÊï∞ÂÄôË£úÔºâ
              let menu = document.querySelector('#userDropdown + .dropdown-menu');
              if (!menu) {
                menu = document.querySelector('.dropdown-menu.dropdown-menu-end');
              }
              if (!menu) {
                menu = userDropdown.parentElement.querySelector('.dropdown-menu');
              }
              if (!menu) {
                menu = document.querySelector('ul.dropdown-menu');
              }
              if (menu) {
                const isVisible = menu.style.display === 'block';
                
                // ÂÖ®„Å¶Èñâ„Åò„ÇãÔºà„ÇØ„É™„Éº„É≥„Ç¢„ÉÉ„ÉóÔºâ
                document.querySelectorAll('.dropdown-menu').forEach(m => {
                  m.style.display = 'none';
                  m.classList.remove('show');
                });
                
                // „É¶„Éº„Ç∂„Éº„É°„Éã„É•„Éº„ÅÆ„Åø„Çí„Éà„Ç∞„É´
                if (!isVisible) {
                  menu.style.display = 'block';
                  menu.classList.add('show');
                  console.log('üéØ TURBO: User dropdown opened');
                }
              }
            }, true);
          }
          
          // üîÑ Phase 3: TurboÁí∞Â¢É„Åß„ÅÆ‰ªñ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥Ë®≠ÂÆö
          // Â∫óËàóÁÆ°ÁêÜ„ÄÅÁßªÂãïÁÆ°ÁêÜ„ÄÅÂú®Â∫´ÁÆ°ÁêÜ„ÄÅÁõ£Ë¶ñ„ÅÆÂêÑ„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÇÇTurboÂØæÂøú
          ['storeDropdown', 'transferDropdown', 'inventoryDropdown', 'monitorDropdown'].forEach(dropdownId => {
            const dropdown = document.getElementById(dropdownId);
            if (dropdown && !dropdown.hasAttribute('data-turbo-manual-setup')) {
              dropdown.setAttribute('data-turbo-manual-setup', 'true');
              dropdown.addEventListener('click', function(e) {
                console.log(`üîÑ TURBO: ${dropdownId} clicked`);
                e.preventDefault();
                e.stopPropagation();
                
                const parent = this.closest('.dropdown');
                const menu = parent ? parent.querySelector('.dropdown-menu') : this.nextElementSibling;
                
                if (menu && menu.classList.contains('dropdown-menu')) {
                  const isVisible = menu.style.display === 'block';
                  
                  // ÂÖ®„Å¶Èñâ„Åò„Çã
                  document.querySelectorAll('.dropdown-menu').forEach(m => {
                    m.style.display = 'none';
                    m.classList.remove('show');
                  });
                  
                  // ÁèæÂú®„ÅÆ„É°„Éã„É•„Éº„Çí„Éà„Ç∞„É´
                  if (!isVisible) {
                    menu.style.display = 'block';
                    menu.classList.add('show');
                    console.log(`‚úÖ TURBO: ${dropdownId} opened`);
                  }
                }
              }, true);
            }
          });
        }, 100);
      });
    </script>
  </body>
</html> 