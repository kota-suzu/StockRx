<!DOCTYPE html>
<html>
  <head>
    <title>StockRx - ç®¡ç†è€…ãƒ‘ãƒãƒ«</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%# ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã®è¦–èªæ€§å‘ä¸Šã®ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ CSS %>
    <style>
      /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¼·èª¿ */
      #userDropdown {
        border: 1px solid rgba(255,255,255,0.2);
        border-radius: 0.375rem;
        padding: 0.375rem 0.75rem;
        transition: all 0.3s ease;
      }
      
      #userDropdown:hover,
      #userDropdown:focus,
      #userDropdown[aria-expanded="true"] {
        background-color: rgba(255,255,255,0.1);
        border-color: rgba(255,255,255,0.4);
      }
      
      /* ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã®å¼·èª¿ */
      .logout-btn {
        transition: all 0.3s ease;
        border-top: 1px solid #dee2e6;
        margin-top: 0.5rem;
        padding-top: 0.75rem !important;
        padding-bottom: 0.75rem !important;
      }
      
      .logout-btn:hover {
        background-color: #dc3545 !important;
        color: white !important;
        transform: translateX(5px);
      }
      
      .logout-btn:hover i {
        animation: slide-out 0.3s ease-in-out;
      }
      
      @keyframes slide-out {
        0% { transform: translateX(0); }
        50% { transform: translateX(3px); }
        100% { transform: translateX(0); }
      }
      
      /* ãƒ¢ãƒã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ã§ã®æ”¹å–„ */
      @media (max-width: 767px) {
        #userDropdown {
          padding: 0.5rem 1rem;
          font-size: 1.1rem;
        }
        
        .dropdown-menu {
          min-width: 200px;
        }
      }
      
      /* ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®æ”¹å–„ */
      .dropdown-menu-end {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        border: 1px solid rgba(0, 0, 0, 0.1);
      }
      
      /* TODO: ğŸŸ¢ Phase 4ï¼ˆæ¨å¥¨ï¼‰- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
      /* å„ªå…ˆåº¦: ä½ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼‰ */
      /* å®Ÿè£…å†…å®¹: ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«å¿œã˜ãŸãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ */
      /* ãƒ¡ã‚¿èªçŸ¥: ç¾ä»£ã®UIãƒˆãƒ¬ãƒ³ãƒ‰ã«å¯¾å¿œ */
    </style>
  </head>

  <body>
    <% if admin_signed_in? %>
      <!-- Enhanced Admin Navigation with Multi-Store Support -->
      <nav class="navbar navbar-expand-lg navbar-dark navbar-admin sticky-top">
        <div class="container-fluid">
          <%= link_to admin_root_path, class: "navbar-brand d-flex align-items-center" do %>
            <i class="bi bi-boxes me-2"></i>
            <span>StockRx</span>
            <small class="badge bg-light text-dark ms-2">ç®¡ç†ãƒ‘ãƒãƒ«</small>
          <% end %>
          
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                  aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
              <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
              <li class="nav-item">
                <%= link_to admin_root_path, 
                    class: "nav-link #{'active' if current_page?(admin_root_path)}", 
                    title: "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰" do %>
                  <i class="bi bi-speedometer2 me-1"></i>
                  <span class="d-none d-lg-inline">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                  <span class="d-lg-none">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
                <% end %>
              </li>

              <!-- ãƒãƒ«ãƒã‚¹ãƒˆã‚¢ç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆæ¨©é™ã«ã‚ˆã‚‹è¡¨ç¤ºåˆ¶å¾¡ï¼‰ -->
              <% if current_admin.can_access_all_stores? || current_admin.store_manager? %>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle <%= 'active' if request.path.include?('/admin/stores') %>" 
                     href="#" id="storeDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                     title="åº—èˆ—ç®¡ç†">
                    <i class="bi bi-shop me-1"></i>
                    <span class="d-none d-lg-inline">åº—èˆ—ç®¡ç†</span>
                    <span class="d-lg-none">åº—èˆ—</span>
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <%= link_to admin_stores_path, class: "dropdown-item" do %>
                        <i class="bi bi-list me-2"></i>åº—èˆ—ä¸€è¦§
                      <% end %>
                    </li>
                    <% if current_admin.headquarters_admin? %>
                      <li>
                        <%= link_to new_admin_store_path, class: "dropdown-item" do %>
                          <i class="bi bi-plus-circle me-2"></i>æ–°è¦åº—èˆ—
                        <% end %>
                      </li>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <%= link_to admin_stores_path, class: "dropdown-item" do %>
                          <i class="bi bi-graph-up me-2"></i>åº—èˆ—åˆ†æ
                        <% end %>
                      </li>
                    <% end %>
                  </ul>
                </li>

                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle <%= 'active' if request.path.include?('/admin/transfers') %>" 
                     href="#" id="transferDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                     title="åº—èˆ—é–“ç§»å‹•">
                    <i class="bi bi-truck me-1"></i>
                    <span class="d-none d-lg-inline">ç§»å‹•ç®¡ç†</span>
                    <span class="d-lg-none">ç§»å‹•</span>
                  </a>
                  <ul class="dropdown-menu">
                    <li>
                      <%= link_to admin_inter_store_transfers_path, class: "dropdown-item" do %>
                        <i class="bi bi-list me-2"></i>ç§»å‹•ä¸€è¦§
                      <% end %>
                    </li>
                    <li>
                      <%= link_to new_admin_inter_store_transfer_path, class: "dropdown-item" do %>
                        <i class="bi bi-plus-circle me-2"></i>æ–°è¦ç”³è«‹
                      <% end %>
                    </li>
                    <% if current_admin.can_approve_transfers? %>
                      <li><hr class="dropdown-divider"></li>
                      <li>
                        <%= link_to pending_admin_inter_store_transfers_path, class: "dropdown-item position-relative" do %>
                          <i class="bi bi-clock me-2"></i>æ‰¿èªå¾…ã¡
                          <% begin %>
                            <% pending_count = current_admin&.accessible_store_ids&.any? ? InterStoreTransfer.accessible_to_admin(current_admin).pending.count : 0 %>
                            <% if pending_count > 0 %>
                              <span class="badge bg-warning text-dark position-absolute top-0 start-100 translate-middle">
                                <%= pending_count %>
                              </span>
                            <% end %>
                          <% rescue => e %>
                            <%# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã®éšœå®³èª¿æŸ»ç”¨ï¼‰ %>
                            <% Rails.logger.error "æ‰¿èªå¾…ã¡ä»¶æ•°å–å¾—ã‚¨ãƒ©ãƒ¼: #{e.message}" if Rails.env.production? %>
                            <%# é–‹ç™ºç’°å¢ƒã§ã¯è­¦å‘Šè¡¨ç¤ºã€æœ¬ç•ªç’°å¢ƒã§ã¯é™ã‹ã«å¤±æ•— %>
                            <% unless Rails.env.production? %>
                              <span class="badge bg-danger">!</span>
                            <% end %>
                          <% end %>
                        <% end %>
                      </li>
                    <% end %>
                    <% if current_admin.headquarters_admin? %>
                      <li>
                        <%= link_to analytics_admin_inter_store_transfers_path, class: "dropdown-item" do %>
                          <i class="bi bi-graph-up me-2"></i>åˆ†æãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
                        <% end %>
                      </li>
                    <% end %>
                  </ul>
                </li>
              <% end %>

              <!-- åœ¨åº«ç®¡ç† -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle <%= 'active' if request.path.include?('/admin/inventories') %>" 
                   href="#" id="inventoryDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"
                   title="åœ¨åº«ç®¡ç†">
                  <i class="bi bi-boxes me-1"></i>
                  <span class="d-none d-lg-inline">åœ¨åº«ç®¡ç†</span>
                  <span class="d-lg-none">åœ¨åº«</span>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <%= link_to admin_inventories_path, class: "dropdown-item" do %>
                      <i class="bi bi-list me-2"></i>å•†å“ä¸€è¦§
                    <% end %>
                  </li>
                  <li>
                    <%= link_to new_admin_inventory_path, class: "dropdown-item" do %>
                      <i class="bi bi-plus-circle me-2"></i>æ–°è¦ç™»éŒ²
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to admin_inventories_path(filter: "low_stock"), class: "dropdown-item" do %>
                      <i class="bi bi-exclamation-triangle me-2"></i>ä½åœ¨åº«ã‚¢ãƒ©ãƒ¼ãƒˆ
                    <% end %>
                  </li>
                  <li>
                    <%= link_to import_form_admin_inventories_path, class: "dropdown-item" do %>
                      <i class="bi bi-upload me-2"></i>CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                    <% end %>
                  </li>
                </ul>
              </li>

              <!-- å±¥æ­´ãƒ»ç›£è¦– -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="monitorDropdown" role="button" 
                   data-bs-toggle="dropdown" aria-expanded="false" title="ç›£è¦–ãƒ»å±¥æ­´">
                  <i class="bi bi-activity me-1"></i>
                  <span class="d-none d-lg-inline">ç›£è¦–</span>
                  <span class="d-lg-none">ç›£è¦–</span>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <%# âœ… å®Œäº†: Phase 3 - inventory_logsæ©Ÿèƒ½ã®ç®¡ç†ç”»é¢çµ±åˆï¼ˆ2025å¹´6æœˆï¼‰ %>
                    <%# CLAUDE.mdæº–æ‹ : ç®¡ç†æ©Ÿèƒ½ã®ä¸€å…ƒåŒ–å®Œäº† %>
                    <%= link_to admin_inventory_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-journal-text me-2"></i>åœ¨åº«å±¥æ­´
                    <% end %>
                  </li>
                  <li>
                    <%= link_to admin_audit_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-shield-check me-2"></i>ç›£æŸ»ãƒ­ã‚°
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%= link_to security_events_admin_audit_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-shield-exclamation me-2"></i>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¤ãƒ™ãƒ³ãƒˆ
                    <% end %>
                  </li>
                  <li>
                    <%= link_to user_activity_admin_audit_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-person-lines-fill me-2"></i>ãƒ¦ãƒ¼ã‚¶ãƒ¼æ´»å‹•å±¥æ­´
                    <% end %>
                  </li>
                  <li>
                    <%= link_to compliance_report_admin_audit_logs_path, class: "dropdown-item" do %>
                      <i class="bi bi-file-earmark-check me-2"></i>ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ
                    <% end %>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <%# TODO: ğŸŸ¢ Phase 4ï¼ˆæ¨å¥¨ï¼‰- Sidekiq Webãƒã‚¦ãƒ³ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã®ãƒ‘ã‚¹ç®¡ç† %>
                    <%# å„ªå…ˆåº¦: ä½ï¼ˆæ©Ÿèƒ½çš„ã«ã¯å•é¡Œãªã—ï¼‰ %>
                    <%# å®Ÿè£…å†…å®¹: %>
                    <%#   - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§Sidekiq Web UIã®ãƒ‘ã‚¹ã‚’ç®¡ç† %>
                    <%#   - helper methodã§ã®ä¸€å…ƒç®¡ç† %>
                    <%# ç†ç”±: Sidekiq::Webã¯å¤–éƒ¨ã‚¨ãƒ³ã‚¸ãƒ³ã®ãŸã‚ã€Railsãƒ‘ã‚¹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œãªã„ %>
                    <%# ç¾çŠ¶: ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹ã¯æ­£å¸¸å‹•ä½œï¼ˆroutes.rbã§ãƒã‚¦ãƒ³ãƒˆç¢ºèªæ¸ˆã¿ï¼‰ %>
                    <%= link_to "/admin/sidekiq", class: "dropdown-item", target: "_blank", rel: "noopener" do %>
                      <i class="bi bi-gear me-2"></i>ã‚¸ãƒ§ãƒ–ç›£è¦–
                    <% end %>
                  </li>
                </ul>
              </li>
            </ul>
            
            <!-- å³å´ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <ul class="navbar-nav">
              <!-- é€šçŸ¥ï¼ˆæœªå®Ÿè£…ï¼‰ -->
              <li class="nav-item">
                <a class="nav-link position-relative" href="#" title="é€šçŸ¥ï¼ˆå®Ÿè£…äºˆå®šï¼‰">
                  <i class="bi bi-bell"></i>
                  <!-- TODO: Phase 3 - é€šçŸ¥æ©Ÿèƒ½å®Ÿè£…æ™‚ã«è¡¨ç¤º -->
                  <!-- <span class="badge bg-danger position-absolute top-0 start-100 translate-middle">3</span> -->
                </a>
              </li>

              <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆå«ã‚€ï¼‰ -->
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" 
                   role="button" data-bs-toggle="dropdown" aria-expanded="false"
                   aria-haspopup="true" aria-label="ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã"
                   title="ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆã¯ã“ã¡ã‚‰ï¼‰"
                   tabindex="0">
                  <i class="bi bi-person-circle me-2"></i>
                  <div class="d-none d-md-block">
                    <div class="small"><%= current_admin.display_name %></div>
                    <div class="text-muted" style="font-size: 0.75rem;"><%= current_admin.role_text %></div>
                  </div>
                  <%# ãƒ¢ãƒã‚¤ãƒ«ãƒ“ãƒ¥ãƒ¼ã§ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã %>
                  <span class="d-md-none small">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
                  <i class="bi bi-chevron-down ms-1" style="font-size: 0.75rem;"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li class="dropdown-header">
                    <%= current_admin.email %>
                    <br><small class="text-muted"><%= current_admin.role_text %></small>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <%# TODO: ğŸŸ¡ Phase 4ï¼ˆé‡è¦ï¼‰- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½ %>
                  <%# å„ªå…ˆåº¦: ä¸­ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šï¼‰ %>
                  <%# å®Ÿè£…å†…å®¹: %>
                  <%#   - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†æ©Ÿèƒ½ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰ %>
                  <%#   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´æ©Ÿèƒ½ %>
                  <%#   - äºŒè¦ç´ èªè¨¼è¨­å®š %>
                  <%#   - ãƒ­ã‚°ã‚¤ãƒ³å±¥æ­´è¡¨ç¤º %>
                  <%# ãƒ¡ã‚¿èªçŸ¥: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã®ä¸¡ç«‹ %>
                  <%# æ¨ªå±•é–‹: åº—èˆ—ãƒ¦ãƒ¼ã‚¶ãƒ¼å´ã«ã‚‚åŒæ§˜ã®æ©Ÿèƒ½å®Ÿè£… %>
                  <!-- <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a></li> -->
                  <!-- <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>è¨­å®š</a></li> -->
                  <!-- <li><hr class="dropdown-divider"></li> -->
                  <li>
                    <%= button_to destroy_admin_session_path, method: :delete, 
                        class: "dropdown-item text-danger d-flex align-items-center logout-btn", 
                        title: "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆï¼ˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰",
                        form: { 
                          data: { 
                            turbo: false,
                            confirm: "æœ¬å½“ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ\n\nä½œæ¥­ä¸­ã®ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
                          } 
                        } do %>
                      <i class="bi bi-box-arrow-right me-2 fs-5"></i>
                      <strong>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</strong>
                    <% end %>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    <% end %>

    <!-- Main Content -->
    <main class="<%= admin_signed_in? ? 'container-fluid py-4' : 'container py-5' %>">
      <!-- Flash Messages -->
      <% flash.each do |key, value| %>
        <div class="alert alert-<%= key == 'notice' ? 'success' : 'danger' %> alert-dismissible fade show" role="alert">
          <%= value %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% end %>

      <%= yield %>
    </main>

    <!-- Footer -->
    <% if admin_signed_in? %>
      <footer class="bg-admin-primary text-white text-center py-3 mt-auto">
        <div class="container-fluid">
          <p class="mb-0">&copy; <%= Date.today.year %> StockRx - ç®¡ç†è€…ãƒ‘ãƒãƒ« V1.0</p>
        </div>
      </footer>
    <% end %>
    
    <%# TODO: ğŸ”´ Phase 2ï¼ˆç·Šæ€¥ï¼‰- Bootstrapé‡è¤‡èª­ã¿è¾¼ã¿å•é¡Œè§£æ±ºå®Œäº† %>
    <%# å•é¡Œ: BootstrapãŒImportmapã¨CDNã§äºŒé‡èª­ã¿è¾¼ã¿ %>
    <%# è§£æ±º: CDNå‰Šé™¤ï¼ˆImportmapã§çµ±ä¸€ç®¡ç†ï¼‰ %>
    <%# ç†ç”±: JavaScriptã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã«ã‚ˆã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³å‹•ä½œä¸è‰¯ %>
    <%# æ¨ªå±•é–‹: å…¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§CDNé‡è¤‡ãƒã‚§ãƒƒã‚¯å¿…è¦ %>
    <%# ãƒ¡ã‚¿èªçŸ¥: ãƒ¢ãƒ€ãƒ³Railsé–‹ç™ºã§ã¯Importmapæ¨å¥¨ã€CDNæ··åœ¨ã¯é¿ã‘ã‚‹ %>
    
    <%# TODO: ğŸŸ¡ Phase 1ï¼ˆç·Šæ€¥ï¼‰- ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‹•ä½œãƒ‡ãƒãƒƒã‚° %>
    <%# å„ªå…ˆåº¦: é«˜ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½ï¼‰ %>
    <%# å®Ÿè£…å†…å®¹: BootstrapåˆæœŸåŒ–çŠ¶æ…‹ã¨ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ %>
    <%# ãƒ¡ã‚¿èªçŸ¥: Turboç’°å¢ƒã§ã®æ­£ã—ã„åˆæœŸåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³é©ç”¨ %>
    <%# ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹: turbo:loadã‚¤ãƒ™ãƒ³ãƒˆã®ã¿ä½¿ç”¨ï¼ˆDOMContentLoadedéæ¨å¥¨ï¼‰ %>
    <script>
      // ğŸ›¡ï¸ CLAUDE.mdæº–æ‹ : Turboç’°å¢ƒã§ã®BootstrapåˆæœŸåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³
      // ãƒ¡ã‚¿èªçŸ¥: DOMContentLoadedã¯Turboãƒšãƒ¼ã‚¸é·ç§»ã§ç™ºç«ã—ãªã„ãŸã‚é™¤å¤–
      document.addEventListener('turbo:load', function() {
        console.log('ğŸ” Bootstrap Dropdown Debug Check (turbo:load):');
        console.log('- Bootstrap loaded:', typeof bootstrap !== 'undefined');
        console.log('- Bootstrap version:', typeof bootstrap !== 'undefined' ? bootstrap.Dropdown.VERSION : 'N/A');
        
        const dropdownElements = document.querySelectorAll('.dropdown-toggle');
        console.log('- Dropdown elements found:', dropdownElements.length);
        
        // è©³ç´°ãªãƒ‡ãƒãƒƒã‚°æƒ…å ±
        if (dropdownElements.length > 0) {
          dropdownElements.forEach((element, index) => {
            const instance = bootstrap?.Dropdown?.getInstance(element);
            console.log(`  [${index}] ${element.id || element.className}:`, {
              'data-bs-toggle': element.getAttribute('data-bs-toggle'),
              'aria-expanded': element.getAttribute('aria-expanded'),
              'hasInstance': !!instance
            });
          });
        }
        
        // Bootstrapæœªèª­ã¿è¾¼ã¿æ™‚ã®è­¦å‘Š
        if (typeof bootstrap === 'undefined') {
          console.error('ğŸš¨ Bootstrap not loaded! Check importmap configuration.');
          // TODO: ğŸ”´ Phase 1 - CDNãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã‚’ç™ºå‹•
        }
      });
      
      // ã‚¨ãƒ©ãƒ¼ç›£è¦–ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ï¼‰
      window.addEventListener('error', function(e) {
        if (e.error && e.error.toString().includes('bootstrap')) {
          console.error('ğŸš¨ Bootstrap-related error:', e.error);
        }
      });
    </script>
    
    <!-- ç®¡ç†è€…åœ¨åº«ä¸€è¦§æ©Ÿèƒ½ -->
    <% if request.path.include?('/admin/inventories') %>
      <%= javascript_include_tag 'admin_inventories', defer: true %>
    <% end %>
  </body>
</html> 