<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">
      <% if @inventory %>
        <%= @inventory.name %> の在庫変更履歴
      <% elsif @operation_type %>
        <%= @operation_type.humanize %> 操作の在庫変更履歴
      <% else %>
        全在庫変更履歴
      <% end %>
    </h1>
    
    <div class="flex space-x-2">
      <%= link_to "CSVダウンロード", url_for(format: :csv), class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
      <% if @inventory %>
        <%= link_to "在庫詳細に戻る", inventory_path(@inventory), class: "bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded" %>
      <% else %>
        <%= link_to "在庫一覧に戻る", inventories_path, class: "bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded" %>
      <% end %>
    </div>
  </div>
  
  <%= inventory_log_filter_links(@operation_type) %>
  
  <div class="bg-white p-4 rounded shadow mb-6">
    <%= form_with url: request.path, method: :get, class: "flex flex-wrap items-end gap-4" do |f| %>
      <div>
        <%= f.label :start_date, "開始日", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :start_date, value: params[:start_date], class: "rounded border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" %>
      </div>
      
      <div>
        <%= f.label :end_date, "終了日", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :end_date, value: params[:end_date], class: "rounded border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50" %>
      </div>
      
      <div>
        <%= f.submit "検索", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
        <% if params[:start_date].present? || params[:end_date].present? %>
          <%= link_to "リセット", request.path, class: "ml-2 text-sm text-gray-600 hover:text-gray-900" %>
        <% end %>
      </div>
    <% end %>
  </div>
  
  <div class="bg-white shadow-md rounded my-6">
    <table class="min-w-full bg-white">
      <thead>
        <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
          <th class="py-3 px-6 text-left">日時</th>
          <th class="py-3 px-6 text-left">在庫名</th>
          <th class="py-3 px-6 text-center">操作</th>
          <th class="py-3 px-6 text-center">変化量</th>
          <th class="py-3 px-6 text-center">変更前</th>
          <th class="py-3 px-6 text-center">変更後</th>
          <th class="py-3 px-6 text-center">備考</th>
          <th class="py-3 px-6 text-center">操作者</th>
        </tr>
      </thead>
      <tbody class="text-gray-600 text-sm">
        <% @logs.each do |log| %>
          <tr class="border-b border-gray-200 hover:bg-gray-100">
            <td class="py-3 px-6 text-left whitespace-nowrap">
              <%= log.created_at.strftime('%Y/%m/%d %H:%M') %>
            </td>
            <td class="py-3 px-6 text-left">
              <%= link_to log.inventory.name, inventory_path(log.inventory), class: "text-blue-600 hover:text-blue-900" %>
            </td>
            <td class="py-3 px-6 text-center">
              <span class="<%= operation_badge_class(log.operation_type) %>">
                <%= operation_type_label(log.operation_type) %>
              </span>
            </td>
            <td class="py-3 px-6 text-center">
              <span class="<%= log.delta >= 0 ? 'text-green-600' : 'text-red-600' %>">
                <%= log.delta >= 0 ? "+#{log.delta}" : log.delta %>
              </span>
            </td>
            <td class="py-3 px-6 text-center"><%= log.previous_quantity %></td>
            <td class="py-3 px-6 text-center"><%= log.current_quantity %></td>
            <td class="py-3 px-6 text-center"><%= log.note %></td>
            <td class="py-3 px-6 text-center">
              <%= log.user ? log.user.name : '自動' %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  
  <% if @logs.empty? %>
    <div class="text-center py-4 text-gray-500">
      記録が見つかりません
    </div>
  <% end %>
  
  <div class="mt-6 flex justify-center">
    <%= paginate @logs, theme: 'tailwind' %>
  </div>
</div> 