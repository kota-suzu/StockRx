# ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒƒãƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
# æœ¬ç•ªç’°å¢ƒã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒƒãƒå®Ÿè¡Œæ™‚ã®è¨­å®šã‚’å®šç¾©

patches:
  inventory_price_adjustment:
    description: "åœ¨åº«å•†å“ã®ä¾¡æ ¼ä¸€æ‹¬èª¿æ•´ï¼ˆæ¶ˆè²»ç¨ç‡å¤‰æ›´ãƒ»ä»•å…¥ã‚Œä¾¡æ ¼å¤‰å‹•å¯¾å¿œï¼‰"
    category: "inventory"
    target_tables:
      - "inventories"
      - "inventory_logs"
    estimated_records: 100000
    memory_limit: 1024  # MB
    batch_size: 2000
    # ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¾‹
    default_options:
      adjustment_type: "percentage"
      adjustment_value: 0
      grace_period: 0

  batch_expiry_update:
    description: "æœŸé™åˆ‡ã‚Œãƒãƒƒãƒã®çŠ¶æ…‹æ›´æ–°ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†"
    category: "maintenance"
    target_tables:
      - "batches"
      - "inventory_logs"
    estimated_records: 50000
    memory_limit: 512   # MB
    batch_size: 1000
    # ã‚«ã‚¹ã‚¿ãƒ ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¾‹
    default_options:
      grace_period: 3
      include_expiring_soon: true
      warning_days: 30
      update_inventory_status: true
      create_notification: true

  # TODO: ğŸŸ¡ Phase 3ï¼ˆä¸­ï¼‰- è¿½åŠ ãƒ‡ãƒ¼ã‚¿ãƒ‘ãƒƒãƒã®å®Ÿè£…
  # å®Ÿè£…äºˆå®š: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã€çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å†è¨ˆç®—ç­‰
  # user_data_cleanup:
  #   description: "éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"
  #   category: "maintenance"
  #   target_tables: ["admins", "admin_notification_settings"]
  #   estimated_records: 10000
  #   memory_limit: 256
  #   batch_size: 500

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š
security:
  log_encryption: true
  audit_retention_days: 90
  notification_channels:
    - slack
    - email
  
  # TODO: ğŸŸ¡ Phase 3ï¼ˆä¸­ï¼‰- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½å¼·åŒ–
  # å®Ÿè£…äºˆå®š: æš—å·åŒ–ã‚­ãƒ¼ç®¡ç†ã€ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡å¼·åŒ–
  # encryption_key_rotation_days: 30
  # require_approval_for_production: true
  # max_concurrent_executions: 1

# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°è¨­å®š
scheduling:
  default_timezone: "Asia/Tokyo"
  
  # ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ™‚é–“å¸¯
  maintenance_windows:
    - start: "02:00"
      end: "04:00"
      days: ["sunday", "wednesday"]
    - start: "03:00"
      end: "05:00"
      days: ["saturday"]
  
  # å®šæœŸå®Ÿè¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆsidekiq-schedulerç”¨ï¼‰
  recurring_patches:
    batch_expiry_update:
      cron: "0 2 * * 0,3"  # æ—¥æ›œãƒ»æ°´æ›œã®åˆå‰2æ™‚
      enabled: true
      options:
        grace_period: 3
        include_expiring_soon: true
        notification_enabled: true

# å®Ÿè¡Œç’°å¢ƒåˆ¥è¨­å®š
environments:
  development:
    default_dry_run: true
    notification_enabled: false
    batch_size: 100  # é–‹ç™ºç’°å¢ƒã§ã¯å°ã•ã„ãƒãƒƒãƒã‚µã‚¤ã‚º
    memory_limit: 128

  test:
    default_dry_run: true
    notification_enabled: false
    audit_enabled: false
    batch_size: 10
    memory_limit: 64

  production:
    default_dry_run: false
    notification_enabled: true
    audit_enabled: true
    # æœ¬ç•ªç’°å¢ƒã§ã¯å€‹åˆ¥è¨­å®šã‚’ä½¿ç”¨

# é€šçŸ¥è¨­å®š
notifications:
  slack:
    enabled: true
    webhook_url: "${SLACK_WEBHOOK_URL}"  # ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
    channel: "#stockrx-maintenance"
    username: "StockRx DataPatch Bot"
    
    # é€šçŸ¥æ¡ä»¶
    conditions:
      success: true
      error: true
      dry_run: false  # Dry-runã¯é€šçŸ¥ã—ãªã„
      min_processed_records: 100  # 100ä»¶ä»¥ä¸Šå‡¦ç†ã—ãŸå ´åˆã®ã¿é€šçŸ¥

  email:
    enabled: true
    smtp_settings:
      # Railsæ¨™æº–ã®ActionMailerè¨­å®šã‚’ä½¿ç”¨
      delivery_method: :smtp
    
    recipients:
      - "admin@stockrx.example.com"
      - "devops@stockrx.example.com"
    
    conditions:
      error: true  # ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
      critical_patches: ["inventory_price_adjustment"]

# ãƒ­ã‚°è¨­å®š
logging:
  level: "info"
  structured_format: true
  
  # ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
  retention_days: 30
  max_file_size: "100MB"
  
  # æ©Ÿå¯†æƒ…å ±ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
  filter_sensitive_data: true
  sensitive_patterns:
    - "password"
    - "secret"
    - "token"
    - "api_key"

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
monitoring:
  memory_check_frequency: 10  # ãƒãƒƒãƒæ¯
  gc_frequency: 50           # ãƒãƒƒãƒæ¯
  
  # ã‚¢ãƒ©ãƒ¼ãƒˆé–¾å€¤
  thresholds:
    memory_usage_percent: 80
    execution_time_multiplier: 3.0  # äºˆæƒ³æ™‚é–“ã®3å€
    error_rate_percent: 5.0

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
database:
  # ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³è¨­å®š
  transaction_timeout: 3600  # ç§’
  lock_timeout: 300         # ç§’
  
  # æ¥ç¶šãƒ—ãƒ¼ãƒ«è¨­å®š
  pool_size: 5
  checkout_timeout: 5

# TODO: ğŸŸ¡ Phase 3ï¼ˆä¸­ï¼‰- é«˜åº¦ãªè¨­å®šé …ç›®
# å®Ÿè£…äºˆå®šé …ç›®:
# - A/Bãƒ†ã‚¹ãƒˆå¯¾å¿œ
# - ã‚«ãƒŠãƒªã‚¢ãƒªãƒªãƒ¼ã‚¹å¯¾å¿œ
# - è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¡ä»¶è¨­å®š
# - å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æºè¨­å®š
# - ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ç›£æŸ»è¨­å®š