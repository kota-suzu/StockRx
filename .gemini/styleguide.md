# StockRx Ruby on Rails スタイルガイド

日本語で返答してください
このスタイルガイドはStockRxプロジェクトのRuby on Railsコード規約を定義しています。コードレビューとコード品質の一貫性を維持するためのガイドラインとして使用してください。

## 一般的なコード規約

### コード品質

- コードは読みやすく、明確で、シンプルであるべきです
- メソッドは単一責任の原則に従い、1つのことだけを行うべきです
- クラスは単一責任の原則に従い、明確に定義された目的を持つべきです
- 長いメソッド（10行以上）は避け、必要に応じて分割してください
- 深いネスト（3レベル以上）は避けてください
- 複雑な条件分岐は小さなメソッドに分割することを検討してください

### 命名規則

- 変数名とメソッド名はスネークケース（`inventory_item`）を使用してください
- クラス名とモジュール名はキャメルケース（`InventoryItem`）を使用してください
- 定数は大文字とアンダースコア（`MAX_ITEMS`）を使用してください
- 命名は明確で、略語や曖昧な名前は避けてください
- 真偽値を返すメソッドには疑問形（`available?`）を使用してください

## Railsガイドライン

### モデル

- Fat Modelは避け、関連するコードをサービスクラスやモジュールに抽出してください
- バリデーションはモデルの上部に記述し、可読性を高めてください
- コールバックは慎重に使用し、複雑なビジネスロジックには代わりにサービスクラスを検討してください
- 複雑なクエリはスコープに抽出してください
- N+1クエリの問題に注意し、`includes`や`joins`を適切に使用してください

### コントローラー

- コントローラーはシンプルに保ち、ビジネスロジックはサービスクラスに移動させてください
- 各アクションは最小限にし、モデルの取得、サービスの呼び出し、レスポンスの返却に限定してください
- 共通のコントローラーロジックは`concerns`にリファクタリングしてください
- 強いパラメータ（Strong Parameters）を適切に使用してください

### ビュー

- ビューはシンプルに保ち、複雑なロジックはヘルパーやデコレーターに移動させてください
- パーシャルを適切に活用し、コードの重複を避けてください
- ローカル変数を優先し、インスタンス変数の使用を最小限にしてください
- 再利用可能なUIコンポーネントを作成してください

### サービス

- サービスクラスは単一責任の原則に従ってください
- サービスクラスはクリーンなインターフェースを持ち、`call`メソッドを実装してください
- テストしやすいコードを書き、複雑なロジックを小さなメソッドに分割してください

### テスト

- すべての新しいコードには適切なテストを書いてください
- モデル、コントローラー、サービスのテストには適切な粒度を使用してください
- テストは明確で簡潔であるべきです
- テストデータはファクトリ（`FactoryBot`）を使用して作成してください
- テストは信頼性があり、環境に依存しないようにしてください

## セキュリティガイドライン

- SQLインジェクションを避けるため、生のSQLの代わりにActive Recordクエリインターフェースを使用してください
- クロスサイトスクリプティング（XSS）を防ぐため、ユーザー入力のエスケープを忘れないでください
- クロスサイトリクエストフォージェリ（CSRF）からの保護を常に有効にしてください
- 機密情報をログに記録しないでください
- 適切な認証と認可を実装してください
- 環境変数やRails Credentialsを使用して、シークレットを安全に保管してください

## パフォーマンスガイドライン

- 無駄なデータベースクエリを避け、N+1クエリの問題に注意してください
- 重いクエリには適切なインデックスを使用してください
- 大きなデータセットの処理にはバックグラウンドジョブを使用してください
- メモリ使用量に注意し、大きなオブジェクトをメモリに保持しないようにしてください
- キャッシュを適切に活用してください

## ドキュメンテーション

- 複雑なメソッドやクラスには適切なドキュメントコメントを追加してください
- パブリックAPIには明確なドキュメントを提供してください
- 重要なビジネスロジックには説明コメントを追加してください

これらの規約に従うことで、コードの品質と一貫性を維持し、チームのコラボレーションを促進できます。