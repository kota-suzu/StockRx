# StockRx システム デシジョンテーブル

## 概要

このドキュメントは、StockRx在庫管理システムの各画面における条件分岐と結果を体系的に整理したデシジョンテーブルです。

## 表記規則

- **Y** : 条件が満たされる（Yes）
- **N** : 条件が満たされない（No）
- **-** : 条件に関係なし（Don't Care）
- **●** : 結果として実行される
- **○** : 条件付きで実行される
- **-** : 実行されない

---

## 1. 管理者ログイン画面

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 | ケース5 |
|------|---------|---------|---------|---------|---------|
| **入力条件** |
| メールアドレス入力済み | N | Y | Y | Y | Y |
| パスワード入力済み | N | N | Y | Y | Y |
| **検証条件** |
| 有効なメールアドレス形式 | - | N | N | Y | Y |
| 認証情報が正しい | - | - | - | N | Y |
| アカウントがロック状態 | - | - | - | - | N |
| **結果** |
| フォームバリデーションエラー表示 | ● | ● | ● | - | - |
| 認証失敗メッセージ表示 | - | - | - | ● | - |
| ダッシュボードへリダイレクト | - | - | - | - | ● |
| ログイン試行回数カウント | - | - | - | ● | - |
| GitHubログインボタン表示 | ● | ● | ● | ● | ● |

**業務ルール**: 12文字以上のパスワード必須、5回失敗で15分間ロック

---

## 2. 管理者ダッシュボード画面

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 |
|------|---------|---------|---------|---------|
| **前提条件** |
| 管理者認証済み | Y | Y | Y | Y |
| **データ条件** |
| 在庫データ存在 | N | Y | Y | Y |
| 在庫切れ商品存在 | - | N | Y | Y |
| 期限切れバッチ存在 | - | - | N | Y |
| **結果** |
| 空状態メッセージ表示 | ● | - | - | - |
| 基本統計情報表示 | - | ● | ● | ● |
| 在庫アラート表示（警告色） | - | - | ● | ● |
| 期限切れアラート表示（危険色） | - | - | - | ● |
| 最近のアクティビティ表示 | - | ● | ● | ● |
| クイックアクションボタン表示 | ● | ● | ● | ● |
| 数値カウントアップアニメーション | - | ● | ● | ● |

**表示統計**: 総商品数、在庫切れ数、総在庫金額、本日・週間・月間操作数、バッチ数

---

## 3. 管理者在庫一覧画面

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 | ケース5 | ケース6 |
|------|---------|---------|---------|---------|---------|---------|
| **検索条件** |
| 検索クエリ存在 | N | Y | Y | Y | Y | Y |
| 検索結果存在 | - | N | Y | Y | Y | Y |
| **フィルター条件** |
| ステータスフィルター適用 | - | - | N | Y | Y | Y |
| 在庫切れフィルター適用 | - | - | - | N | Y | Y |
| **表示条件** |
| ページネーション必要（50件超） | - | - | - | - | N | Y |
| **結果** |
| 全在庫表示 | ● | - | - | - | - | - |
| 検索結果なしメッセージ | - | ● | - | - | - | - |
| フィルタリング済み結果表示 | - | - | ● | ● | ● | ● |
| ステータスバッジ表示 | ● | - | ● | ● | ● | ● |
| アラートバッジ表示 | ● | - | ○ | ○ | ● | ● |
| ページネーション表示 | - | - | - | - | - | ● |
| バルクアクション有効化 | ● | - | ● | ● | ● | ● |
| CSVインポートボタン表示 | ● | ● | ● | ● | ● | ● |

**表示オプション**: 50/100/200件切り替え、名前/価格/数量/更新日ソート

---

## 4. 在庫一覧画面（公開）

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 | ケース5 |
|------|---------|---------|---------|---------|---------|
| **検索条件** |
| 検索フォーム有効 | N | Y | Y | Y | Y |
| 高度検索モード | - | N | Y | Y | Y |
| 検索条件存在 | - | N | N | Y | Y |
| 検索結果存在 | - | - | - | N | Y |
| **結果** |
| シンプル検索フォーム表示 | ● | ● | - | - | - |
| 高度検索フォーム表示 | - | - | ● | ● | ● |
| 検索条件サマリー表示 | - | - | - | ● | ● |
| 空状態メッセージ | - | - | - | ● | - |
| 在庫一覧テーブル表示 | ● | ● | ● | - | ● |
| ソート機能有効 | ● | ● | ● | - | ● |
| Turbo Frame更新 | - | ● | ● | ● | ● |

---

## 5. 在庫登録・編集画面

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 | ケース5 |
|------|---------|---------|---------|---------|---------|
| **画面モード** |
| 新規登録モード | Y | N | N | N | N |
| 編集モード | N | Y | Y | Y | Y |
| **処理状態** |
| バリデーションエラー有り | - | N | Y | Y | Y |
| 保存成功 | - | - | N | Y | Y |
| AJAX投稿 | - | - | - | N | Y |
| **結果** |
| 空フォーム表示 | ● | - | - | - | - |
| 既存データ表示 | - | ● | ● | ● | ● |
| エラーメッセージ表示 | - | - | ● | - | - |
| 成功メッセージ表示 | - | - | - | ● | ● |
| 一覧画面へリダイレクト | - | - | - | ● | - |
| Turbo Stream応答 | - | - | - | - | ● |
| フォームリセット | - | - | - | ● | ● |

**バリデーション**: 商品名（必須、255文字以内）、価格（数値、0以上）、数量（整数、0以上）

---

## 6. CSVインポート画面

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 | ケース5 |
|------|---------|---------|---------|---------|---------|
| **ファイル条件** |
| ファイル選択済み | N | Y | Y | Y | Y |
| 有効なCSVファイル | - | N | Y | Y | Y |
| ファイルサイズ制限内（10MB以下） | - | - | N | Y | Y |
| **処理状態** |
| インポート実行中 | - | - | - | N | Y |
| **結果** |
| ファイル選択促進メッセージ | ● | - | - | - | - |
| ファイル形式エラー表示 | - | ● | - | - | - |
| ファイルサイズエラー表示 | - | - | ● | - | - |
| バックグラウンドジョブ開始 | - | - | - | ● | - |
| 進捗表示（ActionCable） | - | - | - | - | ● |
| インポート結果通知 | - | - | - | ● | ● |

**制限事項**: 10MB以下、CSV形式、UTF-8推奨

---

## 7. 在庫ログ画面

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 | ケース5 |
|------|---------|---------|---------|---------|---------|
| **表示条件** |
| 特定在庫のログ表示 | N | Y | Y | Y | Y |
| 日付範囲フィルター適用 | - | N | Y | Y | Y |
| ユーザーフィルター適用 | - | - | N | Y | Y |
| **データ条件** |
| ログデータ存在 | - | - | - | N | Y |
| **結果** |
| 全ログ表示 | ● | - | - | - | - |
| 在庫固有ログ表示 | - | ● | ● | ● | ● |
| 日付フィルタリング適用 | - | - | ● | ● | ● |
| ユーザーフィルタリング適用 | - | - | - | ● | ● |
| 空状態メッセージ | - | - | - | ● | - |
| ページネーション表示（30件/ページ） | ● | ● | ● | - | ● |
| CSV出力ボタン | ● | ● | ● | - | ● |

**表示項目**: 操作日時、操作種別、在庫名、変更量、実行ユーザー

---

## 8. エラーページ

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 | ケース5 |
|------|---------|---------|---------|---------|---------|
| **エラー種別** |
| ステータスコード400（リクエストエラー） | Y | N | N | N | N |
| ステータスコード403（アクセス拒否） | N | Y | N | N | N |
| ステータスコード404（ページ未存在） | N | N | Y | N | N |
| ステータスコード500（サーバーエラー） | N | N | N | Y | N |
| その他のエラー | N | N | N | N | Y |
| **結果** |
| リクエストエラーメッセージ表示 | ● | - | - | - | - |
| アクセス拒否メッセージ表示 | - | ● | - | - | - |
| ページ未存在メッセージ表示 | - | - | ● | - | - |
| サーバーエラーメッセージ表示 | - | - | - | ● | - |
| 汎用エラーメッセージ表示 | - | - | - | - | ● |
| エラーレイアウト適用 | ● | ● | ● | ● | ● |
| CSRF検証スキップ | ● | ● | ● | ● | ● |

---

## 9. パスワードリセット画面

| 条件 | ケース1 | ケース2 | ケース3 | ケース4 |
|------|---------|---------|---------|---------|
| **入力条件** |
| メールアドレス入力済み | N | Y | Y | Y |
| 有効なメールアドレス形式 | - | N | Y | Y |
| **検証条件** |
| アカウント存在 | - | - | N | Y |
| **結果** |
| 入力促進メッセージ | ● | - | - | - |
| メール形式エラー表示 | - | ● | - | - |
| アカウント不存在エラー表示 | - | - | ● | - |
| リセットメール送信 | - | - | - | ● |
| 送信完了メッセージ表示 | - | - | - | ● |
| ログイン画面へリダイレクト | - | - | - | ● |

---

## 10. ホームページ

| 条件 | ケース1 |
|------|---------|
| **アクセス条件** |
| 公開ページアクセス | Y |
| **結果** |
| ホームページコンテンツ表示 | ● |
| アプリケーションレイアウト適用 | ● |
| 認証不要アクセス許可 | ● |

---

## デシジョンテーブル活用ガイド

### 読み方
1. **条件セクション**: システムの状態や入力条件を分類（前提条件、入力条件、検証条件等）
2. **結果セクション**: 条件の組み合わせに応じて実行される処理・表示内容
3. **ケース列**: 特定の条件組み合わせでのシステム挙動パターン

### 記号の意味
- **Y**: 条件が満たされる
- **N**: 条件が満たされない  
- **-**: 条件に関係なし
- **●**: 結果として実行される
- **○**: 条件付きで実行される

### テスト設計への活用
- 各ケース列がテストケースに対応
- 境界値テスト・異常系テストの網羅性確認
- 組み合わせテストの設計指針

### 保守・開発での活用
- 新機能追加時の影響範囲分析
- バグ修正時の条件分岐確認  
- コードレビューでのロジック検証
- 要件変更時の仕様整理

### 更新ルール
- 機能追加・変更時は対応テーブルを更新
- 新しい条件分岐発生時は新ケースを追加
- 廃止機能は対応ケースを削除
- 業務ルール変更時は条件・結果を見直し

---

*最終更新: 2025年6月15日*
*バージョン: 2.0（条件・結果表形式）*